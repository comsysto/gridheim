{"version":3,"sources":["utils/Immerable.ts","model/GridMap.ts","model/Transformation.tsx","model/BackgroundImage.ts","services/AbstractStorage.tsx","services/GridMapStorage.tsx","common/listgroup/ListGroup.tsx","common/listgroup/ListGroupItemAction.tsx","common/media/MediaContainer.tsx","common/media/MediaBody.tsx","common/GridMapList.tsx","common/FullPageWithHeading.tsx","common/ExplanationBox.tsx","App/GridMapsApp/AddGridMap/ImageUpload.tsx","utils/range.ts","utils/pointInSvgFromEvent.ts","utils/pointDistance.ts","utils/useDragSvg.ts","App/GridMapsApp/AddGridMap/TransformationSetup/SelectionRect.tsx","App/GridMapsApp/AddGridMap/TransformationSetup/common/ViewControls.tsx","App/GridMapsApp/AddGridMap/TransformationSetup/PlaceSquare.tsx","App/GridMapsApp/AddGridMap/TransformationSetup/PreviewGrid.tsx","App/GridMapsApp/AddGridMap/TransformationSetup.tsx","App/GridMapsApp/AddGridMap/AddMetadata.tsx","common/StepIndicator.tsx","App/GridMapsApp/AddGridMap.tsx","common/PageHeader.tsx","common/PageHeaderWithButtons.tsx","App/GridMapsApp.tsx","utils/classesMap.ts","common/dropdown/DropDown.tsx","common/dropdown/LinkDropdownItem.tsx","common/dropdown/DividerDropdownItem.tsx","App/GlobalMenu.tsx","model/Session.ts","services/SessionStorage.tsx","App/SessionsApp/StartSession.tsx","App/SessionsApp/NoGridMapsFound.tsx","App/SessionsApp/SessionList.tsx","App/SessionsApp.tsx","utils/arrayToDict.ts","App/ManageTokenTypesApp.tsx","data/opensource.ts","App/AboutApp/OpenSourceSection.tsx","App/AboutApp/IntroSection.tsx","App/AboutApp/HelloSection.tsx","App/AboutApp.tsx","services/SettingStorage.tsx","App/RedirectToAboutOnFirstVisit.tsx","model/Token.ts","model/Square.ts","model/Drawing.ts","model/DrawingPane.ts","model/ViewBox.ts","utils/uuid.ts","services/AbstractService.ts","App/PlayApp/services/BattleMapService.ts","model/DrawingColor.ts","model/DrawingWidth.ts","services/AbstractModeBasedService.ts","App/PlayApp/services/modebased/PlayModeService.ts","App/PlayApp/services/modebased/DrawingService.ts","model/TokenType.ts","App/PlayApp/services/AssetService.ts","utils/is.ts","App/PlayApp/services/modebased/ModeBasedService.ts","App/PlayApp/services/modebased/ManageTokenService.ts","App/PlayApp/services/ModeService.ts","App/PlayApp/services/SaveSessionService.ts","App/PlayApp/Layout/PlayMap/DisplayBackgroundImage.tsx","utils/useObservable.ts","common/DisplayToken.tsx","App/PlayApp/Layout/PlayMap/DisplayTokens.tsx","App/PlayApp/Layout/PlayMap/DrawingCapturePane.tsx","App/PlayApp/Layout/PlayMap/DrawingPane.tsx","App/PlayApp/Layout/PlayMap/ZoomPane.tsx","App/PlayApp/common/BattleGrid.tsx","App/PlayApp/Layout/PlayMap/BackgroundGrid.tsx","App/PlayApp/Layout/PlayMap/SelectionGrid.tsx","App/PlayApp/Layout/PlayMap.tsx","App/PlayApp/common/ControlBarButton.tsx","App/PlayApp/Layout/ControlBar/DrawingControlBar.tsx","App/PlayApp/Texts.ts","App/PlayApp/Layout/ControlBar/ModeControlBar.tsx","App/PlayApp/Layout/ControlBar/ManageTokenControlBar.tsx","App/PlayApp/Layout/ControlBar.tsx","common/LayoutGrid.tsx","App/PlayApp/Layout/AddTokenModal/TokenTypeSelection.tsx","common/Modal.tsx","App/PlayApp/Layout/AddTokenModal.tsx","App/PlayApp/Layout.tsx","App/PlayApp/NoSessionsFound.tsx","App/PlayApp.tsx","services/IndexedDbStorageProvider.ts","App.tsx","serviceWorker.js","index.tsx"],"names":["Immerable","target","immerable","GridMap","name","image","transformation","gridMapName","this","STORAGE_KEY_PREFIX","key","startsWith","props","Object","freeze","copy","assign","Math","ceil","width","scale","height","Transformation","dx","dy","BackgroundImage","url","AbstractStorage","storageProvider","isStorageKey","toStorageKey","parseJson","keyToStorageKey","listKeys","pipe","flatMap","list","observables","loadObject","length","of","forkJoin","map","array","a","objectKey","o","jsonString","JSON","stringify","set","get","content","json","parse","e","console","log","remove","undefined","GridMapStorage","gridMap","storageKey","ListGroup","className","children","ListGroupItemAction","active","onClick","href","event","preventDefault","MediaContainer","MediaBody","GridMapList","gridMaps","selected","onSelect","values","getWidthInSquares","getHeightInSquares","src","FullPageWithHeading","heading","ExplanationBox","ImageUpload","initialUrl","onApply","useState","imageUrl","setImageUrl","useEffect","type","id","onChange","files","file","reader","FileReader","onloadend","result","readAsDataURL","htmlFor","disabled","icon","Check","range","n","Array","keys","pointInSvgFromEvent","element","currentTarget","svgPoint","ownerSVGElement","createSVGPoint","x","clientX","y","clientY","matrixTransform","getScreenCTM","inverse","useDragSvg","config","draggingRef","useRef","returnedDragging","setReturnedDragging","startPoint","configRef","current","setDragging","dragging","eventHandler","onPointerDown","svgTarget","point","onStart","onPointerMove","onMove","document","addEventListener","onPointerUp","p1","p2","sqrt","pow","onFinished","removeEventListener","SelectionRect","selectionRect","setSelectionRect","updateRect","rect","strokeSize","dragRect","max","p","onCancel","useDragCorner","changeRect","dragCornerMatrix","d","fillOpacity","stroke","strokeDasharray","strokeWidth","drag","strokeOpacity","fill","ViewControls","transformationFromProps","onTransformationChange","setTransformation","updateTransformation","t","button","fn","DiffAdded","with","DiffRemoved","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","viewPositionToLabel","center","PlaceSquare","viewPosition","default","setRect","style","transform","asTransformString","xlinkHref","PreviewGrid","imageTransformation","viewTransformation","setViewTransformation","xSquareCount","ySquareCount","viewBox","TransformationSetup","onStep","rect1","setRect1","r","r1","r2","averageA","distanceX","abs","calculatedAX","round","distanceY","calculatedA","calculateTransformation","AddMetadata","onSave","setName","Tag","placeholder","value","StepIndicator","steps","activeIndex","indexOf","step","i","future","Star","ChevronRight","Verified","upload","selectSquare1","selectSquare2","previewGrid","metadata","AddGridMap","setImage","setStep","saveGridMap","X","img","Image","onload","ImageModel","setImageFromUrl","PageHeader","headline","size","PageHeaderWithButtons","React","Children","child","GridMapsApp","create","setCreate","setSelected","gridMapStorage","setGridMaps","reload","useCallback","findAll","subscribe","next","FileMedia","Plus","delete","Trashcan","gridMapImage","store","classesMap","classNameMap","filter","join","DropDownContext","createContext","DropDown","buttonContent","buttonClasses","dropDownElementRef","show","setShow","ref","dropright","Provider","LinkDropdownItem","to","closeDropDown","useContext","DividerDropdownItem","GlobalMenu","ThreeBars","routing","play","Play","sessions","Repo","manageGridMaps","about","Info","Law","Key","Session","date","sessionName","CURRENT_SESSION_STORAGE_KEY","SessionStorage","session","selectBackground","StartSession","setBackgroundName","Date","toLocaleString","NoGridMapsFound","SessionList","gridMapsForName","selectedSessionName","onSelectSession","SessionsApp","setSelectedSessionName","sessionStorage","setSessions","setGridMapForName","combineLatest","findCurrentSessionName","reduce","dict","noBackgrounds","storeCurrentSessionName","ManageTokenTypesApp","opensource","page","licence","licenceUrl","Bootstrap","RxJS","Typescript","Octicons","Formik","Immer","JQuery","OpenSourceSection","MarkGithub","title","entries","info","IntroSection","Milestone","HelloSection","GistSecret","AboutApp","SettingToggle","defaultValue","localStorage","getItem","setItem","settingStorage","redirectToAbout","RedirectToAboutOnFirstVisit","Token","tokenType","label","square","Square","Drawing","path","color","CURRENT_ID","DrawingPane","drawings","drawingJson","drawing","withDrawingRemoved","drawingId","ViewBox","uuid","getTime","performance","now","replace","c","random","floor","toString","AbstractService","disposeS$","Subject","dispose$","asObservable","complete","takeUntil","BattleMapService","sessionStorageService","tokensS$","BehaviorSubject","tokens$","gridMap$","selectedTokenS$","selectedToken$","selectedSquareS$","selectedSquare$","squareSelectableS$","squareSelectable$","tokenSelectableS$","tokenSelectable$","tokenSizeS$","tokenSize$","hoveringSquareS$","hoveringSquare$","highlightedSquares$","squareSelectable","tokenSize","selectedToken","hoveringSquare","EMPTY_READONLY_ARRAY","squares","flat","debounceTime","viewBox$","scaleS$","scale$","throttleTime","positionS$","position$","token","tokenSelectable","tokens","produce","oldSelectedToken","newToken","find","tokenLabel","updateTokens","push","selectToken","selectable","factor","position","tokenId","s","DrawingColor","DrawingWidth","AbstractModeBasedService","activeS$","active$","onDeactivate$","onActivate","PlayModeService","battleMapService","setTokenSelectable","setSquareSelectable","selectSquare","distinctUntilChanged","a1","a2","b","selectedSquare","forEach","DrawingService","paneS$","pane$","drawingColorS$","red","drawingColor$","drawingWidthS$","m","drawingWidth$","drawingModeS$","drawingMode$","points$","pane","currentDrawing","drawingColor","drawingWidth","withPointAdded","panePreview","withDrawingAdded","error","withId","drawingMode","TokenType","border","AssetService","defaultStrokeColor","tokenTypes","tokenLabels","is","isEqualToOneOf","some","ModeBasedService","mode$","services","disposeSubject","disposeLastState","mode","service","activate","ManageTokenService","assetService","mode$S","tap","modeCallbacks","deactivate$","setTokenSize","tokenType$","tokenLabel$","addToken","removeSelectedToken","inactive","isSwitchTokenType$","tokenTypeS$","tokenLabelS$","controlServices","ModeService","initalMode","modeBasedServices","modeS$","untilDisposed","SaveSessionService","onLoad","toStore","sessionS$","session$","gridMapS$","auditTime","saveSession","valuesToStore","onLoadSubject","throwError","findBy","loadedSession","loadedData","subject","observable","data","catchError","DisplayBackgroundImage","useObservable","observable$","observableState","setObservableState","toSubscribe","subscription","unsubscribe","DisplayToken","tokenClasses","cx","cy","DisplayTokens","DrawingCapturePane","drawingService","pointSubject","setPointSubject","setPointerCapture","pointerId","currentlyDrawing","releasePointerCapture","completeDrawing","onPointerCancel","pointInSvg","drawingPane","points","svgPath","removeDrawing","ZoomPane","setFactor","pos","setPos","startPosBead","setStartPosBead","paneRef","moving","setMoving","updateFactor","diffX","switchScale","onBeadMouseMove","onBeadMouseDown","onBeadMouseUp","updatePosition","currentPos","diffY","movePosition","onPointerDownCapture","onPointerMoveCapture","onPointerUpCapture","BattleGrid","BackgroundGrid","SelectionGrid","highlightedSquares","onHover","highlightedMap","toCoordinateString","highlighted","onMouseOver","PlayMap","backgroundDrawingService","notesDrawingService","modeService","notesDrawing","zoomActive","toViewBoxString","hoverOverSquare","ControlBarButton","classes","text","iconSize","tooltip","iconHeight","additionalClasses","iconSizeByWidth","l","DrawingControlBar","drawingModeButton","switchDrawingMode","Pencil","Pulse","switchDrawingWidth","widthButton","Paintcan","switchDrawingColor","colorButton","texts","drawBackgroundButton","drawNotesButton","playButton","addTokensButton","zoomButton","ModeControlBar","modeButton","activeInMode","switchMode","GitCompare","Octoface","Note","Search","ManageTokenControlBar","manageTokenService","currentMode","btn","ControlBar","LayoutGrid","items","columns","component","item","idx","TokenTypeSelection","svgSize","maxTokenSize","Modal","onOk","okEnabled","buttonText","header","open","modalElementRef","useLayoutEffect","$","modal","on","tabIndex","AddTokenModal","showModal","selectedTokenType","selectedTokenLabel","selectedTokenSize","setTokenType","setTokenLabel","Layout","NoSessionsFound","PlayApp","setServices","sessionLoaded","setSessionLoaded","saveSessionService","playModeService","zoom","add","tokensJson","mappedTokens","tokenJson","tokenTypeForName","withCurrentDrawingRemoved","paneJson","setPane","fromJson","loadAndStart","toPromise","then","dispose","IndexedDbStorageProvider","db","Dexie","blobs","version","stores","TABLE_NAME","table","fromPromise","entry","toArray","put","manageTokenTypes","Boolean","window","location","hostname","match","shim","ReactDOM","render","exact","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.64f28db7.chunk.js","sourcesContent":["import { immerable } from \"immer\";\n\nexport function Immerable(): ClassDecorator {\n  return (target: any) => {\n    target[immerable] = true;\n  };\n}\n","import { Immerable } from \"../utils/Immerable\";\nimport { Transformation } from \"./Transformation\";\nimport { BackgroundImage } from \"./BackgroundImage\";\nimport { PropsOf } from \"../utils/types\";\n\n@Immerable()\nexport class GridMap {\n  static readonly STORAGE_KEY_PREFIX = \"map-\";\n\n  static storageKey(gridMapName: string): string {\n    return `${this.STORAGE_KEY_PREFIX}${gridMapName}`;\n  }\n\n  static isStorageKey(key: string): boolean {\n    return key.startsWith(this.STORAGE_KEY_PREFIX);\n  }\n\n  public static of(props: PropsOf<GridMap>): GridMap {\n    return Object.freeze(\n      new GridMap(props.name, props.image, props.transformation)\n    );\n  }\n\n  private constructor(\n    readonly name: string,\n    readonly image: BackgroundImage,\n    readonly transformation: Transformation\n  ) {}\n\n  with(props: { [T in keyof GridMap]?: GridMap[T] }): GridMap {\n    const copy = new GridMap(this.name, this.image, this.transformation);\n    return Object.freeze(Object.assign(copy, props));\n  }\n\n  getWidthInSquares(): number {\n    return Math.ceil(this.image.width * this.transformation.scale);\n  }\n\n  getHeightInSquares(): number {\n    return Math.ceil(this.image.height * this.transformation.scale);\n  }\n}\n","import { PropsOf, SomePropsOf } from \"../utils/types\";\n\nexport class Transformation {\n  public static default(): Transformation {\n    return Object.freeze(new Transformation(0, 0, 1));\n  }\n\n  public static of(props: PropsOf<Transformation>): Transformation {\n    return Object.freeze(new Transformation(props.dx, props.dy, props.scale));\n  }\n\n  private constructor(\n    readonly dx: number,\n    readonly dy: number,\n    readonly scale: number\n  ) {}\n\n  with(props: SomePropsOf<Transformation>): Transformation {\n    const copy = new Transformation(this.dx, this.dy, this.scale);\n    return Object.freeze(Object.assign(copy, props));\n  }\n\n  asTransformString(): string {\n    return `scale(${this.scale} ${this.scale}) translate(${this.dx} ${this.dy})`;\n  }\n}\n","import { PropsOf } from \"../utils/types\";\n\nexport class BackgroundImage {\n  public static of(props: PropsOf<BackgroundImage>): BackgroundImage {\n    return Object.freeze(\n      new BackgroundImage(props.url, props.width, props.height)\n    );\n  }\n\n  constructor(\n    readonly url: string,\n    readonly width: number,\n    readonly height: number\n  ) {}\n\n  with(\n    props: { [T in keyof BackgroundImage]?: BackgroundImage[T] }\n  ): BackgroundImage {\n    const copy = new BackgroundImage(this.url, this.width, this.height);\n    return Object.freeze(Object.assign(copy, props));\n  }\n}\n","import { StorageProvider } from \"./StorageProvider\";\nimport { forkJoin, Observable, of } from \"rxjs\";\nimport { flatMap, map } from \"rxjs/operators\";\n\nexport abstract class AbstractStorage<T, K> {\n  protected abstract readonly isStorageKey: (key: string) => boolean;\n  protected abstract readonly toStorageKey: (o: T) => string;\n  protected abstract readonly parseJson: (json: any) => T | null;\n  protected abstract readonly keyToStorageKey: (k: K) => string;\n\n  constructor(protected readonly storageProvider: StorageProvider) {}\n\n  findAll(): Observable<ReadonlyArray<T>> {\n    return this.storageProvider.listKeys().pipe(\n      flatMap(list => {\n        const observables: Array<Observable<T | null>> = list.flatMap(key => {\n          const keyResult: Observable<T | null>[] =\n            key && this.isStorageKey(key) ? [this.loadObject(key)] : [];\n          return keyResult;\n        });\n\n        if (observables.length === 0) {\n          return of([]);\n        }\n\n        return forkJoin(observables).pipe(\n          map(array => array.flatMap(a => (!!a ? [a] : []))),\n          map(array => Object.freeze(array))\n        );\n      })\n    );\n  }\n\n  findBy(objectKey: K): Observable<T | null> {\n    return this.loadObject(this.keyToStorageKey(objectKey));\n  }\n\n  store(o: T): Observable<void> {\n    const jsonString = JSON.stringify(o);\n    return this.storageProvider.set(this.toStorageKey(o), jsonString);\n  }\n\n  private loadObject(name: string): Observable<T | null> {\n    return this.storageProvider.get(name).pipe(\n      map(content => {\n        if (content === null) {\n          return null;\n        }\n        const json: any = JSON.parse(content);\n        try {\n          return this.parseJson(json);\n        } catch (e) {\n          console.log(`Failed loading ${name} from local storage`, { name, e });\n          return null;\n        }\n      })\n    );\n  }\n\n  delete(objectKey: K | null): Observable<void> {\n    if (!objectKey) {\n      return of(undefined);\n    }\n    return this.storageProvider.remove(this.keyToStorageKey(objectKey));\n  }\n}\n","import { GridMap } from \"../model/GridMap\";\nimport { Transformation } from \"../model/Transformation\";\nimport { BackgroundImage } from \"../model/BackgroundImage\";\nimport { AbstractStorage } from \"./AbstractStorage\";\n\nexport class GridMapStorage extends AbstractStorage<GridMap, string> {\n  protected readonly isStorageKey = (key: string): boolean =>\n    GridMap.isStorageKey(key);\n  protected readonly parseJson = (json: any): GridMap => {\n    return GridMap.of({\n      name: json.name,\n      image: BackgroundImage.of(json.image),\n      transformation: Transformation.of(json.transformation)\n    });\n  };\n\n  protected readonly toStorageKey = (gridMap: GridMap): string =>\n    GridMap.storageKey(gridMap.name);\n  protected readonly keyToStorageKey = (name: string): string =>\n    GridMap.storageKey(name);\n}\n","import React, { FC, ReactNode } from \"react\";\n\ninterface Props {\n  className?: string;\n  children: ReactNode;\n}\n\nexport const ListGroup: FC<Props> = ({ className, children }: Props) => {\n  return <div className={`list-group ${className || \"\"}`}>{children}</div>;\n};\n","import React, { FC, ReactNode } from \"react\";\n\ninterface Props {\n  children: ReactNode;\n  className?: string;\n  active?: boolean;\n  onClick?: () => void;\n}\n\nexport const ListGroupItemAction: FC<Props> = ({\n  children,\n  className,\n  active,\n  onClick\n}: Props) => {\n  return (\n    <a\n      href=\"#\"\n      onClick={event => {\n        event.preventDefault();\n        onClick && onClick();\n      }}\n      className={`list-group-item list-group-item-action ${className} ${\n        active ? \"active\" : \"\"\n      }`}\n    >\n      {children}\n    </a>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\n\ninterface Props {\n  children: ReactNode;\n}\n\nexport const MediaContainer: FC<Props> = ({ children }: Props) => {\n  return <div className=\"media\">{children}</div>;\n};\n","import React, { FC, ReactNode } from \"react\";\n\ninterface Props {\n  children: ReactNode;\n}\n\nexport const MediaBody: FC<Props> = ({ children }: Props) => {\n  return <div className=\"media-body\">{children}</div>;\n};\n","import React, { FC } from \"react\";\nimport { ListGroup } from \"./listgroup/ListGroup\";\nimport { ListGroupItemAction } from \"./listgroup/ListGroupItemAction\";\nimport { GridMap } from \"../model/GridMap\";\nimport { MediaContainer } from \"./media/MediaContainer\";\nimport { MediaBody } from \"./media/MediaBody\";\n\ninterface Props {\n  gridMaps: ReadonlyArray<GridMap>;\n  selected: GridMap | null;\n  onSelect: (selected: GridMap) => void;\n}\n\nexport const GridMapList: FC<Props> = ({\n  gridMaps,\n  selected,\n  onSelect\n}: Props) => {\n  return (\n    <ListGroup>\n      {Object.values(gridMaps).map(gridMap => (\n        <ListGroupItemAction\n          // className=\"gridMap-list_item\"\n          active={gridMap === selected}\n          key={gridMap.name}\n          onClick={() => onSelect(gridMap)}\n        >\n          <MediaContainer>\n            <MediaBody>\n              <h4>{gridMap.name}</h4>\n              <dl className=\"row\">\n                <dt className=\"col-sm-3\">Size in Squares</dt>\n                <dd className=\"col-sm-9\">\n                  {gridMap.getWidthInSquares()}x{gridMap.getHeightInSquares()}\n                </dd>\n\n                <dt className=\"col-sm-3\">Scale</dt>\n                <dd className=\"col-sm-9\">{gridMap.transformation.scale}</dd>\n\n                <dt className=\"col-sm-3\">X Offset</dt>\n                <dd className=\"col-sm-9\">{gridMap.transformation.dx}</dd>\n\n                <dt className=\"col-sm-3\">Y Offset</dt>\n                <dd className=\"col-sm-9\">{gridMap.transformation.dy}</dd>\n              </dl>\n            </MediaBody>\n            <img\n              className=\"ml-3 img-thumbnail image-300\"\n              src={gridMap.image.url}\n            />\n          </MediaContainer>\n        </ListGroupItemAction>\n      ))}\n    </ListGroup>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\n\ninterface Props {\n  heading: ReactNode;\n  children: ReactNode;\n}\n\nexport const FullPageWithHeading: FC<Props> = ({\n  heading,\n  children\n}: Props) => {\n  return (\n    <>\n      <div className=\"container fixed-top text-center full-page-with-heading_heading-container bg-white\">\n        {heading}\n      </div>\n      <div className=\"container h-100 scrollable-y full-page-with-heading_content-container\">\n        {children}\n      </div>\n    </>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\n\ninterface Props {\n  children: ReactNode;\n}\n\nexport const ExplanationBox: FC<Props> = ({ children }: Props) => {\n  return <div className=\"alert alert-primary\">{children}</div>;\n};\n","import React, { ChangeEvent, FC, useEffect, useState } from \"react\";\nimport { ExplanationBox } from \"../../../common/ExplanationBox\";\nimport Octicon, { Check } from \"@primer/octicons-react\";\n\ninterface Props {\n  initialUrl: string | null;\n  onApply: (url: string) => void;\n}\n\nexport const ImageUpload: FC<Props> = ({ initialUrl, onApply }: Props) => {\n  const [imageUrl, setImageUrl] = useState<string | null>(null);\n\n  useEffect(() => {\n    setImageUrl(initialUrl);\n  }, [initialUrl]);\n\n  const onFileChange = (event: ChangeEvent<HTMLInputElement>): void => {\n    const files = event!.target!.files;\n    if (files && files.length > 0) {\n      const file = files[0];\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const url = reader.result as string;\n        setImageUrl(url);\n      };\n\n      reader.readAsDataURL(file);\n    }\n  };\n  const onResetImage = (): void => {\n    setImageUrl(null);\n  };\n\n  const onNext = (): void => {\n    onApply(imageUrl!);\n  };\n\n  return (\n    <>\n      {!!imageUrl || (\n        <div className=\"row mt-3\">\n          <div className=\"col-md-12\">\n            <ExplanationBox>\n              Select a image from your computer, that should be used as map.\n              <br />\n              This file is <em>not</em> uploaded in the internet but stored in\n              your browser ...\n            </ExplanationBox>\n            <div className=\"custom-file\">\n              <input\n                type=\"file\"\n                className=\"custom-file-input\"\n                id=\"customFile\"\n                onChange={onFileChange}\n              />\n              <label className=\"custom-file-label\" htmlFor=\"customFile\">\n                Choose file\n              </label>\n            </div>\n          </div>\n        </div>\n      )}\n      {!!imageUrl && (\n        <div className=\"row mt-3\">\n          <div className=\"col-md-12\">\n            <div>\n              <button\n                className=\"btn btn-secondary btn-sm\"\n                type=\"button\"\n                onClick={onResetImage}\n              >\n                Change\n              </button>\n            </div>\n            <img\n              className=\"img-thumbnail gridMap-form_image-preview\"\n              src={imageUrl}\n            />\n          </div>\n        </div>\n      )}\n      <div className=\"row mt-3\">\n        <div className=\"col-md-12\">\n          <button\n            className=\"btn btn-sm btn-success mt-2\"\n            disabled={!imageUrl}\n            onClick={onNext}\n            type=\"button\"\n          >\n            <Octicon icon={Check} />\n            Next\n          </button>\n        </div>\n      </div>\n    </>\n  );\n};\n","export const range = (n: number): ReadonlyArray<number> => [...Array(n).keys()];\n","export type MouseEventOnSvg = {\n  currentTarget: SVGGraphicsElement;\n  clientX: number;\n  clientY: number;\n};\ntype PointLike = { x: number; y: number };\n\nexport function pointInSvgFromEvent(\n  e: MouseEventOnSvg,\n  target: SVGGraphicsElement = e.currentTarget\n): PointLike {\n  const element = target!;\n  const svgPoint = element.ownerSVGElement!.createSVGPoint();\n  svgPoint.x = e.clientX;\n  svgPoint.y = e.clientY;\n  const pointInSvg = svgPoint.matrixTransform(\n    element.getScreenCTM()!.inverse()\n  );\n  return pointInSvg;\n}\n","import { Point } from \"./types\";\n\nexport const pointDistance = (p1: Point, p2: Point): number => {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n};\n","import { Point } from \"./types\";\nimport { PointerEvent as ReactPointerEvent, useRef, useState } from \"react\";\nimport { pointInSvgFromEvent } from \"./pointInSvgFromEvent\";\nimport { pointDistance } from \"./pointDistance\";\n\nexport interface SvgDraggingConfig {\n  onStart: (this: SvgDraggingConfig, p: Point) => void;\n  onMove: (this: SvgDraggingConfig, p: Point) => void;\n  onFinished: (this: SvgDraggingConfig, p: Point) => void;\n  onCancel: () => void;\n}\n\nexport interface SvgDrag {\n  dragging: boolean;\n  eventHandler: {\n    onPointerDown: (e: ReactPointerEvent<SVGGraphicsElement>) => void;\n  };\n}\n\nexport const useDragSvg = (config: SvgDraggingConfig): SvgDrag => {\n  const draggingRef = useRef(false);\n  const [returnedDragging, setReturnedDragging] = useState(false);\n  const startPoint = useRef<Point | null>(null);\n  const configRef = useRef(config);\n  configRef.current = config;\n\n  const setDragging = (dragging: boolean): void => {\n    draggingRef.current = dragging;\n    setReturnedDragging(dragging);\n  };\n\n  const onPointerDown = (e: ReactPointerEvent<SVGGraphicsElement>): void => {\n    const svgTarget = e.currentTarget;\n    const point = pointInSvgFromEvent(e);\n    if (!draggingRef.current) {\n      setDragging(true);\n      startPoint.current = point;\n      configRef.current.onStart(point);\n\n      const onPointerMove = (e: PointerEvent): void => {\n        const point = pointInSvgFromEvent({\n          clientX: e.clientX,\n          clientY: e.clientY,\n          currentTarget: svgTarget\n        });\n        configRef.current.onMove(point);\n      };\n\n      const onPointerUp = (e: PointerEvent): void => {\n        const point = pointInSvgFromEvent({\n          clientX: e.clientX,\n          clientY: e.clientY,\n          currentTarget: svgTarget\n        });\n\n        const d = startPoint.current\n          ? pointDistance(startPoint.current, point)\n          : -1;\n\n        if (d > 0.5) {\n          configRef.current.onFinished(point);\n          setDragging(false);\n          document.removeEventListener(\"pointermove\", onPointerMove);\n          document.removeEventListener(\"pointerup\", onPointerUp);\n        }\n      };\n\n      document.addEventListener(\"pointermove\", onPointerMove);\n      document.addEventListener(\"pointerup\", onPointerUp);\n    }\n  };\n\n  return {\n    dragging: returnedDragging,\n    eventHandler: {\n      onPointerDown\n    }\n  };\n};\n","import React, { FC, useState } from \"react\";\nimport { range } from \"../../../../utils/range\";\nimport { Point } from \"../../../../utils/types\";\nimport { SvgDrag, useDragSvg } from \"../../../../utils/useDragSvg\";\n\nexport interface Rect {\n  x: number;\n  y: number;\n  a: number;\n}\n\ninterface Props {\n  width: number;\n  height: number;\n  onChange: (rect: Rect | null) => void;\n}\n\nexport const SelectionRect: FC<Props> = ({\n  width,\n  height,\n  onChange\n}: Props) => {\n  const [selectionRect, setSelectionRect] = useState<Rect | null>(null);\n  const updateRect = (rect: Rect | null): void => {\n    setSelectionRect(rect);\n    onChange(\n      rect\n        ? { x: rect.x + rect.a / 3, y: rect.y + rect.a / 3, a: rect.a / 3 }\n        : null\n    );\n  };\n\n  const strokeSize = width / 600;\n\n  const dragRect = useDragSvg({\n    onStart: ({ x, y }) => {\n      setSelectionRect({ x, y, a: 0 });\n    },\n    onMove: ({ x, y }) => {\n      if (selectionRect) {\n        const dx = x - selectionRect.x;\n        const dy = y - selectionRect.y;\n        const a = Math.max(0, Math.max(dx, dy));\n        updateRect({ ...selectionRect, a });\n      }\n    },\n    onFinished: function(p) {\n      this.onMove(p);\n    },\n    onCancel: () => {\n      updateRect(null);\n    }\n  });\n\n  const useDragCorner = (\n    changeRect: (point: Point, rect: Rect) => Rect\n  ): SvgDrag => {\n    const cornerDragging = useDragSvg({\n      onStart: ({ x, y }) => {},\n      onMove: point => {\n        if (selectionRect) {\n          updateRect(changeRect(point, selectionRect));\n        }\n      },\n      onFinished: function(p) {\n        this.onMove(p);\n      },\n      onCancel: () => {\n        setSelectionRect(null);\n      }\n    });\n    return cornerDragging;\n  };\n\n  const dragCornerMatrix = [\n    [\n      useDragCorner(({ x, y }, rect) => {\n        const d = Math.max(rect.x - x, rect.y - y);\n        return {\n          x: rect.x - d,\n          y: rect.y - d,\n          a: rect.a + d\n        };\n      }),\n      useDragCorner(({ x, y }, rect) => {\n        const d = Math.max(rect.x - x, y - rect.y - rect.a);\n        return {\n          ...rect,\n          x: rect.x - d,\n          a: rect.a + d\n        };\n      })\n    ],\n    [\n      useDragCorner(({ x, y }, rect) => {\n        const d = Math.max(x - rect.x - rect.a, rect.y - y);\n        return {\n          ...rect,\n          y: rect.y - d,\n          a: rect.a + d\n        };\n      }),\n      useDragCorner(({ x, y }, rect) => {\n        return {\n          ...rect,\n          a: Math.max(x - rect.x, y - rect.y)\n        };\n      })\n    ]\n  ];\n\n  return (\n    <g>\n      <rect\n        fillOpacity={0.01}\n        x={0}\n        y={0}\n        width={width}\n        height={height}\n        {...dragRect.eventHandler}\n      />\n      {selectionRect && (\n        <g>\n          {range(3).flatMap(x =>\n            range(3).map(y => (\n              <rect\n                key={`${x}/${y}`}\n                x={selectionRect.x + (x * selectionRect.a) / 3}\n                y={selectionRect.y + (y * selectionRect.a) / 3}\n                width={selectionRect.a / 3}\n                height={selectionRect.a / 3}\n                stroke={dragRect.dragging ? \"#0f86ff\" : \"red\"}\n                fillOpacity={0}\n                strokeDasharray={`${strokeSize} ${strokeSize}`}\n                strokeWidth={strokeSize}\n              />\n            ))\n          )}\n          {!dragRect.dragging &&\n            range(2).flatMap(x =>\n              range(2).map(y => {\n                const drag = dragCornerMatrix[x][y];\n                return (\n                  <rect\n                    key={`${x}/${y}`}\n                    x={selectionRect.x + x * selectionRect.a - strokeSize * 2}\n                    y={selectionRect.y + y * selectionRect.a - strokeSize * 2}\n                    width={strokeSize * 4}\n                    height={strokeSize * 4}\n                    strokeOpacity={0}\n                    fill={drag.dragging ? \"#0f86ff\" : \"red\"}\n                    {...drag.eventHandler}\n                  />\n                );\n              })\n            )}\n        </g>\n      )}\n    </g>\n  );\n};\n","import React, { FC, ReactNode, useEffect, useState } from \"react\";\nimport Octicon, {\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight,\n  ArrowUp,\n  DiffAdded,\n  DiffRemoved,\n  Icon\n} from \"@primer/octicons-react\";\nimport { Transformation } from \"../../../../../model/Transformation\";\n\ninterface Props {\n  transformation: Transformation;\n  onTransformationChange: (t: Transformation) => void;\n}\n\nexport const ViewControls: FC<Props> = ({\n  transformation: transformationFromProps,\n  onTransformationChange\n}: Props) => {\n  const [transformation, setTransformation] = useState(transformationFromProps);\n\n  useEffect(() => {\n    setTransformation(transformationFromProps);\n  }, [transformationFromProps]);\n\n  const updateTransformation = (t: Transformation): void => {\n    setTransformation(t);\n    onTransformationChange(t);\n  };\n\n  const translateFactor = 100;\n\n  const offsetXPlus = (): void => {\n    updateTransformation(\n      transformation.with({\n        dx: transformation.dx - transformation.scale * translateFactor\n      })\n    );\n  };\n\n  const offsetXMinus = (): void => {\n    updateTransformation(\n      transformation.with({\n        dx: transformation.dx + transformation.scale * translateFactor\n      })\n    );\n  };\n\n  const offsetYPlus = (): void => {\n    updateTransformation(\n      transformation.with({\n        dy: transformation.dy - transformation.scale * translateFactor\n      })\n    );\n  };\n\n  const offsetYMinus = (): void => {\n    updateTransformation(\n      transformation.with({\n        dy: transformation.dy + transformation.scale * translateFactor\n      })\n    );\n  };\n\n  const zoomIn = (): void => {\n    updateTransformation(\n      transformation.with({ scale: transformation.scale + 0.1 })\n    );\n  };\n\n  const zoomOut = (): void => {\n    updateTransformation(\n      transformation.with({ scale: transformation.scale - 0.1 })\n    );\n  };\n\n  const button = (icon: Icon, fn: () => void): ReactNode => {\n    return (\n      <button\n        className=\"btn btn-sm btn-secondary ml-2\"\n        onClick={fn}\n        type=\"button\"\n      >\n        <Octicon icon={icon} />\n      </button>\n    );\n  };\n\n  return (\n    <>\n      {button(DiffAdded, zoomIn)}\n      {button(DiffRemoved, zoomOut)}\n      {button(ArrowUp, offsetYMinus)}\n      {button(ArrowDown, offsetYPlus)}\n      {button(ArrowLeft, offsetXMinus)}\n      {button(ArrowRight, offsetXPlus)}\n    </>\n  );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { Transformation } from \"../../../../model/Transformation\";\nimport Octicon, { Check } from \"@primer/octicons-react\";\nimport { BackgroundImage } from \"../../../../model/BackgroundImage\";\nimport { ExplanationBox } from \"../../../../common/ExplanationBox\";\nimport { SelectionRect } from \"./SelectionRect\";\nimport { Rect } from \"../../../../utils/types\";\nimport { ViewControls } from \"./common/ViewControls\";\n\nconst viewPositionToLabel = {\n  center: \"center\",\n  \"left-top\": \"top left corner\",\n  \"right-bottom\": \"bottom right corner\"\n};\n\ninterface Props {\n  image: BackgroundImage;\n  onApply: (rect: Rect) => void;\n  viewPosition: \"center\" | \"left-top\" | \"right-bottom\";\n}\n\nexport const PlaceSquare: FC<Props> = ({\n  image,\n  onApply,\n  viewPosition\n}: Props) => {\n  const [transformation, setTransformation] = useState(\n    Transformation.default()\n  );\n\n  const [rect, setRect] = useState<null | Rect>(null);\n\n  useEffect(() => {\n    const scale = (600 / image.width) * 2;\n\n    const t = Transformation.default().with({\n      scale: scale,\n      dx: viewPosition === \"left-top\" ? 0 : -(image.width - 600 / scale),\n      dy: viewPosition === \"left-top\" ? 0 : -(image.height - 600 / scale)\n    });\n    setTransformation(t);\n  }, [image, viewPosition]);\n\n  const apply = (): void => {\n    if (!rect) {\n      return;\n    }\n\n    onApply(rect);\n  };\n\n  return (\n    <>\n      <div className=\"row mt-3\">\n        <div className=\"col-md-12\">\n          <ExplanationBox>\n            For calculating the grid position, draw a rect over the image where\n            9 squares of the battle grid should be displayed later. Try to\n            select an area in the\n            <em>{viewPositionToLabel[viewPosition]}</em> of the map.\n            <br />\n          </ExplanationBox>\n\n          <div className=\"mb-2\">\n            <ViewControls\n              transformation={transformation}\n              onTransformationChange={setTransformation}\n            />\n          </div>\n          <svg style={{ width: 600, height: 600 }} className=\"img-thumbnail\">\n            <g transform={transformation.asTransformString()}>\n              <image\n                width={image.width}\n                height={image.height}\n                xlinkHref={image.url}\n              />\n              <SelectionRect\n                width={image.width}\n                height={image.width}\n                onChange={setRect}\n              />\n            </g>\n          </svg>\n          <div>\n            <button\n              className=\"btn btn-sm btn-success mt-2\"\n              onClick={apply}\n              type=\"button\"\n              disabled={!rect}\n            >\n              <Octicon icon={Check} />\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\n","import React, { FC, ReactNode, useState } from \"react\";\nimport { Transformation } from \"../../../../model/Transformation\";\nimport Octicon, {\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight,\n  ArrowUp,\n  Check,\n  DiffAdded,\n  DiffRemoved,\n  Icon,\n  ScreenFull,\n  ScreenNormal\n} from \"@primer/octicons-react\";\nimport { BackgroundImage } from \"../../../../model/BackgroundImage\";\nimport { range } from \"../../../../utils/range\";\nimport { ExplanationBox } from \"../../../../common/ExplanationBox\";\nimport { ViewControls } from \"./common/ViewControls\";\n\ninterface Props {\n  image: BackgroundImage;\n  imageTransformation: Transformation;\n  onApply: (t: Transformation) => void;\n}\n\ninterface Rect {\n  x: number;\n  y: number;\n  a: number;\n}\n\nexport const PreviewGrid: FC<Props> = ({\n  image,\n  onApply,\n  imageTransformation\n}: Props) => {\n  const [viewTransformation, setViewTransformation] = useState(\n    Transformation.default()\n  );\n\n  const apply = (): void => {\n    onApply(imageTransformation);\n  };\n\n  const xSquareCount = Math.ceil(image.width * imageTransformation.scale + 1);\n  const ySquareCount = Math.ceil(image.height * imageTransformation.scale + 1);\n\n  return (\n    <>\n      <div className=\"row mt-3\">\n        <div className=\"col-md-12\">\n          <ExplanationBox>\n            As I promised! Here you can make last adjustments to the grid ...\n          </ExplanationBox>\n          <div className=\"mb-2\">\n            <ViewControls\n              transformation={viewTransformation}\n              onTransformationChange={setViewTransformation}\n            />\n          </div>\n          <svg\n            style={{ width: 600, height: 600 }}\n            viewBox={`0 0 ${xSquareCount} ${ySquareCount}`}\n            className=\"img-thumbnail\"\n          >\n            <g transform={viewTransformation.asTransformString()}>\n              <g transform={imageTransformation.asTransformString()}>\n                <image\n                  width={image.width}\n                  height={image.height}\n                  xlinkHref={image.url}\n                />\n              </g>\n              {range(xSquareCount).map(x => {\n                return range(ySquareCount).map(y => {\n                  return (\n                    <rect\n                      key={`${x}/${y}`}\n                      x={x}\n                      y={y}\n                      width=\"1\"\n                      height=\"1\"\n                      stroke=\"red\"\n                      strokeWidth={0.03}\n                      fillOpacity={0}\n                    />\n                  );\n                });\n              })}\n            </g>\n          </svg>\n\n          <div>\n            <button\n              className=\"btn btn-sm btn-success mt-2\"\n              onClick={apply}\n              type=\"button\"\n            >\n              <Octicon icon={Check} />\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\n","import React, { FC, useState } from \"react\";\nimport { Transformation } from \"../../../model/Transformation\";\nimport { PlaceSquare } from \"./TransformationSetup/PlaceSquare\";\nimport { PreviewGrid } from \"./TransformationSetup/PreviewGrid\";\nimport { BackgroundImage } from \"../../../model/BackgroundImage\";\nimport { Rect } from \"../../../utils/types\";\n\ninterface Props {\n  image: BackgroundImage;\n  onApply: (t: Transformation) => void;\n  onStep: (stage: \"exampleRect1\" | \"exampleRect2\" | \"preview\") => void;\n}\n\nexport const TransformationSetup: FC<Props> = ({\n  image,\n  onApply,\n  onStep\n}: Props) => {\n  const [rect1, setRect1] = useState<Rect | null>(null);\n  const [transformation, setTransformation] = useState<Transformation | null>(\n    null\n  );\n\n  const calculateTransformation = (r1: Rect, r2: Rect): Transformation => {\n    const averageA = (r1.a + r2.a) / 2;\n\n    const distanceX = Math.abs(r2.x - r1.x);\n    const squareCountX = Math.round(distanceX / averageA);\n    const calculatedAX = distanceX / squareCountX;\n\n    const distanceY = Math.abs(r2.y - r1.y);\n    const squareCountY = Math.round(distanceY / averageA);\n    const calculatedAY = distanceY / squareCountY;\n\n    const calculatedA = (calculatedAX + calculatedAY) / 2;\n\n    const dx1 = -r1.x % calculatedA;\n    const dx2 = -r2.x % calculatedA;\n    const dx = (dx1 + dx2) / 2;\n\n    const dy1 = -r1.y % calculatedA;\n    const dy2 = -r2.y % calculatedA;\n    const dy = (dy1 + dy2) / 2;\n\n    return Transformation.of({ scale: 1 / calculatedA, dx, dy });\n  };\n\n  if (!rect1) {\n    onStep(\"exampleRect1\");\n  }\n\n  return (\n    <>\n      {image && !rect1 && (\n        <PlaceSquare\n          viewPosition=\"left-top\"\n          image={image}\n          onApply={r => {\n            setRect1(r);\n            onStep(\"exampleRect2\");\n          }}\n        />\n      )}\n      {image && rect1 && !transformation && (\n        <PlaceSquare\n          viewPosition=\"center\"\n          image={image}\n          onApply={r => {\n            onStep(\"preview\");\n            setTransformation(calculateTransformation(rect1!, r));\n          }}\n        />\n      )}\n      {image && rect1 && transformation && (\n        <PreviewGrid\n          image={image}\n          imageTransformation={transformation}\n          onApply={r => {\n            onApply(transformation);\n          }}\n        />\n      )}\n    </>\n  );\n};\n","import React, { FC, useState } from \"react\";\nimport Octicon, { Tag } from \"@primer/octicons-react\";\n\ninterface Props {\n  onSave: (name: string) => void;\n}\n\nexport const AddMetadata: FC<Props> = ({ onSave }: Props) => {\n  const [name, setName] = useState<undefined | string>(\"\");\n  return (\n    <>\n      <div className=\"row mt-3\">\n        <div className=\"col-md-12\">\n          <div className=\"alert alert-primary\">\n            Last step provide a good name for the map ... and your done :D\n          </div>\n          <div className=\"input-group mb-2\">\n            <div className=\"input-group-prepend\">\n              <div className=\"input-group-text\">\n                <Octicon icon={Tag} />\n              </div>\n            </div>\n            <input\n              type=\"text\"\n              className=\"form-control\"\n              placeholder=\"Background Name\"\n              onChange={(e): void => {\n                setName(e.target.value);\n              }}\n              value={name}\n            />\n          </div>\n        </div>\n      </div>\n      <div className=\"row mt-3\">\n        <div className=\"col-md-12\">\n          <button\n            className=\"btn btn-success\"\n            type=\"button\"\n            onClick={(): void => {\n              name && onSave(name);\n            }}\n          >\n            Save\n          </button>\n        </div>\n      </div>\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport Octicon, { ChevronRight, Star, Verified } from \"@primer/octicons-react\";\n\n// KISS :D\ninterface Props {\n  steps: ReadonlyArray<string>;\n  active: string;\n}\n\nexport const StepIndicator: FC<Props> = ({ steps, active }: Props) => {\n  const activeIndex = steps.indexOf(active);\n  return (\n    <>\n      <div>\n        {steps.map((step, i) => {\n          const current = i === activeIndex;\n          const future = i > activeIndex;\n          return (\n            <span key={step}>\n              <span\n                className={`badge badge-${\n                  current ? \"primary\" : future ? \"secondary\" : \"success\"\n                } ml-2 mr-2`}\n              >\n                {current && <Octicon icon={Star} />}\n                {step}\n              </span>\n              <Octicon icon={ChevronRight} />\n            </span>\n          );\n        })}\n        <span className=\"badge badge-dark  ml-2 mr-2\">\n          <Octicon icon={Verified} /> Finished\n        </span>\n      </div>\n    </>\n  );\n};\n","import React, { FC, useState } from \"react\";\nimport { GridMap } from \"../../model/GridMap\";\nimport { ImageUpload } from \"./AddGridMap/ImageUpload\";\nimport { BackgroundImage as ImageModel } from \"../../model/BackgroundImage\";\nimport { Transformation } from \"../../model/Transformation\";\nimport { TransformationSetup } from \"./AddGridMap/TransformationSetup\";\nimport { AddMetadata } from \"./AddGridMap/AddMetadata\";\nimport { StepIndicator } from \"../../common/StepIndicator\";\nimport Octicon, { X } from \"@primer/octicons-react\";\n\ninterface Props {\n  onSave: (gridMapImage: GridMap) => void;\n  onCancel: () => void;\n}\n\nconst steps = {\n  upload: \"Upload Image\",\n  selectSquare1: \"Select Example Square 1\",\n  selectSquare2: \"Select Example Square 2\",\n  previewGrid: \"Preview Grid\",\n  metadata: \"Add Metadata\"\n};\nexport const AddGridMap: FC<Props> = ({ onSave, onCancel }: Props) => {\n  const [image, setImage] = useState<ImageModel | null>(null);\n  const [step, setStep] = useState<string>(steps.upload);\n  const [transformation, setTransformation] = useState<Transformation | null>(\n    null\n  );\n\n  const saveGridMap = (name: string): void => {\n    if (!name || !image || !transformation) {\n      return;\n    }\n    onSave(GridMap.of({ name, image, transformation }));\n  };\n\n  const setImageFromUrl = (url: string): void => {\n    if (url) {\n      const img = new Image();\n\n      img.onload = function() {\n        setImage(new ImageModel(url, img.width, img.height));\n      };\n\n      img.src = url;\n    } else {\n      setImage(null);\n    }\n  };\n\n  return (\n    <div className=\"card\">\n      <div className=\"card-header\">\n        <a\n          href=\"#\"\n          className=\"btn btn-secondary float-right\"\n          onClick={event => {\n            event.preventDefault();\n            onCancel();\n          }}\n        >\n          <Octicon icon={X} />\n        </a>\n        <h5>Add Map</h5>\n      </div>\n\n      <div className=\"card-body\">\n        <StepIndicator steps={Object.values(steps)} active={step} />\n        {!image && (\n          <ImageUpload\n            initialUrl={null}\n            onApply={url => {\n              setImageFromUrl(url);\n              setStep(steps.selectSquare1);\n            }}\n          />\n        )}\n        {image && !transformation && (\n          <TransformationSetup\n            image={image}\n            onApply={transformation => {\n              setTransformation(transformation);\n              setStep(steps.metadata);\n            }}\n            onStep={step =>\n              setStep(\n                step === \"exampleRect1\"\n                  ? steps.selectSquare1\n                  : step === \"exampleRect2\"\n                  ? steps.selectSquare2\n                  : steps.previewGrid\n              )\n            }\n          />\n        )}\n        {image && transformation && (\n          <AddMetadata\n            onSave={name => {\n              saveGridMap(name);\n            }}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\nimport Octicon, { Icon } from \"@primer/octicons-react\";\n\ninterface Props {\n  icon: Icon;\n  headline: string;\n  children: ReactNode;\n}\n\nexport const PageHeader: FC<Props> = ({ icon, headline, children }: Props) => {\n  return (\n    <>\n      <h1>\n        <Octicon icon={icon} size={40} />\n        <span className=\"ml-4\">{headline}</span>\n      </h1>\n      {children}\n    </>\n  );\n};\n","import React, { FC, ReactNodeArray } from \"react\";\nimport { Icon } from \"@primer/octicons-react\";\nimport { PageHeader } from \"./PageHeader\";\n\ninterface Props {\n  icon: Icon;\n  headline: string;\n  children: ReactNodeArray;\n}\n\nexport const PageHeaderWithButtons: FC<Props> = ({\n  icon,\n  headline,\n  children\n}: Props) => {\n  return (\n    <PageHeader icon={icon} headline={headline}>\n      <div className=\"ml-5 mt-3 mb-3 text-left\">\n        {React.Children.map(children, (child, i) => (\n          <>\n            {i !== 0 && <span className=\"ml-2\" />}\n            {child}\n          </>\n        ))}\n      </div>\n    </PageHeader>\n  );\n};\n","import React, { FC, useCallback, useEffect, useState } from \"react\";\nimport { GridMapStorage } from \"../services/GridMapStorage\";\nimport { GridMap } from \"../model/GridMap\";\nimport { GridMapList } from \"../common/GridMapList\";\nimport { FullPageWithHeading } from \"../common/FullPageWithHeading\";\nimport { AddGridMap } from \"./GridMapsApp/AddGridMap\";\nimport Octicon, { FileMedia, Plus, Trashcan } from \"@primer/octicons-react\";\nimport { ExplanationBox } from \"../common/ExplanationBox\";\nimport { PageHeaderWithButtons } from \"../common/PageHeaderWithButtons\";\nimport { StorageProvider } from \"../services/StorageProvider\";\n\ninterface Props {\n  storageProvider: StorageProvider;\n}\n\nexport const GridMapsApp: FC<Props> = ({ storageProvider }: Props) => {\n  const [create, setCreate] = useState(false);\n  const [selected, setSelected] = useState<GridMap | null>(null);\n  const [gridMapStorage] = useState(() => new GridMapStorage(storageProvider));\n  const [gridMaps, setGridMaps] = useState<ReadonlyArray<GridMap>>([]);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const reload = useCallback((): void => {\n    gridMapStorage.findAll().subscribe({ next: setGridMaps });\n  }, [gridMapStorage]);\n  useEffect(() => {\n    reload();\n  }, [reload]);\n\n  const heading = (\n    <PageHeaderWithButtons icon={FileMedia} headline=\"Manage Maps\">\n      {!create && (\n        <button className=\"btn btn-primary\" onClick={() => setCreate(true)}>\n          <Octicon icon={Plus} />\n          <span className=\"ml-2\">New Map</span>\n        </button>\n      )}\n      {!create && selected && (\n        <>\n          <button\n            type=\"button\"\n            className=\"btn btn-danger ml-2\"\n            onClick={() => {\n              gridMapStorage.delete(selected.name);\n              setSelected(null);\n              reload();\n            }}\n          >\n            <Octicon icon={Trashcan} />\n            Delete Selected Map\n          </button>\n        </>\n      )}\n    </PageHeaderWithButtons>\n  );\n\n  return (\n    <>\n      <FullPageWithHeading heading={heading}>\n        <ExplanationBox>\n          <strong>Maps</strong> are stored images with a grid drawn over them.\n          <br />\n          You create a map by selecting an image file on your computer and\n          configure a grid for them. The images are stored locally in your\n          browser local storage and are not sent to the internet.\n        </ExplanationBox>\n        {!create && (\n          <div>\n            <div className=\"col-md-12\">\n              <GridMapList\n                gridMaps={gridMaps}\n                selected={selected}\n                onSelect={setSelected}\n              />\n            </div>\n          </div>\n        )}\n        {create && (\n          <div className=\"row\">\n            <div className=\"col-md-12\">\n              <AddGridMap\n                onSave={gridMapImage => {\n                  gridMapStorage.store(gridMapImage);\n                  reload();\n                  setCreate(false);\n                }}\n                onCancel={() => setCreate(false)}\n              />\n            </div>\n          </div>\n        )}\n      </FullPageWithHeading>\n    </>\n  );\n};\n","export type ClassesMap = { [className: string]: boolean };\nexport const classesMap = (classNameMap: ClassesMap): string => {\n  const selectedClassNames = Object.keys(classNameMap).filter(\n    className => classNameMap[className]\n  );\n\n  return selectedClassNames.join(\" \");\n};\n","import React, { FC, ReactNode, useRef, useState } from \"react\";\nimport { classesMap } from \"../../utils/classesMap\";\n\ninterface Props {\n  children: ReactNode;\n  buttonContent: ReactNode;\n  buttonClasses: string;\n}\n\nexport const DropDownContext = React.createContext<() => void>(() => {});\nexport const DropDown: FC<Props> = ({\n  buttonContent,\n  children,\n  buttonClasses\n}: Props) => {\n  const dropDownElementRef = useRef<HTMLDivElement>(null);\n  const [show, setShow] = useState(false);\n  const onOpen = (): void => setShow(!show);\n  const close = (): void => setShow(false);\n  return (\n    <>\n      <div\n        ref={dropDownElementRef}\n        className={classesMap({\n          dropright: true,\n          show: show\n        })}\n      >\n        <a\n          href=\"#\"\n          onClick={event => {\n            event.preventDefault();\n            onOpen();\n          }}\n          className={\"btn \" + buttonClasses}\n        >\n          {buttonContent}\n        </a>\n        <div\n          className={classesMap({\n            \"dropdown-menu\": true,\n            show: show\n          })}\n        >\n          <DropDownContext.Provider value={close}>\n            {children}\n          </DropDownContext.Provider>\n        </div>\n      </div>\n    </>\n  );\n};\n","import React, { FC, ReactNode, useContext } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { DropDownContext } from \"./DropDown\";\n\ninterface Props {\n  to: string;\n  children: ReactNode;\n}\n\nexport const LinkDropdownItem: FC<Props> = ({ to, children }: Props) => {\n  const closeDropDown = useContext(DropDownContext);\n  return (\n    <Link className=\"dropdown-item\" to={to} onClick={() => closeDropDown()}>\n      {children}\n    </Link>\n  );\n};\n","import React, { FC } from \"react\";\n\ninterface Props {}\n\nexport const DividerDropdownItem: FC<Props> = ({  }: Props) => {\n  return <div className=\"dropdown-divider\"></div>;\n};\n","import React, { FC } from \"react\";\nimport Octicon, {\n  FileMedia,\n  Info,\n  Key,\n  Law,\n  Play,\n  Repo,\n  ThreeBars\n} from \"@primer/octicons-react\";\nimport { DropDown } from \"../common/dropdown/DropDown\";\nimport { LinkDropdownItem } from \"../common/dropdown/LinkDropdownItem\";\nimport { routing } from \"../App\";\nimport { DividerDropdownItem } from \"../common/dropdown/DividerDropdownItem\";\n\ninterface Props {}\n\nexport const GlobalMenu: FC<Props> = ({  }: Props) => {\n  return (\n    <>\n      <div className=\"navbar navbar-dark bg-dark logo-menu\">\n        <DropDown\n          buttonContent={\n            <div>\n              <div className=\"position-absolute\">\n                <Octicon icon={ThreeBars} width={30} height={50} />\n              </div>\n            </div>\n          }\n          buttonClasses=\"mb-md-2 btn-outline-primary logo-button\"\n        >\n          <LinkDropdownItem to={routing.play}>\n            <Octicon icon={Play} /> Play\n          </LinkDropdownItem>\n          <LinkDropdownItem to={routing.sessions}>\n            <Octicon icon={Repo} /> Sessions\n          </LinkDropdownItem>\n          <DividerDropdownItem />\n          <LinkDropdownItem to={routing.manageGridMaps}>\n            <Octicon icon={FileMedia} /> Manage Maps\n          </LinkDropdownItem>\n          {/*<LinkDropdownItem to={routing.manageTokenTypes}>Manage Token Types (Placeholder)</LinkDropdownItem>*/}\n          <DividerDropdownItem />\n          <LinkDropdownItem to={routing.about}>\n            <Octicon icon={Info} /> About\n          </LinkDropdownItem>\n          <a\n            className=\"dropdown-item\"\n            href=\"https://legal.comsysto.com/comsysto.github.io/de/impressum/\"\n          >\n            <Octicon icon={Law} /> Impressum\n          </a>\n          <a\n            className=\"dropdown-item\"\n            href=\"https://legal.comsysto.com/comsysto.github.io/en/datenschutz/\"\n          >\n            <Octicon icon={Key} /> Data Privacy\n          </a>\n        </DropDown>\n      </div>\n    </>\n  );\n};\n","import { PropsOf, SomePropsOf } from \"../utils/types\";\n\nexport class Session {\n  static readonly STORAGE_KEY_PREFIX = \"session-\";\n  static readonly CURRENT_SESSION_STORAGE_KEY = \"current-session\";\n\n  static storageKey(sessionName: string): string {\n    return `${this.STORAGE_KEY_PREFIX}${sessionName}`;\n  }\n\n  static isStorageKey(key: string): boolean {\n    return key.startsWith(this.STORAGE_KEY_PREFIX);\n  }\n\n  public static of(props: PropsOf<Session>): Session {\n    return Object.freeze(\n      new Session(props.name, props.date, props.gridMapName, props.content)\n    );\n  }\n\n  private constructor(\n    readonly name: string,\n    readonly date: string,\n    readonly gridMapName: string,\n    readonly content: { [name: string]: any }\n  ) {}\n\n  with(props: SomePropsOf<Session>): Session {\n    const copy = new Session(\n      this.name,\n      this.date,\n      this.gridMapName,\n      this.content\n    );\n    return Object.freeze(Object.assign(copy, props));\n  }\n}\n","import { AbstractStorage } from \"./AbstractStorage\";\nimport { Session } from \"../model/Session\";\nimport { Observable } from \"rxjs\";\n\nexport class SessionStorage extends AbstractStorage<Session, string> {\n  protected readonly isStorageKey = (key: string): boolean =>\n    Session.isStorageKey(key);\n\n  protected readonly parseJson = (json: any): Session => {\n    return Session.of({\n      name: json.name,\n      date: json.date,\n      gridMapName: json.gridMapName,\n      content: json.content\n    });\n  };\n\n  protected readonly toStorageKey = (session: Session): string =>\n    Session.storageKey(session.name);\n\n  storeCurrentSessionName(name: string): Observable<void> {\n    return this.storageProvider.set(Session.CURRENT_SESSION_STORAGE_KEY, name);\n  }\n\n  findCurrentSessionName(): Observable<string | null> {\n    return this.storageProvider.get(Session.CURRENT_SESSION_STORAGE_KEY);\n  }\n\n  protected readonly keyToStorageKey = (name: string): string =>\n    Session.storageKey(name);\n}\n","import React, { FC, useState } from \"react\";\nimport { StepIndicator } from \"../../common/StepIndicator\";\nimport { Session } from \"../../model/Session\";\nimport { GridMapList } from \"../../common/GridMapList\";\nimport { GridMap } from \"../../model/GridMap\";\nimport Octicon, { Tag, X } from \"@primer/octicons-react\";\nimport { ExplanationBox } from \"../../common/ExplanationBox\";\n\ninterface Props {\n  onSave: (session: Session) => void;\n  onCancel: () => void;\n  gridMaps: ReadonlyArray<GridMap>;\n}\n\nconst steps = {\n  selectBackground: \"Select Background\",\n  metadata: \"Add Metadata\"\n};\nexport const StartSession: FC<Props> = ({\n  onSave,\n  onCancel,\n  gridMaps\n}: Props) => {\n  const [step, setStep] = useState<string>(steps.selectBackground);\n  const [gridMapName, setBackgroundName] = useState<string | undefined>();\n  const [name, setName] = useState<string | undefined>();\n  const save = (): void => {\n    if (!name || !gridMapName) {\n      return;\n    }\n    onSave(\n      Session.of({\n        name,\n        date: new Date().toLocaleString(),\n        gridMapName,\n        content: {}\n      })\n    );\n  };\n\n  return (\n    <div className=\"card\">\n      <div className=\"card-header\">\n        <a\n          href=\"#\"\n          className=\"btn btn-secondary float-right\"\n          onClick={event => {\n            event.preventDefault();\n            onCancel();\n          }}\n        >\n          <Octicon icon={X} />\n        </a>\n        <h5>Start Session</h5>\n      </div>\n\n      <div className=\"card-body\">\n        <StepIndicator steps={Object.values(steps)} active={step} />\n        {!gridMapName && (\n          <div className=\"row mt-3\">\n            <div className=\"col-md-12\">\n              <ExplanationBox>\n                Select a map where you want to play from the list below ...\n              </ExplanationBox>\n\n              <GridMapList\n                gridMaps={gridMaps}\n                selected={null}\n                onSelect={gridMap => {\n                  setBackgroundName(gridMap.name);\n                  setStep(steps.metadata);\n                }}\n              />\n            </div>\n          </div>\n        )}\n        {gridMapName && (\n          <>\n            <div className=\"row mt-3\">\n              <div className=\"col-md-12\">\n                <ExplanationBox>\n                  Provide a memorable name and some other useful information ...\n                  and your done :D\n                </ExplanationBox>\n                <div className=\"input-group mb-2\">\n                  <div className=\"input-group-prepend\">\n                    <div className=\"input-group-text\">\n                      <Octicon icon={Tag} />\n                    </div>\n                  </div>\n                  <input\n                    type=\"text\"\n                    className=\"form-control\"\n                    placeholder=\"Session Name\"\n                    onChange={e => setName(e.target.value)}\n                    value={name}\n                  />\n                </div>\n              </div>\n            </div>\n            <div className=\"row mt-3\">\n              <div className=\"col-md-12\">\n                <button\n                  className=\"btn btn-success\"\n                  type=\"button\"\n                  onClick={() => name && save()}\n                >\n                  Save\n                </button>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n","import React, { FC } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { routing } from \"../../App\";\n\ninterface Props {}\n\nexport const NoGridMapsFound: FC<Props> = ({  }: Props) => {\n  return (\n    <>\n      <h3>No Maps found</h3>\n      <span>\n        Oh no! It seems that you want create a sessions but we can&apos;t find\n        any map :(\n      </span>\n      <br />\n      <br />\n      <span>\n        Please go <Link to={routing.manageGridMaps}>here</Link> to create a map.\n        <br />\n        Afterwards come back via the menu in the top left corner (Sessions) to\n        start a session.\n      </span>\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { ListGroupItemAction } from \"../../common/listgroup/ListGroupItemAction\";\nimport { MediaContainer } from \"../../common/media/MediaContainer\";\nimport { MediaBody } from \"../../common/media/MediaBody\";\nimport { ListGroup } from \"../../common/listgroup/ListGroup\";\nimport { Session } from \"../../model/Session\";\nimport { GridMap } from \"../../model/GridMap\";\nimport { Dict } from \"../../utils/types\";\n\ninterface Props {\n  sessions: ReadonlyArray<Session>;\n  gridMapsForName: Readonly<Dict<GridMap>>;\n  selectedSessionName?: string | null;\n  onSelectSession: (sessionName: string) => void;\n}\n\nexport const SessionList: FC<Props> = ({\n  sessions,\n  gridMapsForName,\n  selectedSessionName,\n  onSelectSession\n}: Props) => {\n  return (\n    <ListGroup>\n      {sessions.map(session => {\n        const gridMap = gridMapsForName[session.gridMapName];\n\n        return (\n          <ListGroupItemAction\n            key={session.name}\n            active={session.name === selectedSessionName}\n            onClick={() => {\n              onSelectSession(session.name);\n            }}\n          >\n            <MediaContainer>\n              <MediaBody>\n                <h4>{session.name}</h4>\n                <dl className=\"row\">\n                  {gridMap && (\n                    <>\n                      <dt className=\"col-sm-3\">Map</dt>\n                      <dd className=\"col-sm-9\">\n                        {gridMap.name} ({gridMap.getWidthInSquares()}x\n                        {gridMap.getHeightInSquares()})\n                      </dd>\n                    </>\n                  )}\n\n                  <dt className=\"col-sm-3\">Date</dt>\n                  <dd className=\"col-sm-9\">{session.date}</dd>\n                </dl>\n                {!gridMap && (\n                  <span className=\"badge badge-pill badge-danger\">\n                    Invalid: Background is missing\n                  </span>\n                )}\n              </MediaBody>\n              {gridMap && (\n                <img\n                  src={gridMap.image.url}\n                  className=\"img-thumbnail image-200\"\n                />\n              )}\n            </MediaContainer>\n          </ListGroupItemAction>\n        );\n      })}\n    </ListGroup>\n  );\n};\n","import React, { FC, useCallback, useEffect, useState } from \"react\";\nimport { FullPageWithHeading } from \"../common/FullPageWithHeading\";\nimport { Session } from \"../model/Session\";\nimport { SessionStorage } from \"../services/SessionStorage\";\nimport { GridMapStorage } from \"../services/GridMapStorage\";\nimport { GridMap } from \"../model/GridMap\";\nimport { Dict } from \"../utils/types\";\nimport Octicon, { Plus, Repo, Trashcan } from \"@primer/octicons-react\";\nimport { StartSession } from \"./SessionsApp/StartSession\";\nimport { NoGridMapsFound } from \"./SessionsApp/NoGridMapsFound\";\nimport { SessionList } from \"./SessionsApp/SessionList\";\nimport { ExplanationBox } from \"../common/ExplanationBox\";\nimport { PageHeaderWithButtons } from \"../common/PageHeaderWithButtons\";\nimport { StorageProvider } from \"../services/StorageProvider\";\nimport { combineLatest } from \"rxjs\";\nimport { arrayToDict } from \"../utils/arrayToDict\";\n\ninterface Props {\n  storageProvider: StorageProvider;\n}\n\nexport const SessionsApp: FC<Props> = ({ storageProvider }: Props) => {\n  const [selectedSessionName, setSelectedSessionName] = useState<string | null>(\n    null\n  );\n  const [create, setCreate] = useState(false);\n  const [sessionStorage] = useState(() => new SessionStorage(storageProvider));\n  const [gridMapStorage] = useState(() => new GridMapStorage(storageProvider));\n  const [sessions, setSessions] = useState<ReadonlyArray<Session>>([]);\n  const [gridMapsForName, setGridMapForName] = useState<\n    Readonly<Dict<GridMap>>\n  >({});\n\n  const reload = useCallback((): void => {\n    combineLatest([\n      sessionStorage.findAll(),\n      gridMapStorage.findAll(),\n      sessionStorage.findCurrentSessionName()\n    ]).subscribe({\n      next: ([sessions, gridMaps, sessionName]) => {\n        setSessions(sessions);\n        setGridMapForName(arrayToDict(gridMaps, gridMap => gridMap.name));\n        setSelectedSessionName(sessionName);\n      }\n    });\n  }, [sessionStorage, gridMapStorage]);\n\n  useEffect(() => {\n    reload();\n  }, [reload]);\n\n  const noBackgrounds = Object.keys(gridMapsForName).length === 0;\n\n  const heading = (\n    <PageHeaderWithButtons icon={Repo} headline=\"Sessions\">\n      {!noBackgrounds && !create && (\n        <button className=\"btn btn-primary\" onClick={() => setCreate(true)}>\n          <Octicon icon={Plus} />\n          <span className=\"ml-2\">Start Session</span>\n        </button>\n      )}\n      {!create && selectedSessionName && (\n        <>\n          <button\n            type=\"button\"\n            className=\"btn btn-danger\"\n            onClick={() => {\n              sessionStorage.delete(selectedSessionName);\n              setSelectedSessionName(null);\n              reload();\n            }}\n          >\n            <Octicon icon={Trashcan} />\n            Delete Selected\n          </button>\n        </>\n      )}\n    </PageHeaderWithButtons>\n  );\n\n  return (\n    <FullPageWithHeading heading={heading}>\n      <ExplanationBox>\n        <strong>Sessions</strong> are the place where all token positions on the\n        map and all drawings are stored.\n        <br />\n        You can switch between sessions on this screen so you can come back to a\n        game later ...\n      </ExplanationBox>\n      {noBackgrounds && <NoGridMapsFound />}\n      {!noBackgrounds && !create && (\n        <div className=\"row\">\n          <div className=\"col-md-12\">\n            <SessionList\n              sessions={sessions}\n              gridMapsForName={gridMapsForName}\n              onSelectSession={sessionName => {\n                setSelectedSessionName(sessionName);\n                sessionStorage.storeCurrentSessionName(sessionName);\n              }}\n              selectedSessionName={selectedSessionName}\n            />\n          </div>\n        </div>\n      )}\n      {!noBackgrounds && create && (\n        <div className=\"row\">\n          <div className=\"col-md-12\">\n            <StartSession\n              onSave={session => {\n                sessionStorage.store(session);\n                reload();\n                setCreate(false);\n              }}\n              onCancel={() => {\n                setCreate(false);\n              }}\n              gridMaps={Object.values(gridMapsForName)}\n            />\n          </div>\n        </div>\n      )}\n    </FullPageWithHeading>\n  );\n};\n","import { Dict } from \"./types\";\n\nexport function arrayToDict<T>(\n  list: ReadonlyArray<T>,\n  fn: (t: T) => string\n): Readonly<Dict<T>> {\n  return list.reduce(\n    (dict, value) => {\n      dict[fn(value)] = value;\n      return dict;\n    },\n    {} as Dict<T>\n  );\n}\n","import React, { FC } from \"react\";\n\ninterface Props {}\n\nexport const ManageTokenTypesApp: FC<Props> = ({  }: Props) => {\n  return (\n    <>\n      <h1>Manage Token Types</h1>\n    </>\n  );\n};\n","export const opensource = Object.freeze({\n  React: {\n    page: \"https://reactjs.org\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/facebook/react/blob/master/LICENSE\"\n  },\n  Bootstrap: {\n    page: \"https://getbootstrap.com\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/twbs/bootstrap/blob/master/LICENSEs\"\n  },\n  \"React Router\": {\n    page: \"https://reacttraining.com/react-router/\",\n    licence: \"MIT\",\n    licenceUrl:\n      \"https://github.com/ReactTraining/react-router/blob/master/LICENSE\"\n  },\n  RxJS: {\n    page: \"https://rxjs-dev.firebaseapp.com/\",\n    licence: \"Apache 2.0\",\n    licenceUrl: \"https://github.com/ReactiveX/rxjs/blob/master/LICENSE.txt\"\n  },\n  Typescript: {\n    page: \"https://www.typescriptlang.org/\",\n    licence: \"Apache 2.0\",\n    licenceUrl:\n      \"https://github.com/microsoft/TypeScript/blob/master/LICENSE.txt\"\n  },\n  Octicons: {\n    page: \"https://octicons.github.com/\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/primer/octicons/blob/master/LICENSE\"\n  },\n  Formik: {\n    page: \"https://jaredpalmer.com/formik/docs/overview\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/jaredpalmer/formik/blob/master/LICENSE\"\n  },\n  Immer: {\n    page: \"https://immerjs.github.io/immer/docs/introduction\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/immerjs/immer/blob/master/LICENSE\"\n  },\n  \"Dexie.js\": {\n    page: \"https://dexie.org/\",\n    licence: \"Apache 2.0\",\n    licenceUrl: \"https://github.com/dfahlander/Dexie.js/blob/master/LICENSE\"\n  },\n  JQuery: {\n    page: \"https://jquery.com/\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/jquery/jquery/blob/master/LICENSE.txt\"\n  },\n  \"Popper.js\": {\n    page: \"https://popper.js.org/\",\n    licence: \"MIT\",\n    licenceUrl: \"https://github.com/FezVrasta/popper.js/blob/master/LICENSE.md\"\n  },\n  \"Create React App\": {\n    page: \"https://create-react-app.dev/\",\n    licence: \"MIT\",\n    licenceUrl:\n      \"https://github.com/facebook/create-react-app/blob/master/LICENSE\"\n  },\n  \"es-shims/Array.prototype.flatMap\": {\n    page: \"https://github.com/es-shims/Array.prototype.flatMap\",\n    licence: \"MIT\",\n    licenceUrl:\n      \"https://github.com/es-shims/Array.prototype.flatMap/blob/master/LICENSE\"\n  }\n});\n","import React, { FC } from \"react\";\nimport Octicon, { MarkGithub } from \"@primer/octicons-react\";\nimport { opensource } from \"../../data/opensource\";\n\ninterface Props {}\n\nexport const OpenSourceSection: FC<Props> = ({  }: Props) => {\n  return (\n    <>\n      <h5 className=\"mt-5\">\n        <Octicon icon={MarkGithub} size={25} />\n        <span className=\"ml-3\">Open Source Software is used here ...</span>\n      </h5>\n      <blockquote className=\"blockquote\">\n        <p className=\"mb-0\">\n          <em>\n            &quot;If I have seen further it is by standing on the shoulders of\n            giants.&quot;\n          </em>\n        </p>\n        <footer className=\"blockquote-footer\">\n          <cite title=\"Source Title\">\n            <a href=\"https://en.wikipedia.org/wiki/Bernard_of_Chartres\">\n              Bernard of Chartres\n            </a>\n          </cite>\n        </footer>\n      </blockquote>\n      <table className=\"table\">\n        <thead>\n          <th>Project</th>\n          <th>Website</th>\n          <th>Licence</th>\n        </thead>\n        <tbody>\n          {Object.entries(opensource).map(([name, info]) => (\n            <tr key={name}>\n              <td>{name}</td>\n              <td>\n                <a href={info.page}>{info.page}</a>\n              </td>\n              <td>\n                <a href={info.licenceUrl}>{info.licence}</a>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport Octicon, { Milestone } from \"@primer/octicons-react\";\nimport { FullPageWithHeading } from \"../../common/FullPageWithHeading\";\n\ninterface Props {}\n\nexport const IntroSection: FC<Props> = ({  }: Props) => {\n  return (\n    <>\n      <p>\n        <strong>Gridheim</strong> is a digital grid map. Grid maps are used for\n        pen&pencil roll playing games (like D&D, pathfinder, etc.) to show the\n        position of characters and monsters on a map of the environment.\n      </p>\n\n      <h5 className=\"mt-5\">\n        <Octicon icon={Milestone} size={25} />\n        <span className=\"ml-3\">\n          The goals of <strong>Gridheim</strong> are ...{\" \"}\n        </span>\n      </h5>\n      <ul>\n        <li>A good user experience</li>\n        <li>Cross platform and cross device compatibility</li>\n        <li>Pen support</li>\n        <li>Offline support via service worker</li>\n        <li>Data privacy - All data is only stored locally in your browser</li>\n      </ul>\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { MediaBody } from \"../../common/media/MediaBody\";\nimport Octicon, { GistSecret } from \"@primer/octicons-react\";\nimport { MediaContainer } from \"../../common/media/MediaContainer\";\n\ninterface Props {}\n\nexport const HelloSection: FC<Props> = ({  }: Props) => {\n  return (\n    <>\n      <MediaContainer>\n        <MediaBody>\n          <h5 className=\"mt-5\">\n            <Octicon icon={GistSecret} size={25} />\n            <span className=\"ml-3\">\n              Hello my name is <strong>Otto</strong> ...\n            </span>\n          </h5>\n          <p>\n            ... and I&apos;m a Software Engineer at\n            <a href=\"https://comsystoreply.de/\"> Comsysto Reply </a>\n            nice to meet you!\n            <br />\n            <small>\n              <a href=\"https://comsystoreply.de/karriere\">\n                (PS: we&apos;re hiring)\n              </a>\n            </small>\n          </p>\n          <p>\n            Let me explain to you why I created yet another map tool :D ...\n            <br />\n            It all begun when I searched for a way to visualise battles in my\n            D&D campaign.\n            <br />\n            The first approach was to use a physical map, which was nearly\n            impossible for the huge maps that are often used in campaign books.\n            The printout would be more than 2 meters in length.\n            <br />\n            The next thing we tried was to use a tablet with a pen. This works\n            quite smoothly because it has a similar usability than the pencil\n            drawn maps of my youth, but it was quite challenging to move the\n            tokens around. Every token has to be erased and drawn again in a\n            other location. So we tried finding a dedicated software that would\n            run on tablets, sadly we don&apos;t found one that has worked with\n            the pen which was a blast to use :D ...\n          </p>\n          <p>\n            In the mean time I was building some dashboard prototypes at work\n            that uses SVG graphics together with React which has quite similar\n            characteristics ...\n            <br />\n            ... so I decided to give it a try, how hard can it be XD\n          </p>\n        </MediaBody>\n        <img\n          className=\"img-thumbnail mr-3\"\n          src=\"https://www.gravatar.com/avatar/6f1aded52d041be71a1f5168c6b7e7dd?s=250\"\n        />\n      </MediaContainer>\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { FullPageWithHeading } from \"../common/FullPageWithHeading\";\nimport Octicon, { Info, Play } from \"@primer/octicons-react\";\nimport { routing } from \"../App\";\nimport { Link } from \"react-router-dom\";\nimport { PageHeader } from \"../common/PageHeader\";\nimport { OpenSourceSection } from \"./AboutApp/OpenSourceSection\";\nimport { IntroSection } from \"./AboutApp/IntroSection\";\nimport { HelloSection } from \"./AboutApp/HelloSection\";\n\ninterface Props {}\n\nexport const AboutApp: FC<Props> = ({  }: Props) => {\n  return (\n    <FullPageWithHeading\n      heading={\n        <PageHeader icon={Info} headline=\"Welcome to Gridheim, Friend!\">\n          <Link to={routing.play}>\n            <Octicon icon={Play} /> Enough talk just start playing ...\n          </Link>\n        </PageHeader>\n      }\n    >\n      <IntroSection />\n      <HelloSection />\n      <OpenSourceSection />\n    </FullPageWithHeading>\n  );\n};\n","export class SettingToggle {\n  constructor(\n    private readonly name: string,\n    private readonly defaultValue: boolean\n  ) {}\n\n  get(): boolean {\n    const key = this.key;\n    const loadedValue = localStorage.getItem(key);\n    switch (loadedValue) {\n      case \"true\":\n        return true;\n      case \"false\":\n        return false;\n      default:\n        return this.defaultValue;\n    }\n  }\n\n  private get key(): string {\n    return `toggle-${this.name}`;\n  }\n\n  set(value: boolean): void {\n    localStorage.setItem(this.key, `${value}`);\n  }\n}\n\nexport const settingStorage = Object.freeze({\n  redirectToAbout: new SettingToggle(\"redirect-to-about\", true)\n});\n","import React, { FC, ReactNode } from \"react\";\nimport { settingStorage } from \"../services/SettingStorage\";\nimport { Redirect } from \"react-router\";\nimport { routing } from \"../App\";\n\ninterface Props {\n  children: ReactNode;\n}\n\nexport const RedirectToAboutOnFirstVisit: FC<Props> = ({ children }: Props) => {\n  const redirectToAbout = settingStorage.redirectToAbout.get();\n  if (redirectToAbout) {\n    settingStorage.redirectToAbout.set(false);\n  }\n  return (\n    <>\n      {redirectToAbout && <Redirect to={routing.about} />}\n      {!redirectToAbout && children}\n    </>\n  );\n};\n","import { TokenType } from \"./TokenType\";\nimport { Immerable } from \"../utils/Immerable\";\nimport { Square } from \"./Square\";\n\n@Immerable()\nexport class Token {\n  constructor(\n    readonly id: string,\n    readonly tokenType: TokenType,\n    readonly label: string,\n    readonly square: Square,\n    readonly size: number = tokenType.size\n  ) {}\n}\n","import { Immerable } from \"../utils/Immerable\";\n\n@Immerable()\nexport class Square {\n  constructor(readonly x: number, readonly y: number) {}\n\n  toCoordinateString(): string {\n    return `${this.x}/${this.y}`;\n  }\n}\n","import { DrawingColor } from \"./DrawingColor\";\nimport { DrawingWidth } from \"./DrawingWidth\";\n\nexport class Drawing {\n  static current(color: DrawingColor, width: DrawingWidth): Drawing {\n    return new Drawing(Drawing.CURRENT_ID, [], color, width);\n  }\n\n  static readonly CURRENT_ID = \"current\";\n\n  readonly current = this.id === Drawing.CURRENT_ID;\n\n  constructor(\n    readonly id: string,\n    readonly path: ReadonlyArray<[number, number]>,\n    readonly color: DrawingColor,\n    readonly width: DrawingWidth\n  ) {}\n\n  get svgPath(): string {\n    return this.path.map(p => `${p[0]},${p[1]}`).join(\" \");\n  }\n\n  withPointAdded(x: number, y: number): Drawing {\n    return new Drawing(this.id, [...this.path, [x, y]], this.color, this.width);\n  }\n\n  withId(id: string): Drawing {\n    return new Drawing(id, this.path, this.color, this.width);\n  }\n}\n","import { Drawing } from \"./Drawing\";\n\nexport class DrawingPane {\n  static fromJson(json: any): DrawingPane {\n    const drawings = json.drawings.map(\n      (drawingJson: any) =>\n        new Drawing(\n          drawingJson.id,\n          drawingJson.path,\n          drawingJson.color,\n          drawingJson.width\n        )\n    );\n    return new DrawingPane(drawings);\n  }\n\n  constructor(readonly drawings: ReadonlyArray<Drawing>) {}\n\n  withDrawingAdded(drawing: Drawing): DrawingPane {\n    return new DrawingPane([...this.drawings, drawing]);\n  }\n\n  withCurrentDrawingRemoved(): DrawingPane {\n    return this.withDrawingRemoved(Drawing.CURRENT_ID);\n  }\n\n  withDrawingRemoved(drawingId: string): DrawingPane {\n    return new DrawingPane(this.drawings.filter(d => d.id !== drawingId));\n  }\n}\n","import { Immerable } from \"../utils/Immerable\";\n\n@Immerable()\nexport class ViewBox {\n  constructor(\n    readonly x: number,\n    readonly y: number,\n    readonly width: number,\n    readonly height: number\n  ) {}\n\n  toViewBoxString(): string {\n    return `${this.x} ${this.y} ${this.width} ${this.height}`;\n  }\n}\n","export function uuid(): string {\n  // Public Domain/MIT\n  // Based on https://stackoverflow.com/a/8809472\n  let d = new Date().getTime();\n  if (\n    typeof performance !== \"undefined\" &&\n    typeof performance.now === \"function\"\n  ) {\n    d += performance.now(); //use high-precision timer if available\n  }\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n    const r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === \"x\" ? r : (r & 0x3) | 0x8).toString(16);\n  });\n}\n","import { Observable, Subject } from \"rxjs\";\nimport { takeUntil } from \"rxjs/operators\";\n\nexport abstract class AbstractService {\n  private readonly disposeS$ = new Subject<void>();\n  protected readonly dispose$ = this.disposeS$.asObservable();\n\n  dispose(): void {\n    this.disposeS$.next();\n    this.disposeS$.complete();\n  }\n\n  protected untilDisposed<T>(o: Observable<T>): Observable<T> {\n    return o.pipe(takeUntil(this.dispose$));\n  }\n}\n","import { ViewBox } from \"../../../model/ViewBox\";\nimport { Token } from \"../../../model/Token\";\nimport { BehaviorSubject, combineLatest, Observable } from \"rxjs\";\nimport { Square } from \"../../../model/Square\";\nimport produce, { Draft } from \"immer\";\nimport { TokenType } from \"../../../model/TokenType\";\nimport { uuid } from \"../../../utils/uuid\";\nimport { debounceTime, map, throttleTime } from \"rxjs/operators\";\nimport { AbstractService } from \"../../../services/AbstractService\";\nimport { SaveSessionService } from \"./SaveSessionService\";\nimport { range } from \"../../../utils/range\";\n\nexport class BattleMapService extends AbstractService {\n  private static readonly EMPTY_READONLY_ARRAY: ReadonlyArray<\n    any\n  > = Object.freeze([]);\n\n  private readonly tokensS$ = new BehaviorSubject<ReadonlyArray<Token>>([]);\n\n  readonly tokens$ = this.tokensS$.asObservable();\n\n  readonly gridMap$ = this.sessionStorageService.gridMap$;\n\n  private selectedTokenS$ = new BehaviorSubject<Token | null>(null);\n  readonly selectedToken$ = this.selectedTokenS$.asObservable();\n\n  private readonly selectedSquareS$ = new BehaviorSubject<Square | null>(null);\n  readonly selectedSquare$ = this.selectedSquareS$.asObservable();\n\n  private readonly squareSelectableS$ = new BehaviorSubject<boolean>(false);\n  readonly squareSelectable$ = this.squareSelectableS$.asObservable();\n\n  private readonly tokenSelectableS$ = new BehaviorSubject<boolean>(false);\n  readonly tokenSelectable$ = this.tokenSelectableS$.asObservable();\n\n  private readonly tokenSizeS$ = new BehaviorSubject<number>(1);\n  readonly tokenSize$ = this.tokenSizeS$.asObservable();\n\n  private readonly hoveringSquareS$ = new BehaviorSubject<Square | null>(null);\n  readonly hoveringSquare$ = this.hoveringSquareS$.asObservable();\n\n  public readonly highlightedSquares$: Observable<\n    ReadonlyArray<Square>\n  > = combineLatest([\n    this.squareSelectable$,\n    this.tokenSize$,\n    this.selectedToken$,\n    this.hoveringSquare$\n  ]).pipe(\n    map(([squareSelectable, tokenSize, selectedToken, hoveringSquare]) => {\n      if (!hoveringSquare || !squareSelectable) {\n        return BattleMapService.EMPTY_READONLY_ARRAY;\n      }\n\n      const size = selectedToken ? selectedToken.size : tokenSize;\n      const squares = range(size).map(dx =>\n        range(size).map(\n          dy => new Square(hoveringSquare.x + dx, hoveringSquare.y + dy)\n        )\n      );\n      return Object.freeze(squares.flat());\n    }),\n    debounceTime(50)\n  );\n\n  readonly viewBox$ = this.gridMap$.pipe(\n    map(map =>\n      map\n        ? new ViewBox(0, 0, map.getWidthInSquares(), map.getHeightInSquares())\n        : new ViewBox(0, 0, 0, 0)\n    )\n  );\n\n  private readonly scaleS$ = new BehaviorSubject(1);\n  readonly scale$ = this.scaleS$.asObservable().pipe(throttleTime(200));\n\n  private readonly positionS$ = new BehaviorSubject({ x: 0, y: 0 });\n  readonly position$ = this.positionS$.asObservable().pipe(throttleTime(200));\n\n  constructor(private readonly sessionStorageService: SaveSessionService) {\n    super();\n  }\n\n  selectToken(token: Token | null): void {\n    if (this.tokenSelectable) {\n      this.selectedTokenS$.next(token);\n    }\n  }\n\n  get selectedToken(): Token | null {\n    return this.selectedTokenS$.value;\n  }\n\n  selectSquare(square: Square | null): void {\n    this.selectedSquareS$.next(square);\n  }\n\n  updateTokens(\n    transform: (tokens: Draft<Token>[]) => Draft<Token[]> | void\n  ): void {\n    const tokens = produce(this.tokensS$.value, transform);\n    this.tokensS$.next(tokens);\n\n    const oldSelectedToken = this.selectedTokenS$.value;\n    if (oldSelectedToken) {\n      const newToken = this.tokensS$.value.find(\n        token => oldSelectedToken.id === token.id\n      );\n      this.selectedTokenS$.next(newToken || null);\n    }\n  }\n\n  addToken(\n    tokenType: TokenType,\n    tokenLabel: string,\n    tokenSize: number,\n    square: Square\n  ): void {\n    this.updateTokens(tokens => {\n      tokens.push(new Token(uuid(), tokenType, tokenLabel, square, tokenSize));\n    });\n    const tokens = this.tokensS$.value;\n    this.selectToken(tokens[tokens.length - 1]);\n  }\n\n  setSquareSelectable(selectable: boolean): void {\n    this.squareSelectableS$.next(selectable);\n  }\n\n  get squareSelectable(): boolean {\n    return this.squareSelectableS$.value;\n  }\n\n  setTokenSelectable(selectable: boolean): void {\n    this.tokenSelectableS$.next(selectable);\n  }\n\n  get tokenSelectable(): boolean {\n    return this.tokenSelectableS$.value;\n  }\n\n  switchScale(factor: number): void {\n    this.scaleS$.next(1 + factor * 0.1);\n  }\n\n  get scale(): number {\n    return this.scaleS$.value;\n  }\n\n  get position(): { x: number; y: number } {\n    return this.positionS$.value;\n  }\n\n  get tokenSize(): number {\n    return this.tokenSizeS$.value;\n  }\n\n  movePosition(dx: number, dy: number): void {\n    const { x, y } = this.position;\n    this.positionS$.next({ x: x + dx, y: y + dy });\n  }\n\n  removeSelectedToken(): void {\n    if (this.selectedToken !== null) {\n      const tokenId = this.selectedToken.id;\n      this.updateTokens(tokens => {\n        return tokens.filter(token => token.id !== tokenId);\n      });\n    }\n  }\n\n  hoverOverSquare(s: Square | null): void {\n    this.hoveringSquareS$.next(s);\n  }\n\n  setTokenSize(tokenSize: number): void {\n    this.tokenSizeS$.next(tokenSize);\n  }\n}\n","export enum DrawingColor {\n  red = \"red\",\n  yellow = \"yellow\",\n  blue = \"blue\",\n  green = \"green\",\n  purple = \"purple\",\n  orange = \"orange\"\n}\n","export enum DrawingWidth {\n  s = \"s\",\n  m = \"m\",\n  l = \"l\"\n}\n","import { BehaviorSubject, Observable } from \"rxjs\";\nimport { ModeBasedService } from \"../App/PlayApp/services/modebased/ModeBasedService\";\nimport { AbstractService } from \"./AbstractService\";\n\nexport abstract class AbstractModeBasedService extends AbstractService\n  implements ModeBasedService {\n  private readonly activeS$ = new BehaviorSubject(false);\n  readonly active$ = this.activeS$.asObservable();\n\n  activate(onDeactivate$: Observable<void>): void {\n    this.onActivate(onDeactivate$);\n    onDeactivate$.subscribe({\n      next: () => this.activeS$.next(false)\n    });\n    this.activeS$.next(true);\n  }\n\n  abstract onActivate(onDeactivate$: Observable<void>): void;\n\n  get active(): boolean {\n    return this.activeS$.value;\n  }\n}\n","import { BattleMapService } from \"../BattleMapService\";\nimport { combineLatest, Observable } from \"rxjs\";\nimport { distinctUntilChanged, takeUntil } from \"rxjs/operators\";\nimport { AbstractModeBasedService } from \"../../../../services/AbstractModeBasedService\";\n\nexport class PlayModeService extends AbstractModeBasedService {\n  constructor(private readonly battleMapService: BattleMapService) {\n    super();\n  }\n\n  onActivate(onDeactivate$: Observable<void>): void {\n    this.battleMapService.setTokenSelectable(true);\n    this.battleMapService.setSquareSelectable(true);\n    this.battleMapService.selectSquare(null);\n    this.battleMapService.selectToken(null);\n\n    combineLatest([\n      this.battleMapService.selectedToken$,\n      this.battleMapService.selectedSquare$\n    ])\n      .pipe(\n        takeUntil(onDeactivate$),\n        distinctUntilChanged((a1, a2) => a1 === a2, ([a, b]) => `${a}/${b}`)\n      )\n      .subscribe(([selectedToken, selectedSquare]) => {\n        if (selectedToken && !selectedSquare) {\n          this.battleMapService.setSquareSelectable(true);\n        }\n        if (!selectedToken && !selectedSquare) {\n          this.battleMapService.setSquareSelectable(false);\n        }\n        if (selectedToken && selectedSquare) {\n          this.battleMapService.selectSquare(null);\n          this.battleMapService.updateTokens(tokens => {\n            tokens\n              .filter(token => token.id === selectedToken.id)\n              .forEach(token => (token.square = selectedSquare));\n          });\n        }\n      });\n  }\n}\n","import { BehaviorSubject, Observable } from \"rxjs\";\nimport { Drawing } from \"../../../../model/Drawing\";\nimport { DrawingPane } from \"../../../../model/DrawingPane\";\nimport { uuid } from \"../../../../utils/uuid\";\nimport { DrawingColor } from \"../../../../model/DrawingColor\";\nimport { DrawingWidth } from \"../../../../model/DrawingWidth\";\nimport { AbstractModeBasedService } from \"../../../../services/AbstractModeBasedService\";\n\nexport type DrawingMode = \"draw\" | \"erase\";\n\nexport class DrawingService extends AbstractModeBasedService {\n  private readonly paneS$ = new BehaviorSubject(new DrawingPane([]));\n  readonly pane$ = this.paneS$.asObservable();\n\n  private readonly drawingColorS$ = new BehaviorSubject<DrawingColor>(\n    DrawingColor.red\n  );\n  readonly drawingColor$ = this.drawingColorS$.asObservable();\n\n  private readonly drawingWidthS$ = new BehaviorSubject<DrawingWidth>(\n    DrawingWidth.m\n  );\n  readonly drawingWidth$ = this.drawingWidthS$.asObservable();\n\n  private readonly drawingModeS$ = new BehaviorSubject<DrawingMode>(\"draw\");\n  readonly drawingMode$ = this.drawingModeS$.asObservable();\n\n  currentlyDrawing(points$: Observable<[number, number]>): void {\n    if (!this.active) {\n      return;\n    }\n    const pane: DrawingPane = this.paneS$.value;\n    let currentDrawing = Drawing.current(this.drawingColor, this.drawingWidth);\n    points$.subscribe({\n      next: point => {\n        currentDrawing = currentDrawing.withPointAdded(...point);\n        const panePreview = pane.withDrawingAdded(currentDrawing);\n        this.paneS$.next(panePreview);\n      },\n      error: () => {\n        // on error reset the pane...\n        this.paneS$.next(pane);\n      },\n      complete: () => {\n        this.paneS$.next(pane.withDrawingAdded(currentDrawing.withId(uuid())));\n      }\n    });\n  }\n\n  removeDrawing(drawingId: string): void {\n    const pane: DrawingPane = this.paneS$.value;\n    this.paneS$.next(pane.withDrawingRemoved(drawingId));\n  }\n\n  switchDrawingColor(drawingColor: DrawingColor): void {\n    this.drawingColorS$.next(drawingColor);\n  }\n\n  get drawingColor(): DrawingColor {\n    return this.drawingColorS$.value;\n  }\n\n  switchDrawingWidth(drawingWidth: DrawingWidth): void {\n    this.drawingWidthS$.next(drawingWidth);\n  }\n\n  switchDrawingMode(drawingMode: DrawingMode): void {\n    this.drawingModeS$.next(drawingMode);\n  }\n\n  get drawingMode(): DrawingMode {\n    return this.drawingModeS$.value;\n  }\n\n  get drawingWidth(): DrawingWidth {\n    return this.drawingWidthS$.value;\n  }\n\n  setPane(pane: DrawingPane): void {\n    this.paneS$.next(pane);\n  }\n\n  onActivate(): void {}\n}\n","import { Immerable } from \"../utils/Immerable\";\n\n@Immerable()\nexport class TokenType {\n  constructor(\n    readonly size: number,\n    readonly color: string,\n    readonly border: string,\n    readonly name: string\n  ) {}\n}\n","import { TokenType } from \"../../../model/TokenType\";\nimport { AbstractService } from \"../../../services/AbstractService\";\n\nexport class AssetService extends AbstractService {\n  readonly defaultStrokeColor = \"#555555\";\n  readonly tokenTypes = [\n    new TokenType(1, \"#ff28fb\", \"#ffaaf3\", \"Mora\"),\n    new TokenType(1, \"#ff8902\", \"#ffd069\", \"Elsa\"),\n\n    new TokenType(1, \"#78cc85\", this.defaultStrokeColor, \"LightGreen\"),\n    new TokenType(1, \"#077919\", this.defaultStrokeColor, \"Green\"),\n    new TokenType(1, \"#98c6ff\", this.defaultStrokeColor, \"LightBlue\"),\n    new TokenType(1, \"#0282ff\", this.defaultStrokeColor, \"Blue\"),\n    new TokenType(1, \"#9f6a00\", this.defaultStrokeColor, \"LightBrown\"),\n    new TokenType(1, \"#513200\", this.defaultStrokeColor, \"Brown\"),\n    new TokenType(1, \"#ff5354\", this.defaultStrokeColor, \"LightRed\"),\n    new TokenType(1, \"#c70200\", this.defaultStrokeColor, \"Red\"),\n    new TokenType(1, \"#ffff8e\", this.defaultStrokeColor, \"LightYellow\"),\n    new TokenType(1, \"#ffef00\", this.defaultStrokeColor, \"Yellow\"),\n    new TokenType(1, \"#d67eff\", this.defaultStrokeColor, \"LightPurple\"),\n    new TokenType(1, \"#9f00d3\", this.defaultStrokeColor, \"Purple\"),\n    new TokenType(1, \"#f4e4ee\", this.defaultStrokeColor, \"LightGrey\"),\n    new TokenType(1, \"#645e5d\", this.defaultStrokeColor, \"DarkGrey\")\n  ];\n\n  tokenTypeForName(name: string): TokenType | null {\n    return this.tokenTypes.find(type => type.name === name) || null;\n  }\n\n  readonly tokenLabels = [\n    \" \",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"6\",\n    \"7\",\n    \"8\",\n    \"9\",\n    \"Boss\",\n    \"L1\",\n    \"L2\",\n    \"L3\",\n    \"M1\",\n    \"M2\",\n    \"M3\",\n    \"P1\",\n    \"P2\",\n    \"P3\"\n  ];\n}\n","export function is<T, R extends T>(...isEqualToOneOf: R[]): (v: T) => boolean {\n  return value => isEqualToOneOf.some(i => i === value);\n}\n","import { Observable, Subject } from \"rxjs\";\n\nexport interface ModeBasedService {\n  activate(onDeactivate: Observable<void>): void;\n}\n\nexport class ModeBasedService {\n  static controlServices<T extends string>(\n    mode$: Observable<T>,\n    services: { [K in T]: ModeBasedService | null }\n  ): void {\n    let disposeSubject: Subject<void> | null = null;\n    const disposeLastState = (): void => {\n      if (disposeSubject) {\n        disposeSubject.next();\n        disposeSubject.complete();\n        disposeSubject = null;\n      }\n    };\n    mode$.subscribe({\n      next: mode => {\n        disposeLastState();\n        if (mode) {\n          const service = services[mode];\n          if (service) {\n            disposeSubject = new Subject<void>();\n            service.activate(disposeSubject);\n          }\n        }\n      },\n      complete: () => {\n        console.log(\"mode based complete\");\n        disposeLastState();\n      },\n      error: () => {\n        disposeLastState();\n      }\n    });\n  }\n}\n","import { BattleMapService } from \"../BattleMapService\";\nimport { BehaviorSubject, combineLatest, Observable } from \"rxjs\";\nimport { map, takeUntil, tap } from \"rxjs/operators\";\nimport { TokenType } from \"../../../../model/TokenType\";\nimport { AssetService } from \"../AssetService\";\nimport { is } from \"../../../../utils/is\";\nimport { AbstractModeBasedService } from \"../../../../services/AbstractModeBasedService\";\nimport { ModeBasedService } from \"./ModeBasedService\";\n\nexport type Mode =\n  | \"switch-token-type\"\n  | \"add-token\"\n  | \"remove-token\"\n  | \"inactive\";\n\nexport class ManageTokenService extends AbstractModeBasedService {\n  readonly mode$S = new BehaviorSubject<Mode>(\"add-token\");\n  readonly mode$ = this.mode$S\n    .asObservable()\n    .pipe(tap(m => console.log(\"manageTokenMode\", m)));\n\n  private readonly modeCallbacks: { [T in Mode]: ModeBasedService | null } = {\n    \"switch-token-type\": {\n      activate: () => {\n        this.battleMapService.setTokenSelectable(false);\n        this.battleMapService.setSquareSelectable(false);\n        this.battleMapService.selectSquare(null);\n        this.battleMapService.selectToken(null);\n      }\n    },\n\n    \"add-token\": {\n      activate: deactivate$ => {\n        this.battleMapService.setTokenSelectable(false);\n        this.battleMapService.setSquareSelectable(true);\n        this.battleMapService.selectSquare(null);\n        this.battleMapService.selectToken(null);\n        this.battleMapService.setTokenSize(this.tokenSizeS$.value);\n        combineLatest([\n          this.tokenType$,\n          this.tokenLabel$,\n          this.tokenSize$,\n          this.battleMapService.selectedSquare$\n        ])\n          .pipe(takeUntil(deactivate$))\n          .subscribe(([tokenType, tokenLabel, tokenSize, selectedSquare]) => {\n            if (selectedSquare && tokenType && tokenLabel && tokenSize) {\n              this.battleMapService.selectSquare(null);\n              this.battleMapService.addToken(\n                tokenType,\n                tokenLabel,\n                tokenSize,\n                selectedSquare\n              );\n            }\n          });\n\n        deactivate$.subscribe({\n          next: () => {\n            this.battleMapService.setTokenSize(1);\n          }\n        });\n      }\n    },\n\n    \"remove-token\": {\n      activate: deactivate$ => {\n        this.battleMapService.setTokenSelectable(true);\n        this.battleMapService.setSquareSelectable(false);\n        this.battleMapService.selectSquare(null);\n        this.battleMapService.selectToken(null);\n        combineLatest([\n          this.tokenType$,\n          this.tokenLabel$,\n          this.battleMapService.selectedToken$\n        ])\n          .pipe(takeUntil(deactivate$))\n          .subscribe(([tokenType, tokenLabel, selectedToken]) => {\n            if (selectedToken && tokenType && tokenLabel) {\n              this.battleMapService.removeSelectedToken();\n            }\n          });\n      }\n    },\n\n    inactive: null\n  };\n\n  readonly isSwitchTokenType$ = this.mode$.pipe(map(is(\"switch-token-type\")));\n\n  private readonly tokenTypeS$ = new BehaviorSubject<TokenType>(\n    this.assetService.tokenTypes[0]\n  );\n  readonly tokenType$ = this.tokenTypeS$.asObservable();\n\n  private readonly tokenLabelS$ = new BehaviorSubject<string>(\n    this.assetService.tokenLabels[0]\n  );\n  readonly tokenLabel$ = this.tokenLabelS$.asObservable();\n\n  private readonly tokenSizeS$ = new BehaviorSubject<number>(1);\n  readonly tokenSize$ = this.tokenSizeS$.asObservable();\n\n  constructor(\n    private readonly battleMapService: BattleMapService,\n    private readonly assetService: AssetService\n  ) {\n    super();\n  }\n\n  onActivate(deactivate$: Observable<void>): void {\n    ModeBasedService.controlServices(\n      this.mode$.pipe(takeUntil(deactivate$)),\n      this.modeCallbacks\n    );\n\n    deactivate$.subscribe({\n      next: () => {\n        this.mode$S.next(\"inactive\");\n      }\n    });\n\n    this.mode$S.next(\"add-token\");\n  }\n\n  setTokenType(tokenType: TokenType): void {\n    this.tokenTypeS$.next(tokenType);\n  }\n\n  get tokenType(): TokenType | null {\n    return this.tokenTypeS$.value;\n  }\n\n  get tokenLabel(): string | null {\n    return this.tokenLabelS$.value;\n  }\n\n  setTokenLabel(label: string): void {\n    this.tokenLabelS$.next(label);\n  }\n\n  get tokenSize(): number {\n    return this.tokenSizeS$.value;\n  }\n\n  setTokenSize(size: number): void {\n    this.tokenSizeS$.next(size);\n  }\n\n  switchMode(mode: Mode): void {\n    this.mode$S.next(mode);\n  }\n}\n","import { BehaviorSubject } from \"rxjs\";\nimport { ModeBasedService } from \"./modebased/ModeBasedService\";\nimport { AbstractService } from \"../../../services/AbstractService\";\n\nexport type Mode =\n  | \"play\"\n  | \"draw-background\"\n  | \"draw-notes\"\n  | \"manage-token\"\n  | \"zoom\";\n\nexport class ModeService extends AbstractService {\n  private readonly modeS$ = new BehaviorSubject<Mode>(this.initalMode);\n  readonly mode$ = this.modeS$.asObservable();\n\n  constructor(\n    private readonly initalMode: Mode,\n    modeBasedServices: { [T in Mode]: ModeBasedService | null }\n  ) {\n    super();\n    ModeBasedService.controlServices(\n      this.untilDisposed(this.mode$),\n      modeBasedServices\n    );\n  }\n\n  switchMode(mode: Mode): void {\n    this.modeS$.next(mode);\n  }\n\n  get mode(): Mode {\n    return this.modeS$.value;\n  }\n}\n","import { BehaviorSubject, Observable, of, Subject, throwError } from \"rxjs\";\nimport { auditTime, catchError, flatMap, map } from \"rxjs/operators\";\nimport { Session } from \"../../../model/Session\";\nimport { GridMap } from \"../../../model/GridMap\";\nimport { GridMapStorage } from \"../../../services/GridMapStorage\";\nimport { SessionStorage } from \"../../../services/SessionStorage\";\nimport { AbstractService } from \"../../../services/AbstractService\";\n\nexport class SaveSessionService extends AbstractService {\n  private onLoad: { [name: string]: Subject<any> } = {};\n  private toStore: { [name: string]: Observable<any> } = {};\n  private readonly sessionS$ = new BehaviorSubject<Session | null>(null);\n  readonly session$ = this.untilDisposed(this.sessionS$.asObservable());\n  private readonly gridMapS$ = new BehaviorSubject<GridMap | null>(null);\n  readonly gridMap$ = this.untilDisposed(this.gridMapS$.asObservable());\n\n  constructor(\n    private readonly gridMapStorage: GridMapStorage,\n    private readonly sessionStorage: SessionStorage\n  ) {\n    super();\n    this.session$.pipe(auditTime(10000)).subscribe({\n      next: () => {\n        console.log(\"saving session\", this.session);\n        this.saveSession();\n      }\n    });\n  }\n\n  saveSession(): void {\n    this.session && this.sessionStorage.store(this.session);\n  }\n\n  add<T>(name: string, valuesToStore: Observable<T>): Observable<T> {\n    const onLoadSubject = new Subject<T>();\n    this.onLoad = { ...this.onLoad, [name]: onLoadSubject };\n    this.toStore = { ...this.toStore, [name]: valuesToStore };\n    return onLoadSubject.asObservable();\n  }\n\n  loadAndStart(): Observable<boolean> {\n    return this.sessionStorage.findCurrentSessionName().pipe(\n      flatMap(sessionName =>\n        sessionName\n          ? of(sessionName!)\n          : throwError(\"No current session name found in local storage\")\n      ),\n      flatMap(sessionName => this.sessionStorage.findBy(sessionName)),\n      flatMap(session =>\n        session ? of(session) : throwError(\"Failed Loading Session\")\n      ),\n      flatMap(session =>\n        this.gridMapStorage\n          .findBy(session.gridMapName)\n          .pipe(map(gridMap => [session, gridMap] as const))\n      ),\n      flatMap(([session, gridMap]) =>\n        gridMap\n          ? of([session, gridMap] as const)\n          : throwError(\"Session with no gridMapName\")\n      ),\n      map(([loadedSession, gridMap]) => {\n        Object.keys(this.onLoad).forEach(name => {\n          const loadedData = loadedSession.content[name];\n          if (loadedData) {\n            const subject = this.onLoad[name];\n            subject.next(loadedData);\n            subject.complete();\n          }\n        });\n\n        Object.keys(this.toStore).forEach(name => {\n          const observable = this.toStore[name];\n          this.untilDisposed(observable).subscribe(data => {\n            if (this.session) {\n              this.sessionS$.next(\n                this.session.with({\n                  date: new Date().toLocaleString(),\n                  content: { ...this.session.content, [name]: data }\n                })\n              );\n            }\n          });\n        });\n\n        this.sessionS$.next(loadedSession);\n        this.gridMapS$.next(gridMap);\n        return true;\n      }),\n      catchError(error => {\n        console.log(`Failed loading session: ${error}`);\n        return of(false);\n      })\n    );\n  }\n\n  get session(): Session | null {\n    return this.sessionS$.value;\n  }\n}\n","import React, { FC } from \"react\";\nimport { GridMap } from \"../../../../model/GridMap\";\n\ninterface Props {\n  gridMap: GridMap;\n}\n\nexport const DisplayBackgroundImage: FC<Props> = ({ gridMap }: Props) => {\n  return (\n    <g transform={gridMap.transformation.asTransformString()}>\n      <image\n        width={gridMap.image.width}\n        height={gridMap.image.height}\n        xlinkHref={gridMap.image.url}\n      />\n    </g>\n  );\n};\n","import { Observable } from \"rxjs\";\nimport { useEffect, useState } from \"react\";\n\nexport function useObservable<T>(\n  observable$:\n    | (() => Observable<T> | undefined | null)\n    | Observable<T>\n    | undefined\n    | null,\n  defaultValue: T\n): T {\n  const [observableState, setObservableState] = useState<T>(defaultValue);\n\n  useEffect((): (() => void) | undefined => {\n    if (!observable$) {\n      return;\n    }\n    let toSubscribe: Observable<T> | undefined | null;\n    if (typeof observable$ === \"function\") {\n      toSubscribe = observable$();\n    } else {\n      toSubscribe = observable$;\n    }\n\n    if (toSubscribe) {\n      const subscription = toSubscribe.subscribe(value => {\n        setObservableState(value);\n      });\n      return (): void => subscription.unsubscribe();\n    }\n  }, [observable$]);\n\n  return observableState;\n}\n","import React, { FC } from \"react\";\nimport { TokenType } from \"../model/TokenType\";\nimport { Square } from \"../model/Square\";\nimport { classesMap, ClassesMap } from \"../utils/classesMap\";\n\ninterface Props {\n  tokenType: TokenType;\n  tokenLabel: string;\n  tokenSize: number;\n  tokenClasses?: ClassesMap;\n  square?: Square;\n  onClick?: () => void;\n}\n\nexport const DisplayToken: FC<Props> = ({\n  tokenClasses,\n  tokenType,\n  tokenSize,\n  tokenLabel,\n  square,\n  onClick\n}: Props) => {\n  square = square || new Square(0, 0);\n  return (\n    <g onClick={onClick}>\n      <circle\n        className={`token ${tokenClasses ? classesMap(tokenClasses) : \"\"}`}\n        fill={tokenType.color}\n        stroke={tokenType.border}\n        r={tokenSize / 2}\n        cx={square.x + tokenSize / 2}\n        cy={square.y + tokenSize / 2}\n      />\n      {tokenLabel && (\n        <text\n          className=\"token-text\"\n          x={square.x + tokenSize / 2}\n          y={square.y + 0.2 + tokenSize / 2}\n        >\n          {tokenLabel}\n        </text>\n      )}\n    </g>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\nimport { Token } from \"../../../../model/Token\";\nimport { Observable } from \"rxjs\";\nimport { useObservable } from \"../../../../utils/useObservable\";\nimport { DisplayToken } from \"../../../../common/DisplayToken\";\n\ninterface Props {\n  tokens: ReadonlyArray<Token>;\n  onClick: (token: Token | null) => void;\n  selectedToken$: Observable<Token | null>;\n}\n\nexport const DisplayTokens: FC<Props> = ({\n  tokens,\n  onClick,\n  selectedToken$\n}: Props) => {\n  const selectedToken = useObservable(selectedToken$, null);\n\n  const renderToken = (token: Token): ReactNode => {\n    return (\n      <g key={token.id}>\n        <DisplayToken\n          tokenType={token.tokenType}\n          tokenLabel={token.label}\n          tokenSize={token.size}\n          square={token.square}\n          onClick={() => onClick(token)}\n        />\n      </g>\n    );\n  };\n\n  return (\n    <g>\n      {tokens.map(renderToken)}\n      {selectedToken && (\n        <DisplayToken\n          tokenType={selectedToken.tokenType}\n          tokenLabel={selectedToken.label}\n          tokenSize={selectedToken.size}\n          square={selectedToken.square}\n          onClick={() => onClick(null)}\n          tokenClasses={{ \"selected-token\": true }}\n        />\n      )}\n    </g>\n  );\n};\n","import React, { FC, PointerEvent, useState } from \"react\";\nimport { DrawingService } from \"../../services/modebased/DrawingService\";\nimport { Subject } from \"rxjs\";\nimport { useObservable } from \"../../../../utils/useObservable\";\nimport { pointInSvgFromEvent } from \"../../../../utils/pointInSvgFromEvent\";\n\ninterface Props {\n  drawingService: DrawingService;\n}\n\nexport const DrawingCapturePane: FC<Props> = ({ drawingService }: Props) => {\n  const [pointSubject, setPointSubject] = useState<Subject<\n    [number, number]\n  > | null>(null);\n  const active = useObservable(drawingService.active$, false);\n  const drawingMode = useObservable(drawingService.drawingMode$, \"draw\");\n\n  const completeDrawing = (e: PointerEvent<SVGRectElement>): void => {\n    if (!pointSubject) {\n      return;\n    }\n\n    pointSubject.complete();\n    setPointSubject(null);\n    e.currentTarget.releasePointerCapture(e.pointerId);\n  };\n\n  const onMouseMove = (e: PointerEvent<SVGRectElement>): void => {\n    if (!pointSubject) {\n      return;\n    }\n    const pointInSvg = pointInSvgFromEvent(e);\n    pointSubject.next([pointInSvg.x, pointInSvg.y]);\n  };\n\n  const onMouseDown = (e: PointerEvent<SVGRectElement>): void => {\n    if (!drawingService.active) {\n      return;\n    }\n    e.currentTarget.setPointerCapture(e.pointerId);\n\n    const subject = new Subject<[number, number]>();\n    setPointSubject(subject);\n    drawingService.currentlyDrawing(subject);\n  };\n\n  const onMouseUp = (e: PointerEvent<SVGRectElement>): void => {\n    completeDrawing(e);\n  };\n\n  return (\n    <>\n      {drawingMode === \"draw\" && active && (\n        <rect\n          x={-500}\n          y={-500}\n          width={1000}\n          height={1000}\n          className=\"drawing-capture-pane\"\n          onPointerDown={onMouseDown}\n          onPointerUp={onMouseUp}\n          onPointerCancel={e => console.log(\"canceled\", { ...e })}\n          onPointerMove={onMouseMove}\n        />\n      )}\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { classesMap } from \"../../../../utils/classesMap\";\nimport { useObservable } from \"../../../../utils/useObservable\";\nimport { DrawingService } from \"../../services/modebased/DrawingService\";\n\ninterface Props {\n  drawingService: DrawingService;\n  name: string;\n}\n\nexport const DrawingPane: FC<Props> = ({ drawingService, name }: Props) => {\n  const drawingPane = useObservable(drawingService.pane$, null);\n  const drawingMode = useObservable(drawingService.drawingMode$, \"draw\");\n  const onClick = (drawingId: string) => {\n    return (): void => {\n      if (drawingService.drawingMode !== \"erase\") {\n        return;\n      }\n\n      drawingService.removeDrawing(drawingId);\n    };\n  };\n  return (\n    drawingPane && (\n      <>\n        {\n          <g id={name} className={`drawing-pane ${name} ${drawingMode} `}>\n            <rect\n              x={-500}\n              y={-500}\n              width={1000}\n              height={1000}\n              className={`drawing-pane-background ${name}`}\n            />\n            {drawingPane.drawings.map(drawing => (\n              <polyline\n                key={drawing.id}\n                className={classesMap({\n                  drawing: true,\n                  current: drawing.id === \"current\",\n                  [`drawing-${drawing.color}`]: true,\n                  [`drawing-${drawing.width}`]: true\n                })}\n                points={drawing.svgPath}\n                onClick={onClick(drawing.id)}\n              />\n            ))}\n          </g>\n        }\n      </>\n    )\n  );\n};\n","import React, { FC, MouseEvent, PointerEvent, useRef, useState } from \"react\";\nimport { range } from \"../../../../utils/range\";\nimport { pointInSvgFromEvent } from \"../../../../utils/pointInSvgFromEvent\";\nimport { BattleMapService } from \"../../services/BattleMapService\";\n\ninterface Props {\n  battleMapService: BattleMapService;\n}\n\nexport const ZoomPane: FC<Props> = ({ battleMapService }: Props) => {\n  const [factor, setFactor] = useState(0);\n  const [pos, setPos] = useState<{ x: number; y: number } | null>(null);\n  const [startPosBead, setStartPosBead] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n  const paneRef = useRef<SVGRectElement>(null);\n  const [moving, setMoving] = useState(false);\n\n  const updateFactor = (e: React.PointerEvent<SVGCircleElement>): void => {\n    if (!startPosBead) {\n      return;\n    }\n    const currentPos = pointInSvgFromEvent(e);\n    const diffX = currentPos.x - startPosBead.x;\n    setFactor(diffX);\n    battleMapService.switchScale(diffX);\n  };\n\n  const onBeadMouseMove = (e: PointerEvent<SVGCircleElement>): void => {\n    updateFactor(e);\n  };\n\n  const onBeadMouseDown = (e: PointerEvent<SVGCircleElement>): void => {\n    const { x, y } = pointInSvgFromEvent(e);\n    setStartPosBead({ x: x - factor, y });\n    e.currentTarget.setPointerCapture(e.pointerId);\n  };\n\n  const onBeadMouseUp = (e: PointerEvent<SVGCircleElement>): void => {\n    updateFactor(e);\n    setStartPosBead(null);\n    e.currentTarget.releasePointerCapture(e.pointerId);\n  };\n\n  const onClickOnPane = (e: MouseEvent<SVGRectElement>): void => {\n    setPos(pointInSvgFromEvent(e));\n  };\n\n  const updatePosition = (e: React.PointerEvent<SVGCircleElement>): void => {\n    if (!pos || !moving) {\n      return;\n    }\n    const currentPos = pointInSvgFromEvent(e, paneRef.current!);\n    const diffX = currentPos.x - pos.x;\n    const diffY = currentPos.y - pos.y;\n    setPos(currentPos);\n    battleMapService.movePosition(diffX, diffY);\n  };\n\n  const onControlMouseMove = (e: PointerEvent<SVGCircleElement>): void => {\n    updatePosition(e);\n  };\n\n  const onControlMouseDown = (e: PointerEvent<SVGCircleElement>): void => {\n    e.currentTarget.setPointerCapture(e.pointerId);\n    setMoving(true);\n    updatePosition(e);\n  };\n\n  const onControlMouseUp = (e: PointerEvent<SVGCircleElement>): void => {\n    e.currentTarget.releasePointerCapture(e.pointerId);\n    setMoving(false);\n    updatePosition(e);\n  };\n\n  return (\n    <>\n      <rect\n        ref={paneRef}\n        x={-500}\n        y={-500}\n        width={1000}\n        height={1000}\n        className=\"zoom-pane\"\n        onClick={onClickOnPane}\n      />\n\n      {pos && (\n        <g className=\"zoom-control\" transform={`translate(${pos.x} ${pos.y})`}>\n          {range(50).map(i => (\n            <circle\n              className=\"zoom-control-bead\"\n              key={`${Math.ceil(i - factor - 1)}`}\n              cx={1 + i + (factor % 1)}\n              cy={0}\n              r={0.2}\n              onPointerDownCapture={onBeadMouseDown}\n              onPointerMoveCapture={onBeadMouseMove}\n              onPointerUpCapture={onBeadMouseUp}\n            />\n          ))}\n          <circle\n            className=\"zoom-control-center\"\n            cx={0}\n            cy={0}\n            r={0.5}\n            onPointerDownCapture={onControlMouseDown}\n            onPointerMoveCapture={onControlMouseMove}\n            onPointerUpCapture={onControlMouseUp}\n          />\n        </g>\n      )}\n    </>\n  );\n};\n","import React, { FC, ReactChild, ReactChildren } from \"react\";\nimport { range } from \"../../../utils/range\";\n\ninterface Props {\n  width: number;\n  height: number;\n  children: (x: number, y: number) => ReactChildren | ReactChild;\n}\n\nexport const BattleGrid: FC<Props> = ({ children, width, height }: Props) => {\n  return <>{range(width).map(x => range(height).map(y => children(x, y)))}</>;\n};\n","import React, { FC } from \"react\";\nimport { BattleGrid } from \"../../common/BattleGrid\";\n\ninterface Props {\n  width: number;\n  height: number;\n}\n\nexport const BackgroundGrid: FC<Props> = ({ width, height }: Props) => {\n  return (\n    <BattleGrid width={width} height={height}>\n      {(x, y) => (\n        <rect\n          key={`${x}/${y}`}\n          className=\"background-grid\"\n          x={x}\n          y={y}\n          height={1}\n          width={1}\n        />\n      )}\n    </BattleGrid>\n  );\n};\n","import React, { FC } from \"react\";\nimport { Square } from \"../../../../model/Square\";\nimport { BattleGrid } from \"../../common/BattleGrid\";\nimport { classesMap } from \"../../../../utils/classesMap\";\nimport { Dict } from \"../../../../utils/types\";\n\ninterface Props {\n  width: number;\n  height: number;\n  highlightedSquares: ReadonlyArray<Square>;\n  onClick: (square: Square) => void;\n  onHover: (square: Square) => void;\n}\n\nexport const SelectionGrid: FC<Props> = ({\n  onClick,\n  width,\n  height,\n  highlightedSquares,\n  onHover\n}: Props) => {\n  const highlightedMap = highlightedSquares.reduce(\n    (map, square) => {\n      map[square.toCoordinateString()] = true;\n      return map;\n    },\n    {} as Dict<boolean>\n  );\n\n  return (\n    <BattleGrid width={width} height={height}>\n      {(x, y) => {\n        const square = new Square(x, y);\n        return (\n          <rect\n            key={square.toCoordinateString()}\n            className={classesMap({\n              \"selection-grid\": true,\n              highlighted: highlightedMap[square.toCoordinateString()]\n            })}\n            x={x}\n            y={y}\n            height={1}\n            width={1}\n            onClick={() => onClick && onClick(square)}\n            onMouseOver={() => onHover(square)}\n          />\n        );\n      }}\n    </BattleGrid>\n  );\n};\n","import React, { FC } from \"react\";\nimport { BattleMapService } from \"../services/BattleMapService\";\nimport { DisplayBackgroundImage } from \"./PlayMap/DisplayBackgroundImage\";\nimport { DisplayTokens } from \"./PlayMap/DisplayTokens\";\nimport { useObservable } from \"../../../utils/useObservable\";\nimport { DrawingCapturePane } from \"./PlayMap/DrawingCapturePane\";\nimport { DrawingService } from \"../services/modebased/DrawingService\";\nimport { DrawingPane } from \"./PlayMap/DrawingPane\";\nimport { ModeService } from \"../services/ModeService\";\nimport { map } from \"rxjs/operators\";\nimport { ZoomPane } from \"./PlayMap/ZoomPane\";\nimport { is } from \"../../../utils/is\";\nimport { combineLatest } from \"rxjs\";\nimport { BackgroundGrid } from \"./PlayMap/BackgroundGrid\";\nimport { SelectionGrid } from \"./PlayMap/SelectionGrid\";\nimport { ViewBox } from \"../../../model/ViewBox\";\n\ninterface Props {\n  battleMapService: BattleMapService;\n  backgroundDrawingService: DrawingService;\n  notesDrawingService: DrawingService;\n  modeService: ModeService;\n}\n\nexport const PlayMap: FC<Props> = ({\n  battleMapService,\n  backgroundDrawingService,\n  notesDrawingService,\n  modeService\n}: Props) => {\n  const viewBox = useObservable(\n    battleMapService.viewBox$,\n    new ViewBox(0, 0, 0, 0)\n  );\n  const tokens = useObservable(battleMapService.tokens$, []);\n  const notesDrawing = useObservable(notesDrawingService.active$, false);\n  const squareSelectable = useObservable(\n    combineLatest([\n      battleMapService.squareSelectable$,\n      modeService.mode$.pipe(map(is(\"play\", \"manage-token\")))\n    ]).pipe(map(([a, b]) => a && b)),\n    false\n  );\n  const zoomActive = useObservable(\n    modeService.mode$.pipe(map(is(\"zoom\"))),\n    false\n  );\n  const gridMap = useObservable(battleMapService.gridMap$, null);\n  const scale = useObservable(battleMapService.scale$, battleMapService.scale);\n  const position = useObservable(\n    battleMapService.position$,\n    battleMapService.position\n  );\n  const highlightedSquares = useObservable(\n    battleMapService.highlightedSquares$,\n    []\n  );\n  return (\n    <>\n      {gridMap && (\n        <svg className=\"h-100 w-100\" viewBox={viewBox.toViewBoxString()}>\n          <g\n            transform={`translate(${position.x} ${position.y}) scale(${scale}, ${scale})`}\n          >\n            <DisplayBackgroundImage gridMap={gridMap} />\n            <BackgroundGrid\n              width={gridMap.getWidthInSquares()}\n              height={gridMap.getHeightInSquares()}\n            />\n            <DrawingPane\n              name=\"background\"\n              drawingService={backgroundDrawingService}\n            />\n            {squareSelectable && (\n              <SelectionGrid\n                width={gridMap.getWidthInSquares()}\n                height={gridMap.getHeightInSquares()}\n                highlightedSquares={highlightedSquares}\n                onClick={s => battleMapService.selectSquare(s)}\n                onHover={s => battleMapService.hoverOverSquare(s)}\n              />\n            )}\n            <DisplayTokens\n              tokens={tokens}\n              selectedToken$={battleMapService.selectedToken$}\n              onClick={token => battleMapService.selectToken(token)}\n            />\n            {// disable this component here, so the background DrawingPane is always shown...\n            notesDrawing && (\n              <DrawingPane name=\"notes\" drawingService={notesDrawingService} />\n            )}\n\n            <DrawingCapturePane drawingService={notesDrawingService} />\n            <DrawingCapturePane drawingService={backgroundDrawingService} />\n          </g>\n          {zoomActive && <ZoomPane battleMapService={battleMapService} />}\n        </svg>\n      )}\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { ClassesMap, classesMap } from \"../../../utils/classesMap\";\nimport Octicon, { Icon } from \"@primer/octicons-react\";\n\ninterface Props {\n  classes?: ClassesMap | string;\n  onClick?: () => void;\n  icon?: Icon;\n  text?: string;\n  tooltip?: string;\n  iconSize?: number;\n  iconHeight?: number;\n}\n\nexport const ControlBarButton: FC<Props> = ({\n  classes,\n  onClick,\n  icon,\n  text,\n  iconSize,\n  tooltip,\n  iconHeight\n}: Props) => {\n  let additionalClasses = \"\";\n  if (typeof classes === \"string\") {\n    additionalClasses = classes;\n  } else if (typeof classes === \"object\") {\n    additionalClasses = classesMap(classes);\n  }\n\n  const size = iconSize || 16;\n\n  return (\n    <div>\n      <a\n        href=\"#\"\n        title={tooltip}\n        onClick={e => {\n          e.preventDefault();\n          onClick && onClick();\n        }}\n        className={\"btn btn-sm mb-md-2 \" + additionalClasses}\n      >\n        <div className=\"icon-button-content\">\n          {icon && (\n            <Octicon icon={icon} width={size} height={iconHeight || size} />\n          )}\n          {text && <span>{text}</span>}\n        </div>\n      </a>\n    </div>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\nimport {\n  Icon,\n  Paintcan,\n  Pencil,\n  Pulse,\n  Trashcan\n} from \"@primer/octicons-react\";\nimport { useObservable } from \"../../../../utils/useObservable\";\nimport {\n  DrawingMode,\n  DrawingService\n} from \"../../services/modebased/DrawingService\";\nimport { ControlBarButton } from \"../../common/ControlBarButton\";\nimport { DrawingColor } from \"../../../../model/DrawingColor\";\nimport { DrawingWidth } from \"../../../../model/DrawingWidth\";\n\ninterface Props {\n  drawingService: DrawingService;\n}\n\nconst iconSizeByWidth = {\n  [DrawingWidth.s]: 8,\n  [DrawingWidth.m]: 12,\n  [DrawingWidth.l]: 16\n};\n\nexport const DrawingControlBar: FC<Props> = ({ drawingService }: Props) => {\n  const drawingColor = useObservable(\n    drawingService.drawingColor$,\n    drawingService.drawingColor\n  );\n  const drawingWidth = useObservable(\n    drawingService.drawingWidth$,\n    drawingService.drawingWidth\n  );\n  const active = useObservable(drawingService.active$, false);\n  const drawingMode = useObservable(drawingService.drawingMode$, \"draw\");\n  const widthButton = (width: DrawingWidth): ReactNode => (\n    <ControlBarButton\n      key={width}\n      icon={Pulse}\n      iconSize={iconSizeByWidth[width]}\n      onClick={() => drawingService.switchDrawingWidth(width)}\n      classes={{\n        [`btn-secondary`]: drawingWidth === width,\n        [`btn-outline-secondary`]: drawingWidth !== width,\n        \"drawing-pane-button\": true\n      }}\n    />\n  );\n  const colorButton = (color: DrawingColor): ReactNode => (\n    <ControlBarButton\n      key={color}\n      icon={Paintcan}\n      onClick={() => drawingService.switchDrawingColor(color)}\n      classes={{\n        [`drawing-button-${color}`]: drawingColor !== color,\n        [`drawing-button-${color}-selected`]: drawingColor === color\n      }}\n    />\n  );\n\n  const drawingModeButton = (mode: DrawingMode, icon: Icon): ReactNode => (\n    <ControlBarButton\n      key={mode}\n      icon={icon}\n      onClick={() => drawingService.switchDrawingMode(mode)}\n      classes={{\n        [`btn-warning`]: drawingMode === mode,\n        [`btn-outline-warning`]: drawingMode !== mode\n      }}\n    />\n  );\n\n  return (\n    <>\n      {active && (\n        <div className=\"mt-md-5\">\n          {drawingModeButton(\"draw\", Pencil)}\n          {drawingModeButton(\"erase\", Trashcan)}\n          <div className=\"mt-md-4\" />\n          {Object.values(DrawingWidth).map(width => widthButton(width))}\n          <div className=\"mt-md-4\" />\n          {Object.values(DrawingColor).map(color => colorButton(color))}\n        </div>\n      )}\n    </>\n  );\n};\n","export const texts = Object.freeze({\n  drawBackgroundButton:\n    \"Draw something that should be shown on the gridMap like spell effects, environment hazards etc.\",\n  drawNotesButton:\n    \"Open the notes pane where you can write some notes with a pen.\",\n  playButton: \"Enter play mode, so you can move tokens.\",\n  addTokensButton: \"Add a new token to the game board.\",\n  zoomButton: \"Zoom in or out and change orientation of the map.\"\n});\n","import React, { FC, ReactNode } from \"react\";\nimport {\n  FileMedia,\n  GitCompare,\n  Icon,\n  Note,\n  Octoface,\n  Search\n} from \"@primer/octicons-react\";\nimport { Mode, ModeService } from \"../../services/ModeService\";\nimport { useObservable } from \"../../../../utils/useObservable\";\nimport { ControlBarButton } from \"../../common/ControlBarButton\";\nimport { texts } from \"../../Texts\";\n\ninterface Props {\n  modeService: ModeService;\n}\n\nexport const ModeControlBar: FC<Props> = ({ modeService }: Props) => {\n  const mode = useObservable(modeService.mode$, \"play\");\n\n  const modeButton = (\n    icon: Icon,\n    activeInMode: Mode,\n    tooltip: string\n  ): ReactNode => (\n    <ControlBarButton\n      icon={icon}\n      onClick={() => modeService.switchMode(activeInMode)}\n      classes={{\n        \"btn-outline-primary\": activeInMode !== mode,\n        \"btn-primary\": activeInMode === mode\n      }}\n      tooltip={tooltip}\n    />\n  );\n\n  return (\n    <div className=\"\">\n      {modeButton(GitCompare, \"play\", texts.playButton)}\n      {modeButton(Octoface, \"manage-token\", texts.addTokensButton)}\n      {modeButton(Note, \"draw-notes\", texts.drawNotesButton)}\n      {modeButton(FileMedia, \"draw-background\", texts.drawBackgroundButton)}\n      {modeButton(Search, \"zoom\", texts.zoomButton)}\n    </div>\n  );\n};\n","import React, { FC, ReactNode } from \"react\";\nimport { Icon, Plus, Trashcan } from \"@primer/octicons-react\";\nimport { useObservable } from \"../../../../utils/useObservable\";\nimport { ControlBarButton } from \"../../common/ControlBarButton\";\nimport {\n  ManageTokenService,\n  Mode\n} from \"../../services/modebased/ManageTokenService\";\nimport { DisplayToken } from \"../../../../common/DisplayToken\";\nimport { classesMap } from \"../../../../utils/classesMap\";\n\ninterface Props {\n  manageTokenService: ManageTokenService;\n}\n\nexport const ManageTokenControlBar: FC<Props> = ({\n  manageTokenService\n}: Props) => {\n  const active = useObservable(manageTokenService.active$, false);\n  const tokenType = useObservable(manageTokenService.tokenType$, null);\n  const tokenLabel = useObservable(manageTokenService.tokenLabel$, null);\n  const currentMode = useObservable(manageTokenService.mode$, \"add-token\");\n\n  const modeButton = (icon: Icon, mode: Mode): ReactNode => (\n    <ControlBarButton\n      icon={icon}\n      onClick={() => manageTokenService.switchMode(mode)}\n      classes={{\n        \"btn-warning\": mode === currentMode,\n        \"btn-outline-warning\": mode !== currentMode\n      }}\n    />\n  );\n\n  return (\n    <>\n      {active && (\n        <div className=\"mt-md-5\">\n          {modeButton(Plus, \"add-token\")}\n          {modeButton(Trashcan, \"remove-token\")}\n          <div>\n            <a\n              href=\"#\"\n              onClick={event => {\n                event.preventDefault();\n                manageTokenService.switchMode(\"switch-token-type\");\n              }}\n              className={classesMap({\n                btn: true,\n                \"btn-sm\": true,\n                \"btn-warning\": \"switch-token-type\" === currentMode,\n                \"btn-outline-warning\": \"switch-token-type\" !== currentMode\n              })}\n            >\n              {tokenType && tokenLabel && (\n                <svg viewBox=\"-0.1 -0.1 1.15 1.15\" width={16} height={16}>\n                  <DisplayToken\n                    tokenLabel={tokenLabel}\n                    tokenType={tokenType}\n                    tokenSize={1}\n                  />\n                </svg>\n              )}\n            </a>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { ModeService } from \"../services/ModeService\";\nimport { DrawingService } from \"../services/modebased/DrawingService\";\nimport { ManageTokenService } from \"../services/modebased/ManageTokenService\";\nimport { DrawingControlBar } from \"./ControlBar/DrawingControlBar\";\nimport { ModeControlBar } from \"./ControlBar/ModeControlBar\";\nimport { ManageTokenControlBar } from \"./ControlBar/ManageTokenControlBar\";\n\ninterface Props {\n  modeService: ModeService;\n  backgroundDrawingService: DrawingService;\n  notesDrawingService: DrawingService;\n  manageTokenService: ManageTokenService;\n}\n\nexport const ControlBar: FC<Props> = ({\n  modeService,\n  notesDrawingService,\n  backgroundDrawingService,\n  manageTokenService\n}: Props) => {\n  return (\n    <div className=\"navbar navbar-dark bg-dark control-pane\">\n      <ModeControlBar modeService={modeService} />\n      <DrawingControlBar drawingService={notesDrawingService} />\n      <DrawingControlBar drawingService={backgroundDrawingService} />\n      <ManageTokenControlBar manageTokenService={manageTokenService} />\n    </div>\n  );\n};\n","import React, { FC } from \"react\";\nimport { ReactElementLike } from \"prop-types\";\n\ninterface Props {\n  component: (item: any) => ReactElementLike;\n  items: ReadonlyArray<any>;\n  columns: number;\n}\n\nexport const LayoutGrid: FC<Props> = ({ items, columns, component }: Props) => {\n  return (\n    <div className=\"row p-2\">\n      {items.map((item, idx) => (\n        <div key={idx} className={`col-${12 / columns}`}>\n          {component(item)}\n        </div>\n      ))}\n    </div>\n  );\n};\n","import React, { FC } from \"react\";\nimport { DisplayToken } from \"../../../../common/DisplayToken\";\nimport { TokenType } from \"../../../../model/TokenType\";\nimport { classesMap } from \"../../../../utils/classesMap\";\nimport { ViewBox } from \"../../../../model/ViewBox\";\nimport { BackgroundGrid } from \"../PlayMap/BackgroundGrid\";\n\ninterface Props {\n  tokenType: TokenType;\n  tokenLabel: string;\n  tokenSize: number;\n  onClick: () => void;\n  selected: boolean;\n  svgSize: number;\n  maxTokenSize: number;\n}\n\nexport const TokenTypeSelection: FC<Props> = ({\n  tokenType,\n  tokenLabel,\n  tokenSize,\n  onClick,\n  selected,\n  svgSize,\n  maxTokenSize\n}: Props) => {\n  const viewBox = new ViewBox(\n    -0.25,\n    -0.25,\n    maxTokenSize + 0.5,\n    maxTokenSize + 0.5\n  );\n  return (\n    <a\n      className={classesMap({\n        btn: true,\n        \"btn-outline-secondary\": !selected,\n        \"btn-secondary\": selected\n      })}\n      onClick={event => {\n        event.preventDefault();\n        onClick();\n      }}\n    >\n      <svg viewBox={viewBox.toViewBoxString()} width={svgSize} height={svgSize}>\n        <BackgroundGrid width={maxTokenSize} height={maxTokenSize} />\n        <DisplayToken\n          tokenLabel={tokenLabel}\n          tokenType={tokenType}\n          tokenSize={tokenSize}\n        />\n      </svg>\n    </a>\n  );\n};\n","import React, {\n  FC,\n  ReactChild,\n  ReactChildren,\n  useLayoutEffect,\n  useRef\n} from \"react\";\nimport $ from \"jquery\";\n\ninterface Props {\n  children: ReactChild | ReactChildren | false | undefined;\n  onOk?: () => void;\n  onCancel?: () => void;\n  buttonText: string;\n  header: string;\n  open: boolean;\n  okEnabled?: boolean;\n}\n\nexport const Modal: FC<Props> = ({\n  children,\n  onOk,\n  okEnabled,\n  onCancel,\n  buttonText,\n  header,\n  open\n}: Props) => {\n  const modalElementRef = useRef<HTMLDivElement>(null);\n\n  useLayoutEffect(() => {\n    $(modalElementRef.current!)\n      .modal(\"hide\")\n      .on(\"hide.bs.modal\", () => {\n        onCancel && onCancel();\n      });\n  }, [onCancel]);\n\n  useLayoutEffect(() => {\n    console.log(\"effect after open\", open);\n    $(modalElementRef.current!).modal(open ? \"show\" : \"hide\");\n  }, [open]);\n\n  const ok = (): void => {\n    $(modalElementRef.current!).modal(\"hide\");\n    onOk && onOk();\n  };\n\n  return (\n    <div\n      ref={modalElementRef}\n      className=\"modal fade\"\n      id=\"exampleModal\"\n      tabIndex={-1}\n    >\n      <div className=\"modal-dialog modal-lg modal-dialog-centered\">\n        <div className=\"modal-content\">\n          <div className=\"modal-header\">\n            <h5 className=\"modal-title\">{header}</h5>\n            <button type=\"button\" className=\"close\" onClick={onCancel}>\n              <span>&times;</span>\n            </button>\n          </div>\n          <div className=\"modal-body\">{children}</div>\n          <div className=\"modal-footer\">\n            {onOk && (\n              <button\n                onClick={ok}\n                disabled={okEnabled !== undefined && !okEnabled}\n                type=\"button\"\n                className=\"btn btn-primary\"\n              >\n                {buttonText}\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React, { FC, useCallback } from \"react\";\nimport { LayoutGrid } from \"../../../common/LayoutGrid\";\nimport { TokenTypeSelection } from \"./AddTokenModal/TokenTypeSelection\";\nimport { Modal } from \"../../../common/Modal\";\nimport { ManageTokenService } from \"../services/modebased/ManageTokenService\";\nimport { useObservable } from \"../../../utils/useObservable\";\nimport { AssetService } from \"../services/AssetService\";\nimport { range } from \"../../../utils/range\";\n\ninterface Props {\n  assetService: AssetService;\n  manageTokenService: ManageTokenService;\n}\n\nexport const AddTokenModal: FC<Props> = ({\n  assetService,\n  manageTokenService\n}: Props) => {\n  const showModal = useObservable(manageTokenService.isSwitchTokenType$, false);\n  const selectedTokenType = useObservable(\n    manageTokenService.tokenType$,\n    manageTokenService.tokenType\n  );\n  const selectedTokenLabel = useObservable(\n    manageTokenService.tokenLabel$,\n    manageTokenService.tokenLabel\n  );\n  const selectedTokenSize = useObservable(\n    manageTokenService.tokenSize$,\n    manageTokenService.tokenSize\n  );\n\n  const onCancel = useCallback(\n    () => manageTokenService.switchMode(\"add-token\"),\n    [manageTokenService]\n  );\n\n  return (\n    <Modal\n      onCancel={onCancel}\n      buttonText={\"place it\"}\n      header={\"Add Token\"}\n      open={showModal}\n    >\n      {!!selectedTokenLabel && !!selectedTokenType && !!selectedTokenSize && (\n        <div>\n          <div className=\"row\">\n            <div className=\"col-4\">\n              <LayoutGrid\n                items={assetService.tokenTypes}\n                columns={4}\n                component={tokenType => (\n                  <TokenTypeSelection\n                    tokenLabel={selectedTokenLabel}\n                    tokenType={tokenType}\n                    tokenSize={1} // to preserve the layout\n                    onClick={() => manageTokenService.setTokenType(tokenType)}\n                    selected={tokenType === selectedTokenType}\n                    svgSize={35}\n                    maxTokenSize={1}\n                  />\n                )}\n              />\n            </div>\n            <div className=\"col-4\">\n              <LayoutGrid\n                items={assetService.tokenLabels}\n                columns={4}\n                component={label => (\n                  <TokenTypeSelection\n                    tokenLabel={label}\n                    tokenType={selectedTokenType}\n                    tokenSize={1} // to preserve the layout\n                    onClick={() => manageTokenService.setTokenLabel(label)}\n                    selected={selectedTokenLabel === label}\n                    svgSize={35}\n                    maxTokenSize={1}\n                  />\n                )}\n              />\n            </div>\n            <div className=\"col-4\">\n              <LayoutGrid\n                items={range(3)}\n                columns={1}\n                component={i => {\n                  const size = i + 1;\n                  return (\n                    <TokenTypeSelection\n                      tokenLabel={selectedTokenLabel}\n                      tokenType={selectedTokenType}\n                      tokenSize={size}\n                      onClick={() => manageTokenService.setTokenSize(size)}\n                      selected={selectedTokenSize === size}\n                      svgSize={90}\n                      maxTokenSize={3}\n                    />\n                  );\n                }}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </Modal>\n  );\n};\n","import React, { FC } from \"react\";\nimport { PlayMap } from \"./Layout/PlayMap\";\nimport { ControlBar } from \"./Layout/ControlBar\";\nimport { AddTokenModal } from \"./Layout/AddTokenModal\";\nimport { Services } from \"./services/Services\";\n\ninterface Props extends Services {}\n\nexport const Layout: FC<Props> = (props: Props) => {\n  return (\n    <>\n      {\n        <div className=\"App h-100\">\n          <PlayMap {...props!} />\n          <ControlBar {...props!} />\n        </div>\n      }\n      {\n        <div className=\"App h-100\">\n          <AddTokenModal {...props} />\n        </div>\n      }\n    </>\n  );\n};\n","import React, { FC } from \"react\";\nimport { FullPageWithHeading } from \"../../common/FullPageWithHeading\";\nimport { Link } from \"react-router-dom\";\nimport { routing } from \"../../App\";\n\ninterface Props {}\n\nexport const NoSessionsFound: FC<Props> = ({  }: Props) => {\n  return (\n    <FullPageWithHeading heading={<h1>Welcome to Gridheim, Stranger!</h1>}>\n      <h3>No Session found</h3>\n      <span>\n        It seems that you don&apos;t have a session (yet) or that the session is\n        invalid :(\n      </span>\n      <br />\n      <br />\n      <span>\n        Please go <Link to={routing.sessions}>here</Link> to create a session so\n        we can play :D\n      </span>\n    </FullPageWithHeading>\n  );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { Token } from \"../model/Token\";\nimport { Square } from \"../model/Square\";\nimport { DrawingPane } from \"../model/DrawingPane\";\nimport { map } from \"rxjs/operators\";\nimport { Services } from \"./PlayApp/services/Services\";\nimport { BattleMapService } from \"./PlayApp/services/BattleMapService\";\nimport { PlayModeService } from \"./PlayApp/services/modebased/PlayModeService\";\nimport { DrawingService } from \"./PlayApp/services/modebased/DrawingService\";\nimport { AssetService } from \"./PlayApp/services/AssetService\";\nimport { ManageTokenService } from \"./PlayApp/services/modebased/ManageTokenService\";\nimport { ModeService } from \"./PlayApp/services/ModeService\";\nimport { SaveSessionService } from \"./PlayApp/services/SaveSessionService\";\nimport { Layout } from \"./PlayApp/Layout\";\nimport { SessionStorage } from \"../services/SessionStorage\";\nimport { GridMapStorage } from \"../services/GridMapStorage\";\nimport { NoSessionsFound } from \"./PlayApp/NoSessionsFound\";\nimport { StorageProvider } from \"../services/StorageProvider\";\n\ninterface Props {\n  storageProvider: StorageProvider;\n}\n\nexport const PlayApp: FC<Props> = ({ storageProvider }: Props) => {\n  const [services, setServices] = useState<Services | null>(null);\n  const [sessionLoaded, setSessionLoaded] = useState<\n    \"FAILED\" | \"LOADING\" | \"LOADED\"\n  >(\"LOADING\");\n  useEffect(() => {\n    const saveSessionService = new SaveSessionService(\n      new GridMapStorage(storageProvider),\n      new SessionStorage(storageProvider)\n    );\n    const battleMapService = new BattleMapService(saveSessionService);\n    const playModeService = new PlayModeService(battleMapService);\n    const backgroundDrawingService = new DrawingService();\n    const notesDrawingService = new DrawingService();\n    const assetService = new AssetService();\n    const manageTokenService = new ManageTokenService(\n      battleMapService,\n      assetService\n    );\n    const modeService = new ModeService(\"play\", {\n      play: playModeService,\n      \"draw-background\": backgroundDrawingService,\n      \"draw-notes\": notesDrawingService,\n      \"manage-token\": manageTokenService,\n      zoom: null\n    });\n\n    saveSessionService\n      .add(\"tokens\", battleMapService.tokens$)\n      .subscribe(tokensJson => {\n        const mappedTokens = tokensJson.flatMap(tokenJson => {\n          const tokenType = assetService.tokenTypeForName(\n            tokenJson.tokenType.name\n          );\n          if (!tokenType) {\n            return [];\n          }\n          return [\n            new Token(\n              tokenJson.id,\n              tokenType,\n              tokenJson.label,\n              new Square(tokenJson.square.x, tokenJson.square.y),\n              tokenJson.size\n            )\n          ];\n        });\n\n        battleMapService.updateTokens(() => mappedTokens);\n      });\n\n    saveSessionService\n      .add(\n        \"background-pane\",\n        backgroundDrawingService.pane$.pipe(\n          map(p => p.withCurrentDrawingRemoved())\n        )\n      )\n      .subscribe(paneJson => {\n        backgroundDrawingService.setPane(DrawingPane.fromJson(paneJson));\n      });\n\n    saveSessionService\n      .add(\n        \"notes-pane\",\n        notesDrawingService.pane$.pipe(map(p => p.withCurrentDrawingRemoved()))\n      )\n      .subscribe(paneJson => {\n        notesDrawingService.setPane(DrawingPane.fromJson(paneJson));\n      });\n\n    saveSessionService\n      .loadAndStart()\n      .toPromise()\n      .then(result => setSessionLoaded(result ? \"LOADED\" : \"FAILED\"));\n\n    setServices({\n      battleMapService,\n      playModeService,\n      backgroundDrawingService,\n      notesDrawingService,\n      modeService,\n      manageTokenService,\n      assetService\n    });\n    return () => {\n      console.log(\"disposing PlayApp\");\n      saveSessionService.saveSession();\n      battleMapService.dispose();\n      playModeService.dispose();\n      backgroundDrawingService.dispose();\n      notesDrawingService.dispose();\n      modeService.dispose();\n      manageTokenService.dispose();\n      assetService.dispose();\n    };\n  }, [storageProvider]);\n\n  return (\n    <>\n      {(!services || sessionLoaded === \"LOADING\") && (\n        <div className=\"App h-100\">\n          <span>loading ...</span>\n        </div>\n      )}\n      {sessionLoaded === \"FAILED\" && !!services && <NoSessionsFound />}\n      {sessionLoaded === \"LOADED\" && !!services && <Layout {...services} />}\n    </>\n  );\n};\n","import { StorageProvider } from \"./StorageProvider\";\nimport Dexie from \"dexie\";\nimport { Observable } from \"rxjs\";\nimport { fromPromise } from \"rxjs/internal-compatibility\";\n\nexport class IndexedDbStorageProvider implements StorageProvider {\n  private static readonly TABLE_NAME = \"blobs\";\n\n  private readonly db = new Dexie(\"GridHeimBlobStorage\");\n  private readonly blobs: Dexie.Table<\n    { key: string; value: string },\n    string\n  > = (() => {\n    this.db.version(1).stores({\n      [IndexedDbStorageProvider.TABLE_NAME]: \"key,value\"\n    });\n    return this.db.table(IndexedDbStorageProvider.TABLE_NAME);\n  })();\n\n  get(key: string): Observable<string | null> {\n    return fromPromise(\n      this.blobs.get(key).then(entry => (entry ? entry.value : null))\n    );\n  }\n\n  listKeys(): Observable<ReadonlyArray<string>> {\n    return fromPromise(\n      this.blobs\n        .toArray()\n        .then(result => Object.freeze(result.map(entry => entry.key)))\n    );\n  }\n\n  set(key: string, value: string): Observable<void> {\n    return fromPromise(this.blobs.put({ key, value }).then(() => undefined));\n  }\n\n  remove(key: string): Observable<void> {\n    return fromPromise(this.blobs.delete(key).then(() => undefined));\n  }\n}\n","import React, { FC, useState } from \"react\";\nimport { HashRouter as Router, Route, Switch } from \"react-router-dom\";\nimport { GridMapsApp } from \"./App/GridMapsApp\";\nimport { GlobalMenu } from \"./App/GlobalMenu\";\nimport { SessionsApp } from \"./App/SessionsApp\";\nimport { ManageTokenTypesApp } from \"./App/ManageTokenTypesApp\";\nimport { AboutApp } from \"./App/AboutApp\";\nimport { RedirectToAboutOnFirstVisit } from \"./App/RedirectToAboutOnFirstVisit\";\nimport { PlayApp } from \"./App/PlayApp\";\nimport { IndexedDbStorageProvider } from \"./services/IndexedDbStorageProvider\";\n\nexport const routing = {\n  play: \"/\",\n  sessions: \"/sessions\",\n  manageGridMaps: \"/manage-maps\",\n  manageTokenTypes: \"/manage-token-types\",\n  about: \"/about\"\n};\n\ninterface Props {}\n\nexport const App: FC<Props> = ({  }: Props) => {\n  // const [storageProvider] = useState(() => new LocalStorageStorageProvider());\n  const [storageProvider] = useState(() => new IndexedDbStorageProvider());\n\n  return (\n    <>\n      <Router>\n        <div className=\"h-100\">\n          <GlobalMenu />\n          <Switch>\n            <Route path={routing.play} exact={true}>\n              <RedirectToAboutOnFirstVisit>\n                <PlayApp storageProvider={storageProvider} />\n              </RedirectToAboutOnFirstVisit>\n            </Route>\n            <Route path={routing.sessions}>\n              <RedirectToAboutOnFirstVisit>\n                <SessionsApp storageProvider={storageProvider} />\n              </RedirectToAboutOnFirstVisit>\n            </Route>\n            <Route path={routing.manageGridMaps}>\n              <RedirectToAboutOnFirstVisit>\n                <GridMapsApp storageProvider={storageProvider} />\n              </RedirectToAboutOnFirstVisit>\n            </Route>\n            <Route path={routing.manageTokenTypes}>\n              <RedirectToAboutOnFirstVisit>\n                <ManageTokenTypesApp />\n              </RedirectToAboutOnFirstVisit>\n            </Route>\n            <Route path={routing.about}>\n              <AboutApp />\n            </Route>\n          </Switch>\n        </div>\n      </Router>\n    </>\n  );\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import flatMap from \"array.prototype.flatmap\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport { App } from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport \"jquery\";\nimport \"popper.js\";\nimport \"bootstrap\";\nflatMap.shim();\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}