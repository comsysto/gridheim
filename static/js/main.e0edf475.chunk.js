(this.webpackJsonpgridheim=this.webpackJsonpgridheim||[]).push([[0],{103:function(e,t,a){},119:function(e,t){},138:function(e,t,a){"use strict";a.r(t);var n,r,c,o=a(0),i=a.n(o),l=a(93),s=a.n(l),u=(a(103),a(2)),m=a(9),d=a(25),b=a(26),h=a(3),f=a(11),p=a(10),g=a(12),v=a(4),E=a(52);function S(){return function(e){e[E.b]=!0}}var y=S()((c=r=function(){function e(t,a,n){Object(h.a)(this,e),this.name=t,this.image=a,this.transformation=n}return Object(v.a)(e,null,[{key:"storageKey",value:function(e){return"".concat(this.STORAGE_KEY_PREFIX).concat(e)}},{key:"isStorageKey",value:function(e){return e.startsWith(this.STORAGE_KEY_PREFIX)}},{key:"of",value:function(t){return Object.freeze(new e(t.name,t.image,t.transformation))}}]),Object(v.a)(e,[{key:"with",value:function(t){var a=new e(this.name,this.image,this.transformation);return Object.freeze(Object.assign(a,t))}},{key:"getWidthInSquares",value:function(){return Math.ceil(this.image.width*this.transformation.scale)}},{key:"getHeightInSquares",value:function(){return Math.ceil(this.image.height*this.transformation.scale)}}]),e}(),r.STORAGE_KEY_PREFIX="map-",n=c))||n,k=function(){function e(t,a,n){Object(h.a)(this,e),this.dx=t,this.dy=a,this.scale=n}return Object(v.a)(e,null,[{key:"default",value:function(){return Object.freeze(new e(0,0,1))}},{key:"of",value:function(t){return Object.freeze(new e(t.dx,t.dy,t.scale))}}]),Object(v.a)(e,[{key:"with",value:function(t){var a=new e(this.dx,this.dy,this.scale);return Object.freeze(Object.assign(a,t))}},{key:"asTransformString",value:function(){return"scale(".concat(this.scale," ").concat(this.scale,") translate(").concat(this.dx," ").concat(this.dy,")")}}]),e}(),w=function(){function e(t,a,n){Object(h.a)(this,e),this.url=t,this.width=a,this.height=n}return Object(v.a)(e,null,[{key:"of",value:function(t){return Object.freeze(new e(t.url,t.width,t.height))}}]),Object(v.a)(e,[{key:"with",value:function(t){var a=new e(this.url,this.width,this.height);return Object.freeze(Object.assign(a,t))}}]),e}(),O=a(141),j=a(142),N=a(140),x=a(58),$=function(){function e(t){Object(h.a)(this,e),this.storageProvider=t,this.isStorageKey=void 0,this.toStorageKey=void 0,this.parseJson=void 0,this.keyToStorageKey=void 0}return Object(v.a)(e,[{key:"findAll",value:function(){var e=this;return this.storageProvider.listKeys().pipe(Object(N.a)((function(t){var a=t.flatMap((function(t){return t&&e.isStorageKey(t)?[e.loadObject(t)]:[]}));return 0===a.length?Object(O.a)([]):Object(j.a)(a).pipe(Object(x.a)((function(e){return e.flatMap((function(e){return e?[e]:[]}))})),Object(x.a)((function(e){return Object.freeze(e)})))})))}},{key:"findBy",value:function(e){return this.loadObject(this.keyToStorageKey(e))}},{key:"store",value:function(e){var t=JSON.stringify(e);return this.storageProvider.set(this.toStorageKey(e),t)}},{key:"loadObject",value:function(e){var t=this;return this.storageProvider.get(e).pipe(Object(x.a)((function(a){if(null===a)return null;var n=JSON.parse(a);try{return t.parseJson(n)}catch(r){return console.log("Failed loading ".concat(e," from local storage"),{name:e,e:r}),null}})))}},{key:"delete",value:function(e){return e?this.storageProvider.remove(this.keyToStorageKey(e)):Object(O.a)(void 0)}}]),e}(),T=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(f.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).isStorageKey=function(e){return y.isStorageKey(e)},a.parseJson=function(e){return y.of({name:e.name,image:w.of(e.image),transformation:k.of(e.transformation)})},a.toStorageKey=function(e){return y.storageKey(e.name)},a.keyToStorageKey=function(e){return y.storageKey(e)},a}return Object(g.a)(t,e),t}($),C=function(e){var t=e.className,a=e.children;return i.a.createElement("div",{className:"list-group ".concat(t||"")},a)},M=function(e){var t=e.children,a=e.className,n=e.active,r=e.onClick;return i.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),r&&r()},className:"list-group-item list-group-item-action ".concat(a," ").concat(n?"active":"")},t)},D=function(e){var t=e.children;return i.a.createElement("div",{className:"media"},t)},P=function(e){var t=e.children;return i.a.createElement("div",{className:"media-body"},t)},A=function(e){var t=e.gridMaps,a=e.selected,n=e.onSelect;return i.a.createElement(C,null,Object.values(t).map((function(e){return i.a.createElement(M,{active:e===a,key:e.name,onClick:function(){return n(e)}},i.a.createElement(D,null,i.a.createElement(P,null,i.a.createElement("h4",null,e.name),i.a.createElement("dl",{className:"row"},i.a.createElement("dt",{className:"col-sm-3"},"Size in Squares"),i.a.createElement("dd",{className:"col-sm-9"},e.getWidthInSquares(),"x",e.getHeightInSquares()),i.a.createElement("dt",{className:"col-sm-3"},"Scale"),i.a.createElement("dd",{className:"col-sm-9"},e.transformation.scale),i.a.createElement("dt",{className:"col-sm-3"},"X Offset"),i.a.createElement("dd",{className:"col-sm-9"},e.transformation.dx),i.a.createElement("dt",{className:"col-sm-3"},"Y Offset"),i.a.createElement("dd",{className:"col-sm-9"},e.transformation.dy))),i.a.createElement("img",{className:"ml-3 img-thumbnail image-300",src:e.image.url})))})))},I=function(e){var t=e.heading,a=e.children;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"container fixed-top text-center full-page-with-heading_heading-container bg-white"},t),i.a.createElement("div",{className:"container h-100 scrollable-y full-page-with-heading_content-container"},a))},z=function(e){var t=e.children;return i.a.createElement("div",{className:"alert alert-primary"},t)},q=function(e){var t=e.url,a=e.onUrlChange;return i.a.createElement(i.a.Fragment,null,!!t||i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(z,null,"Select a image from your computer, that should be used as map.",i.a.createElement("br",null),"This file is ",i.a.createElement("em",null,"not")," uploaded in the internet but stored in your browser ..."),i.a.createElement("div",{className:"custom-file"},i.a.createElement("input",{type:"file",className:"custom-file-input",id:"customFile",onChange:function(e){var t=e.target.files;if(t&&t.length>0){var n=t[0],r=new FileReader;r.onloadend=function(){var e=r.result;a(e)},r.readAsDataURL(n)}}}),i.a.createElement("label",{className:"custom-file-label",htmlFor:"customFile"},"Choose file")))),!!t&&i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",null,i.a.createElement("button",{className:"btn btn-secondary btn-sm",type:"button",onClick:function(){a("")}},"Change")),i.a.createElement("img",{className:"img-thumbnail gridMap-form_image-preview",src:t}))))},L=a(7),G=a(1);function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.currentTarget,a=t.ownerSVGElement.createSVGPoint();return a.x=e.clientX,a.y=e.clientY,a.matrixTransform(t.getScreenCTM().inverse())}function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(a,!0).forEach((function(t){Object(L.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var _=function(e){var t=e.image,a=e.onApply,n=Object(o.useState)(k.default()),r=Object(u.a)(n,2),c=r[0],l=r[1];Object(o.useEffect)((function(){l(k.default().with({scale:600/t.width*2,dx:0,dy:0}))}),[t]);var s=Object(o.useState)(null),m=Object(u.a)(s,2),d=m[0],b=m[1],h=Object(o.useState)(!1),f=Object(u.a)(h,2),p=f[0],g=f[1],v=t.width/300;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(z,null,"For a rough size estimation, draw a rect over the image where a square of the battle grid should be displayed later.",i.a.createElement("br",null),"In the next step this grid can be further adjusted ..."),i.a.createElement("div",{className:"mb-2"},i.a.createElement("button",{className:"btn btn-sm btn-secondary",onClick:function(){l(c.with({scale:c.scale+.1}))},type:"button"},i.a.createElement(G.G,{icon:G.g})),i.a.createElement("button",{className:"btn btn-sm btn-secondary ml-2",onClick:function(){l(c.with({scale:c.scale-.1}))},type:"button"},i.a.createElement(G.G,{icon:G.h}))),i.a.createElement("svg",{style:{width:600,height:600},className:"img-thumbnail"},i.a.createElement("g",{transform:c.asTransformString(),onPointerDown:function(e){var t=F(e),a=t.x,n=t.y;b({x:a,y:n,a:0}),g(!0),e.currentTarget.setPointerCapture(e.pointerId)},onPointerUpCapture:function(e){if(p&&d){var t=F(e),a=t.x,n=t.y,r=a-d.x,c=n-d.y,o=Math.max(0,Math.max(r,c));b(B({},d,{a:o})),g(!1),e.currentTarget.releasePointerCapture(e.pointerId)}},onPointerMoveCapture:function(e){if(p&&d){var t=F(e),a=t.x,n=t.y,r=a-d.x,c=n-d.y,o=Math.max(0,Math.max(r,c));b(B({},d,{a:o}))}}},i.a.createElement("image",{width:t.width,height:t.height,xlinkHref:t.url}),d&&i.a.createElement("rect",{x:d.x,y:d.y,width:d.a,height:d.a,stroke:"red",fillOpacity:0,strokeDasharray:"".concat(v," ").concat(2*v),strokeWidth:v}))),i.a.createElement("div",null,i.a.createElement("button",{className:"btn btn-sm btn-success mt-2",onClick:function(){if(d){var e=1/d.a,t=-d.x%d.a,n=-d.y%d.a;a(k.of({dx:t,dy:n,scale:e}))}},type:"button"},i.a.createElement(G.G,{icon:G.e}),"Next")))))},K=a(34),U=function(e){return Object(K.a)(Array(e).keys())},W=function(e){var t=e.image,a=e.onApply,n=e.transformation,r=Object(o.useState)(n),c=Object(u.a)(r,2),l=c[0],s=c[1],m=Object(o.useState)(10),d=Object(u.a)(m,2),b=d[0],h=d[1],f=Math.ceil(t.width*n.scale+1),p=Math.ceil(t.height*n.scale+1),g=function(e,t){return i.a.createElement("button",{className:"btn btn-sm btn-secondary",onClick:t,type:"button"},i.a.createElement(G.G,{icon:e}))};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(z,null,"As I promised! Here you can make last adjustments to the grid ..."),i.a.createElement("div",{className:"mb-2"},g(G.g,(function(){h(Math.max(2,b-1))})),g(G.h,(function(){h(b+1)})),g(G.y,(function(){s(l.with({scale:l.scale-.002*l.scale}))})),g(G.x,(function(){s(l.with({scale:l.scale+.002*l.scale}))})),g(G.d,(function(){s(l.with({dy:l.dy+l.dy*l.scale}))})),g(G.a,(function(){s(l.with({dy:l.dy-l.dy*l.scale}))})),g(G.b,(function(){s(l.with({dx:l.dx+l.dx*l.scale}))})),g(G.c,(function(){s(l.with({dx:l.dx-l.dx*l.scale}))}))),i.a.createElement("svg",{style:{width:600,height:600},viewBox:"".concat(f-b," ").concat(p-b," ").concat(b," ").concat(b),className:"img-thumbnail"},i.a.createElement("g",{transform:l.asTransformString()},i.a.createElement("image",{width:t.width,height:t.height,xlinkHref:t.url})),U(f).map((function(e){return U(p).map((function(t){return i.a.createElement("rect",{key:"".concat(e,"/").concat(t),x:e,y:t,width:"1",height:"1",stroke:"red",strokeWidth:.03,fillOpacity:0})}))}))),i.a.createElement("div",null,i.a.createElement("button",{className:"btn btn-sm btn-success mt-2",onClick:function(){l&&a(l)},type:"button"},i.a.createElement(G.G,{icon:G.e}),"Next")))))},Y=function(e){var t=e.image,a=e.onApply,n=e.onAdjustGrid,r=Object(o.useState)(null),c=Object(u.a)(r,2),l=c[0],s=c[1];return i.a.createElement(i.a.Fragment,null,t&&!l&&i.a.createElement(_,{image:t,onApply:function(e){s(e),n()}}),t&&l&&i.a.createElement(W,{image:t,transformation:l,onApply:function(e){a(e)}}))},H=function(e){var t=e.onSave,a=Object(o.useState)(""),n=Object(u.a)(a,2),r=n[0],c=n[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"alert alert-primary"},"Last step provide a good name for the map ... and your done :D"),i.a.createElement("div",{className:"input-group mb-2"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("div",{className:"input-group-text"},i.a.createElement(G.G,{icon:G.B}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Background Name",onChange:function(e){c(e.target.value)},value:r})))),i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){r&&t(r)}},"Save"))))},J=function(e){var t=e.steps,a=e.active,n=t.indexOf(a);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,t.map((function(e,t){var a=t===n,r=t>n;return i.a.createElement("span",{key:e},i.a.createElement("span",{className:"badge badge-".concat(a?"primary":r?"secondary":"success"," ml-2 mr-2")},a&&i.a.createElement(G.G,{icon:G.A}),e),i.a.createElement(G.G,{icon:G.f}))})),i.a.createElement("span",{className:"badge badge-dark  ml-2 mr-2"},i.a.createElement(G.G,{icon:G.E})," Finished")))},X={upload:"Upload Image",selectSquare:"Select a Square",adjustGrid:"Adjust Grid Size",metadata:"Add Metadata"},V=function(e){var t=e.onSave,a=e.onCancel,n=Object(o.useState)(void 0),r=Object(u.a)(n,2),c=r[0],l=r[1],s=Object(o.useState)(X.upload),m=Object(u.a)(s,2),d=m[0],b=m[1],h=Object(o.useState)(void 0),f=Object(u.a)(h,2),p=f[0],g=f[1],v=function(e){e&&c&&p&&t(y.of({name:e,image:c,transformation:p}))};return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header"},i.a.createElement("a",{href:"#",className:"btn btn-secondary float-right",onClick:function(e){e.preventDefault(),a()}},i.a.createElement(G.G,{icon:G.F})),i.a.createElement("h5",null,"Add Map")),i.a.createElement("div",{className:"card-body"},i.a.createElement(J,{steps:Object.values(X),active:d}),!c&&i.a.createElement(q,{url:void 0,onUrlChange:function(e){!function(e){if(e){var t=new Image;t.onload=function(){l(new w(e,t.width,t.height))},t.src=e}else l(void 0)}(e),b(X.selectSquare)}}),c&&!p&&i.a.createElement(Y,{image:c,onApply:function(e){g(e),b(X.metadata)},onAdjustGrid:function(){return b(X.adjustGrid)}}),c&&p&&i.a.createElement(H,{onSave:function(e){v(e)}})))},Q=function(e){var t=e.icon,a=e.headline,n=e.children;return i.a.createElement(i.a.Fragment,null,i.a.createElement("h1",null,i.a.createElement(G.G,{icon:t,size:40}),i.a.createElement("span",{className:"ml-4"},a)),n)},Z=function(e){var t=e.icon,a=e.headline,n=e.children;return i.a.createElement(Q,{icon:t,headline:a},i.a.createElement("div",{className:"ml-5 mt-3 mb-3 text-left"},i.a.Children.map(n,(function(e,t){return i.a.createElement(i.a.Fragment,null,0!==t&&i.a.createElement("span",{className:"ml-2"}),e)}))))},ee=function(e){var t=e.storageProvider,a=Object(o.useState)(!1),n=Object(u.a)(a,2),r=n[0],c=n[1],l=Object(o.useState)(null),s=Object(u.a)(l,2),m=s[0],d=s[1],b=Object(o.useState)((function(){return new T(t)})),h=Object(u.a)(b,1)[0],f=Object(o.useState)([]),p=Object(u.a)(f,2),g=p[0],v=p[1],E=function(){h.findAll().subscribe({next:v})};Object(o.useEffect)((function(){E()}),[]);var S=i.a.createElement(Z,{icon:G.i,headline:"Manage Maps"},!r&&i.a.createElement("button",{className:"btn btn-primary",onClick:function(){return c(!0)}},i.a.createElement(G.G,{icon:G.u}),i.a.createElement("span",{className:"ml-2"},"New Map")),!r&&m&&i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{type:"button",className:"btn btn-danger ml-2",onClick:function(){h.delete(m.name),d(null),E()}},i.a.createElement(G.G,{icon:G.D}),"Delete Selected Map")));return i.a.createElement(i.a.Fragment,null,i.a.createElement(I,{heading:S},i.a.createElement(z,null,i.a.createElement("strong",null,"Maps")," are stored images with a grid drawn over them.",i.a.createElement("br",null),"You create a map by selecting an image file on your computer and configure a grid for them. The images are stored locally in your browser local storage and are not sent to the internet."),!r&&i.a.createElement("div",null,i.a.createElement("div",{className:"col-md-12"},i.a.createElement(A,{gridMaps:g,selected:m,onSelect:d}))),r&&i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(V,{onSave:function(e){h.store(e),E(),c(!1)},onCancel:function(){return c(!1)}})))))},te=function(e){return Object.keys(e).filter((function(t){return e[t]})).join(" ")},ae=i.a.createContext((function(){})),ne=function(e){var t=e.buttonContent,a=e.children,n=e.buttonClasses,r=Object(o.useRef)(null),c=Object(o.useState)(!1),l=Object(u.a)(c,2),s=l[0],m=l[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{ref:r,className:te({dropright:!0,show:s})},i.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),m(!s)},className:"btn "+n},t),i.a.createElement("div",{className:te({"dropdown-menu":!0,show:s})},i.a.createElement(ae.Provider,{value:function(){return m(!1)}},a))))},re=function(e){var t=e.to,a=e.children,n=Object(o.useContext)(ae);return i.a.createElement(d.b,{className:"dropdown-item",to:t,onClick:function(){return n()}},a)},ce=function(e){return Object(m.a)(e),i.a.createElement("div",{className:"dropdown-divider"})},oe=function(e){return Object(m.a)(e),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"navbar navbar-dark bg-dark logo-menu"},i.a.createElement(ne,{buttonContent:i.a.createElement("div",null,i.a.createElement("div",{className:"position-absolute"},i.a.createElement(G.G,{icon:G.C,width:30,height:50}))),buttonClasses:"mb-md-2 btn-outline-primary logo-button"},i.a.createElement(re,{to:Lt.play},i.a.createElement(G.G,{icon:G.t})," Play"),i.a.createElement(re,{to:Lt.sessions},i.a.createElement(G.G,{icon:G.w})," Sessions"),i.a.createElement(ce,null),i.a.createElement(re,{to:Lt.manageGridMaps},i.a.createElement(G.G,{icon:G.i})," Manage Maps"),i.a.createElement(ce,null),i.a.createElement(re,{to:Lt.about},i.a.createElement(G.G,{icon:G.l})," About"),i.a.createElement("a",{className:"dropdown-item",href:"https://legal.comsysto.com/comsysto.github.io/de/impressum/"},i.a.createElement(G.G,{icon:G.m})," Impressum"))))},ie=function(){function e(t,a,n,r){Object(h.a)(this,e),this.name=t,this.date=a,this.gridMapName=n,this.content=r}return Object(v.a)(e,null,[{key:"storageKey",value:function(e){return"".concat(this.STORAGE_KEY_PREFIX).concat(e)}},{key:"isStorageKey",value:function(e){return e.startsWith(this.STORAGE_KEY_PREFIX)}},{key:"of",value:function(t){return Object.freeze(new e(t.name,t.date,t.gridMapName,t.content))}}]),Object(v.a)(e,[{key:"with",value:function(t){var a=new e(this.name,this.date,this.gridMapName,this.content);return Object.freeze(Object.assign(a,t))}}]),e}();ie.STORAGE_KEY_PREFIX="session-",ie.CURRENT_SESSION_STORAGE_KEY="current-session";var le=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(f.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).isStorageKey=function(e){return ie.isStorageKey(e)},a.parseJson=function(e){return ie.of({name:e.name,date:e.date,gridMapName:e.gridMapName,content:e.content})},a.toStorageKey=function(e){return ie.storageKey(e.name)},a.keyToStorageKey=function(e){return ie.storageKey(e)},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"storeCurrentSessionName",value:function(e){return this.storageProvider.set(ie.CURRENT_SESSION_STORAGE_KEY,e)}},{key:"findCurrentSessionName",value:function(){return this.storageProvider.get(ie.CURRENT_SESSION_STORAGE_KEY)}}]),t}($),se={selectBackground:"Select Background",metadata:"Add Metadata"},ue=function(e){var t=e.onSave,a=e.onCancel,n=e.gridMaps,r=Object(o.useState)(se.selectBackground),c=Object(u.a)(r,2),l=c[0],s=c[1],m=Object(o.useState)(),d=Object(u.a)(m,2),b=d[0],h=d[1],f=Object(o.useState)(),p=Object(u.a)(f,2),g=p[0],v=p[1];return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header"},i.a.createElement("a",{href:"#",className:"btn btn-secondary float-right",onClick:function(e){e.preventDefault(),a()}},i.a.createElement(G.G,{icon:G.F})),i.a.createElement("h5",null,"Start Session")),i.a.createElement("div",{className:"card-body"},i.a.createElement(J,{steps:Object.values(se),active:l}),!b&&i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(z,null,"Select a map where you want to play from the list below ..."),i.a.createElement(A,{gridMaps:n,selected:null,onSelect:function(e){h(e.name),s(se.metadata)}}))),b&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(z,null,"Provide a memorable name and some other useful information ... and your done :D"),i.a.createElement("div",{className:"input-group mb-2"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("div",{className:"input-group-text"},i.a.createElement(G.G,{icon:G.B}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Session Name",onChange:function(e){return v(e.target.value)},value:g})))),i.a.createElement("div",{className:"row mt-3"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return g&&void(g&&b&&t(ie.of({name:g,date:(new Date).toLocaleString(),gridMapName:b,content:{}})))}},"Save"))))))},me=function(e){return Object(m.a)(e),i.a.createElement(i.a.Fragment,null,i.a.createElement("h3",null,"No Maps found"),i.a.createElement("span",null,"Oh no! It seems that you want create a sessions but we can't find any map :("),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("span",null,"Please go ",i.a.createElement(d.b,{to:Lt.manageGridMaps},"here")," to create a map.",i.a.createElement("br",null),"Afterwards come back via the menu in the top left corner (Sessions) to start a session."))},de=function(e){var t=e.sessions,a=e.gridMapsForName,n=e.selectedSessionName,r=e.onSelectSession;return i.a.createElement(C,null,t.map((function(e){var t=a[e.gridMapName];return i.a.createElement(M,{key:e.name,active:e.name===n,onClick:function(){r(e.name)}},i.a.createElement(D,null,i.a.createElement(P,null,i.a.createElement("h4",null,e.name),i.a.createElement("dl",{className:"row"},t&&i.a.createElement(i.a.Fragment,null,i.a.createElement("dt",{className:"col-sm-3"},"Map"),i.a.createElement("dd",{className:"col-sm-9"},t.name," (",t.getWidthInSquares(),"x",t.getHeightInSquares(),")")),i.a.createElement("dt",{className:"col-sm-3"},"Date"),i.a.createElement("dd",{className:"col-sm-9"},e.date)),!t&&i.a.createElement("span",{className:"badge badge-pill badge-danger"},"Invalid: Background is missing")),t&&i.a.createElement("img",{src:t.image.url,className:"img-thumbnail image-200"})))})))},be=a(143);var he,fe,pe=function(e){var t=e.storageProvider,a=Object(o.useState)(null),n=Object(u.a)(a,2),r=n[0],c=n[1],l=Object(o.useState)(!1),s=Object(u.a)(l,2),m=s[0],d=s[1],b=Object(o.useState)((function(){return new le(t)})),h=Object(u.a)(b,1)[0],f=Object(o.useState)((function(){return new T(t)})),p=Object(u.a)(f,1)[0],g=Object(o.useState)([]),v=Object(u.a)(g,2),E=v[0],S=v[1],y=Object(o.useState)({}),k=Object(u.a)(y,2),w=k[0],O=k[1],j=function(){Object(be.a)([h.findAll(),p.findAll(),h.findCurrentSessionName()]).subscribe({next:function(e){var t,a=Object(u.a)(e,3),n=a[0],r=a[1],o=a[2];S(n),O((t=function(e){return e.name},r.reduce((function(e,a){return e[t(a)]=a,e}),{}))),c(o)}})};Object(o.useEffect)((function(){j()}),[]);var N=0===Object.keys(w).length,x=i.a.createElement(Z,{icon:G.w,headline:"Sessions"},!N&&!m&&i.a.createElement("button",{className:"btn btn-primary",onClick:function(){return d(!0)}},i.a.createElement(G.G,{icon:G.u}),i.a.createElement("span",{className:"ml-2"},"Start Session")),!m&&r&&i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:function(){h.delete(r),c(null),j()}},i.a.createElement(G.G,{icon:G.D}),"Delete Selected")));return i.a.createElement(I,{heading:x},i.a.createElement(z,null,i.a.createElement("strong",null,"Sessions")," are the place where all token positions on the map and all drawings are stored.",i.a.createElement("br",null),"You can switch between sessions on this screen so you can come back to a game later ..."),N&&i.a.createElement(me,null),!N&&!m&&i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(de,{sessions:E,gridMapsForName:w,onSelectSession:function(e){c(e),h.storeCurrentSessionName(e)},selectedSessionName:r}))),!N&&m&&i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement(ue,{onSave:function(e){h.store(e),j(),d(!1)},onCancel:function(){d(!1)},gridMaps:Object.values(w)}))))},ge=function(e){return Object(m.a)(e),i.a.createElement(i.a.Fragment,null,i.a.createElement("h1",null,"Manage Token Types"))},ve=Object.freeze({React:{page:"https://reactjs.org",licence:"MIT",licenceUrl:"https://github.com/facebook/react/blob/master/LICENSE"},Bootstrap:{page:"https://getbootstrap.com",licence:"MIT",licenceUrl:"https://github.com/twbs/bootstrap/blob/master/LICENSEs"},"React Router":{page:"https://reacttraining.com/react-router/",licence:"MIT",licenceUrl:"https://github.com/ReactTraining/react-router/blob/master/LICENSE"},RxJS:{page:"https://rxjs-dev.firebaseapp.com/",licence:"Apache 2.0",licenceUrl:"https://github.com/ReactiveX/rxjs/blob/master/LICENSE.txt"},Typescript:{page:"https://www.typescriptlang.org/",licence:"Apache 2.0",licenceUrl:"https://github.com/microsoft/TypeScript/blob/master/LICENSE.txt"},Octicons:{page:"https://octicons.github.com/",licence:"MIT",licenceUrl:"https://github.com/primer/octicons/blob/master/LICENSE"},Formik:{page:"https://jaredpalmer.com/formik/docs/overview",licence:"MIT",licenceUrl:"https://github.com/jaredpalmer/formik/blob/master/LICENSE"},Immer:{page:"https://immerjs.github.io/immer/docs/introduction",licence:"MIT",licenceUrl:"https://github.com/immerjs/immer/blob/master/LICENSE"},"Dexie.js":{page:"https://dexie.org/",licence:"Apache 2.0",licenceUrl:"https://github.com/dfahlander/Dexie.js/blob/master/LICENSE"},JQuery:{page:"https://jquery.com/",licence:"MIT",licenceUrl:"https://github.com/jquery/jquery/blob/master/LICENSE.txt"},"Popper.js":{page:"https://popper.js.org/",licence:"MIT",licenceUrl:"https://github.com/FezVrasta/popper.js/blob/master/LICENSE.md"},"Create React App":{page:"https://create-react-app.dev/",licence:"MIT",licenceUrl:"https://github.com/facebook/create-react-app/blob/master/LICENSE"},"es-shims/Array.prototype.flatMap":{page:"https://github.com/es-shims/Array.prototype.flatMap",licence:"MIT",licenceUrl:"https://github.com/es-shims/Array.prototype.flatMap/blob/master/LICENSE"}}),Ee=function(e){return Object(m.a)(e),i.a.createElement(i.a.Fragment,null,i.a.createElement("h5",{className:"mt-5"},i.a.createElement(G.G,{icon:G.n,size:25}),i.a.createElement("span",{className:"ml-3"},"Open Source Software is used here ...")),i.a.createElement("blockquote",{className:"blockquote"},i.a.createElement("p",{className:"mb-0"},i.a.createElement("em",null,'"If I have seen further it is by standing on the shoulders of giants."')),i.a.createElement("footer",{className:"blockquote-footer"},i.a.createElement("cite",{title:"Source Title"},i.a.createElement("a",{href:"https://en.wikipedia.org/wiki/Bernard_of_Chartres"},"Bernard of Chartres")))),i.a.createElement("table",{className:"table"},i.a.createElement("thead",null,i.a.createElement("th",null,"Project"),i.a.createElement("th",null,"Website"),i.a.createElement("th",null,"Licence")),i.a.createElement("tbody",null,Object.entries(ve).map((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return i.a.createElement("tr",{key:a},i.a.createElement("td",null,a),i.a.createElement("td",null,i.a.createElement("a",{href:n.page},n.page)),i.a.createElement("td",null,i.a.createElement("a",{href:n.licenceUrl},n.licence)))})))))},Se=function(e){return Object(m.a)(e),i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,i.a.createElement("strong",null,"Gridheim")," is a digital grid map. Grid maps are used for pen&pencil roll playing games (like D&D, pathfinder, etc.) to show the position of characters and monsters on a map of the environment."),i.a.createElement("h5",{className:"mt-5"},i.a.createElement(G.G,{icon:G.o,size:25}),i.a.createElement("span",{className:"ml-3"},"The goals of ",i.a.createElement("strong",null,"Gridheim")," are ..."," ")),i.a.createElement("ul",null,i.a.createElement("li",null,"A good user experience"),i.a.createElement("li",null,"Cross platform and cross device compatibility"),i.a.createElement("li",null,"Pen support"),i.a.createElement("li",null,"Offline support via service worker"),i.a.createElement("li",null,"Data privacy - All data is only stored locally in your browser")))},ye=function(e){return Object(m.a)(e),i.a.createElement(i.a.Fragment,null,i.a.createElement(D,null,i.a.createElement(P,null,i.a.createElement("h5",{className:"mt-5"},i.a.createElement(G.G,{icon:G.j,size:25}),i.a.createElement("span",{className:"ml-3"},"Hello my name is ",i.a.createElement("strong",null,"Otto")," ...")),i.a.createElement("p",null,"... and I'm a Software Engineer at",i.a.createElement("a",{href:"https://comsystoreply.de/"}," Comsysto Reply "),"nice to meet you!",i.a.createElement("br",null),i.a.createElement("small",null,i.a.createElement("a",{href:"https://comsystoreply.de/karriere"},"(PS: we're hiring)"))),i.a.createElement("p",null,"Let me explain to you why I created yet another map tool :D ...",i.a.createElement("br",null),"It all begun when I searched for a way to visualise battles in my D&D campaign.",i.a.createElement("br",null),"The first approach was to use a physical map, which was nearly impossible for the huge maps that are often used in campaign books. The printout would be more than 2 meters in length.",i.a.createElement("br",null),"The next thing we tried was to use a tablet with a pen. This works quite smoothly because it has a similar usability than the pencil drawn maps of my youth, but it was quite challenging to move the tokens around. Every token has to be erased and drawn again in a other location. So we tried finding a dedicated software that would run on tablets, sadly we don't found one that has worked with the pen which was a blast to use :D ..."),i.a.createElement("p",null,"In the mean time I was building some dashboard prototypes at work that uses SVG graphics together with React which has quite similar characteristics ...",i.a.createElement("br",null),"... so I decided to give it a try, how hard can it be XD")),i.a.createElement("img",{className:"img-thumbnail mr-3",src:"https://www.gravatar.com/avatar/6f1aded52d041be71a1f5168c6b7e7dd?s=250"})))},ke=function(e){return Object(m.a)(e),i.a.createElement(I,{heading:i.a.createElement(Q,{icon:G.l,headline:"Welcome to Gridheim, Friend!"},i.a.createElement(d.b,{to:Lt.play},i.a.createElement(G.G,{icon:G.t})," Enough talk just start playing ..."))},i.a.createElement(Se,null),i.a.createElement(ye,null),i.a.createElement(Ee,null))},we=function(){function e(t,a){Object(h.a)(this,e),this.name=t,this.defaultValue=a}return Object(v.a)(e,[{key:"get",value:function(){var e=this.key;switch(localStorage.getItem(e)){case"true":return!0;case"false":return!1;default:return this.defaultValue}}},{key:"set",value:function(e){localStorage.setItem(this.key,"".concat(e))}},{key:"key",get:function(){return"toggle-".concat(this.name)}}]),e}(),Oe=Object.freeze({redirectToAbout:new we("redirect-to-about",!0)}),je=function(e){var t=e.children,a=Oe.redirectToAbout.get();return a&&Oe.redirectToAbout.set(!1),i.a.createElement(i.a.Fragment,null,a&&i.a.createElement(b.a,{to:Lt.about}),!a&&t)},Ne=S()(he=function e(t,a,n,r){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.size;Object(h.a)(this,e),this.id=t,this.tokenType=a,this.label=n,this.square=r,this.size=c})||he,xe=S()(fe=function(){function e(t,a){Object(h.a)(this,e),this.x=t,this.y=a}return Object(v.a)(e,[{key:"toCoordinateString",value:function(){return"".concat(this.x,"/").concat(this.y)}}]),e}())||fe,$e=function(){function e(t,a,n,r){Object(h.a)(this,e),this.id=t,this.path=a,this.color=n,this.width=r,this.current=this.id===e.CURRENT_ID}return Object(v.a)(e,null,[{key:"current",value:function(t,a){return new e(e.CURRENT_ID,[],t,a)}}]),Object(v.a)(e,[{key:"withPointAdded",value:function(t,a){return new e(this.id,[].concat(Object(K.a)(this.path),[[t,a]]),this.color,this.width)}},{key:"withId",value:function(t){return new e(t,this.path,this.color,this.width)}},{key:"svgPath",get:function(){return this.path.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" ")}}]),e}();$e.CURRENT_ID="current";var Te,Ce=function(){function e(t){Object(h.a)(this,e),this.drawings=t}return Object(v.a)(e,null,[{key:"fromJson",value:function(t){return new e(t.drawings.map((function(e){return new $e(e.id,e.path,e.color,e.width)})))}}]),Object(v.a)(e,[{key:"withDrawingAdded",value:function(t){return new e([].concat(Object(K.a)(this.drawings),[t]))}},{key:"withCurrentDrawingRemoved",value:function(){return this.withDrawingRemoved($e.CURRENT_ID)}},{key:"withDrawingRemoved",value:function(t){return new e(this.drawings.filter((function(e){return e.id!==t})))}}]),e}(),Me=S()(Te=function(){function e(t,a,n,r){Object(h.a)(this,e),this.x=t,this.y=a,this.width=n,this.height=r}return Object(v.a)(e,[{key:"toViewBoxString",value:function(){return"".concat(this.x," ").concat(this.y," ").concat(this.width," ").concat(this.height)}}]),e}())||Te,De=a(145);function Pe(){var e=(new Date).getTime();return"undefined"!==typeof performance&&"function"===typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:3&a|8).toString(16)}))}var Ae=a(146),Ie=a(153),ze=a(97),qe=a(144),Le=function(){function e(){Object(h.a)(this,e),this.disposeS$=new ze.a,this.dispose$=this.disposeS$.asObservable()}return Object(v.a)(e,[{key:"dispose",value:function(){this.disposeS$.next(),this.disposeS$.complete()}},{key:"untilDisposed",value:function(e){return e.pipe(Object(qe.a)(this.dispose$))}}]),e}(),Ge=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(p.a)(t).call(this))).sessionStorageService=e,a.tokensS$=new De.a([]),a.tokens$=a.tokensS$.asObservable(),a.gridMap$=a.sessionStorageService.gridMap$,a.selectedTokenS$=new De.a(null),a.selectedToken$=a.selectedTokenS$.asObservable(),a.selectedSquareS$=new De.a(null),a.selectedSquare$=a.selectedSquareS$.asObservable(),a.squareSelectableS$=new De.a(!1),a.squareSelectable$=a.squareSelectableS$.asObservable(),a.tokenSelectableS$=new De.a(!1),a.tokenSelectable$=a.tokenSelectableS$.asObservable(),a.tokenSizeS$=new De.a(1),a.tokenSize$=a.tokenSizeS$.asObservable(),a.hoveringSquareS$=new De.a(null),a.hoveringSquare$=a.hoveringSquareS$.asObservable(),a.highlightedSquares$=Object(be.a)([a.squareSelectable$,a.tokenSize$,a.selectedToken$,a.hoveringSquare$]).pipe(Object(x.a)((function(e){var a=Object(u.a)(e,4),n=a[0],r=a[1],c=a[2],o=a[3];if(!o||!n)return t.EMPTY_READONLY_ARRAY;var i=c?c.size:r,l=U(i).map((function(e){return U(i).map((function(t){return new xe(o.x+e,o.y+t)}))}));return Object.freeze(l.flat())})),Object(Ae.a)(50)),a.viewBox$=a.gridMap$.pipe(Object(x.a)((function(e){return e?new Me(0,0,e.getWidthInSquares(),e.getHeightInSquares()):new Me(0,0,0,0)}))),a.scaleS$=new De.a(1),a.scale$=a.scaleS$.asObservable().pipe(Object(Ie.a)(200)),a.positionS$=new De.a({x:0,y:0}),a.position$=a.positionS$.asObservable().pipe(Object(Ie.a)(200)),a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"selectToken",value:function(e){this.tokenSelectable&&this.selectedTokenS$.next(e)}},{key:"selectSquare",value:function(e){this.selectedSquareS$.next(e)}},{key:"updateTokens",value:function(e){var t=Object(E.a)(this.tokensS$.value,e);this.tokensS$.next(t);var a=this.selectedTokenS$.value;if(a){var n=this.tokensS$.value.find((function(e){return a.id===e.id}));this.selectedTokenS$.next(n||null)}}},{key:"addToken",value:function(e,t,a,n){this.updateTokens((function(r){r.push(new Ne(Pe(),e,t,n,a))}));var r=this.tokensS$.value;this.selectToken(r[r.length-1])}},{key:"setSquareSelectable",value:function(e){this.squareSelectableS$.next(e)}},{key:"setTokenSelectable",value:function(e){this.tokenSelectableS$.next(e)}},{key:"switchScale",value:function(e){this.scaleS$.next(1+.1*e)}},{key:"movePosition",value:function(e,t){var a=this.position,n=a.x,r=a.y;this.positionS$.next({x:n+e,y:r+t})}},{key:"removeSelectedToken",value:function(){if(null!==this.selectedToken){var e=this.selectedToken.id;this.updateTokens((function(t){return t.filter((function(t){return t.id!==e}))}))}}},{key:"hoverOverSquare",value:function(e){this.hoveringSquareS$.next(e)}},{key:"setTokenSize",value:function(e){this.tokenSizeS$.next(e)}},{key:"selectedToken",get:function(){return this.selectedTokenS$.value}},{key:"squareSelectable",get:function(){return this.squareSelectableS$.value}},{key:"tokenSelectable",get:function(){return this.tokenSelectableS$.value}},{key:"scale",get:function(){return this.scaleS$.value}},{key:"position",get:function(){return this.positionS$.value}},{key:"tokenSize",get:function(){return this.tokenSizeS$.value}}]),t}(Le);Ge.EMPTY_READONLY_ARRAY=Object.freeze([]);var Fe,Re,Be=a(147),_e=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(f.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).activeS$=new De.a(!1),a.active$=a.activeS$.asObservable(),a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"activate",value:function(e){var t=this;this.onActivate(e),e.subscribe({next:function(){return t.activeS$.next(!1)}}),this.activeS$.next(!0)}},{key:"active",get:function(){return this.activeS$.value}}]),t}(Le),Ke=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(p.a)(t).call(this))).battleMapService=e,a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"onActivate",value:function(e){var t=this;this.battleMapService.setTokenSelectable(!0),this.battleMapService.setSquareSelectable(!0),this.battleMapService.selectSquare(null),this.battleMapService.selectToken(null),Object(be.a)([this.battleMapService.selectedToken$,this.battleMapService.selectedSquare$]).pipe(Object(qe.a)(e),Object(Be.a)((function(e,t){return e===t}),(function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return"".concat(a,"/").concat(n)}))).subscribe((function(e){var a=Object(u.a)(e,2),n=a[0],r=a[1];n&&!r&&t.battleMapService.setSquareSelectable(!0),n||r||t.battleMapService.setSquareSelectable(!1),n&&r&&(t.battleMapService.selectSquare(null),t.battleMapService.updateTokens((function(e){e.filter((function(e){return e.id===n.id})).forEach((function(e){return e.square=r}))})))}))}}]),t}(_e);!function(e){e.red="red",e.yellow="yellow",e.blue="blue",e.green="green",e.purple="purple",e.orange="orange"}(Fe||(Fe={})),function(e){e.s="s",e.m="m",e.l="l"}(Re||(Re={}));var Ue,We=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(f.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).paneS$=new De.a(new Ce([])),a.pane$=a.paneS$.asObservable(),a.drawingColorS$=new De.a(Fe.red),a.drawingColor$=a.drawingColorS$.asObservable(),a.drawingWidthS$=new De.a(Re.m),a.drawingWidth$=a.drawingWidthS$.asObservable(),a.drawingModeS$=new De.a("draw"),a.drawingMode$=a.drawingModeS$.asObservable(),a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"currentlyDrawing",value:function(e){var t=this;if(this.active){var a=this.paneS$.value,n=$e.current(this.drawingColor,this.drawingWidth);e.subscribe({next:function(e){var r;n=(r=n).withPointAdded.apply(r,Object(K.a)(e));var c=a.withDrawingAdded(n);t.paneS$.next(c)},error:function(){t.paneS$.next(a)},complete:function(){t.paneS$.next(a.withDrawingAdded(n.withId(Pe())))}})}}},{key:"removeDrawing",value:function(e){var t=this.paneS$.value;this.paneS$.next(t.withDrawingRemoved(e))}},{key:"switchDrawingColor",value:function(e){this.drawingColorS$.next(e)}},{key:"switchDrawingWidth",value:function(e){this.drawingWidthS$.next(e)}},{key:"switchDrawingMode",value:function(e){this.drawingModeS$.next(e)}},{key:"setPane",value:function(e){this.paneS$.next(e)}},{key:"onActivate",value:function(){}},{key:"drawingColor",get:function(){return this.drawingColorS$.value}},{key:"drawingMode",get:function(){return this.drawingModeS$.value}},{key:"drawingWidth",get:function(){return this.drawingWidthS$.value}}]),t}(_e),Ye=S()(Ue=function e(t,a,n,r){Object(h.a)(this,e),this.size=t,this.color=a,this.border=n,this.name=r})||Ue,He=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(f.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).defaultStrokeColor="#555555",a.tokenTypes=[new Ye(1,"#ff28fb","#ffaaf3","Mora"),new Ye(1,"#ff8902","#ffd069","Elsa"),new Ye(1,"#78cc85",a.defaultStrokeColor,"LightGreen"),new Ye(1,"#077919",a.defaultStrokeColor,"Green"),new Ye(1,"#98c6ff",a.defaultStrokeColor,"LightBlue"),new Ye(1,"#0282ff",a.defaultStrokeColor,"Blue"),new Ye(1,"#9f6a00",a.defaultStrokeColor,"LightBrown"),new Ye(1,"#513200",a.defaultStrokeColor,"Brown"),new Ye(1,"#ff5354",a.defaultStrokeColor,"LightRed"),new Ye(1,"#c70200",a.defaultStrokeColor,"Red"),new Ye(1,"#ffff8e",a.defaultStrokeColor,"LightYellow"),new Ye(1,"#ffef00",a.defaultStrokeColor,"Yellow"),new Ye(1,"#d67eff",a.defaultStrokeColor,"LightPurple"),new Ye(1,"#9f00d3",a.defaultStrokeColor,"Purple"),new Ye(1,"#f4e4ee",a.defaultStrokeColor,"LightGrey"),new Ye(1,"#645e5d",a.defaultStrokeColor,"DarkGrey")],a.tokenLabels=[" ","1","2","3","4","5","6","7","8","9","Boss","L1","L2","L3","M1","M2","M3","P1","P2","P3"],a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"tokenTypeForName",value:function(e){return this.tokenTypes.find((function(t){return t.name===e}))||null}}]),t}(Le),Je=a(148);function Xe(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.some((function(t){return t===e}))}}var Ve=function(){function e(){Object(h.a)(this,e)}return Object(v.a)(e,null,[{key:"controlServices",value:function(e,t){var a=null,n=function(){a&&(a.next(),a.complete(),a=null)};e.subscribe({next:function(e){if(n(),e){var r=t[e];r&&(a=new ze.a,r.activate(a))}},complete:function(){console.log("mode based complete"),n()},error:function(){n()}})}}]),e}(),Qe=function(e){function t(e,a){var n;return Object(h.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this))).battleMapService=e,n.assetService=a,n.mode$S=new De.a("add-token"),n.mode$=n.mode$S.asObservable().pipe(Object(Je.a)((function(e){return console.log("manageTokenMode",e)}))),n.modeCallbacks={"switch-token-type":{activate:function(){n.battleMapService.setTokenSelectable(!1),n.battleMapService.setSquareSelectable(!1),n.battleMapService.selectSquare(null),n.battleMapService.selectToken(null)}},"add-token":{activate:function(e){n.battleMapService.setTokenSelectable(!1),n.battleMapService.setSquareSelectable(!0),n.battleMapService.selectSquare(null),n.battleMapService.selectToken(null),n.battleMapService.setTokenSize(n.tokenSizeS$.value),Object(be.a)([n.tokenType$,n.tokenLabel$,n.tokenSize$,n.battleMapService.selectedSquare$]).pipe(Object(qe.a)(e)).subscribe((function(e){var t=Object(u.a)(e,4),a=t[0],r=t[1],c=t[2],o=t[3];o&&a&&r&&c&&(n.battleMapService.selectSquare(null),n.battleMapService.addToken(a,r,c,o))})),e.subscribe({next:function(){n.battleMapService.setTokenSize(1)}})}},"remove-token":{activate:function(e){n.battleMapService.setTokenSelectable(!0),n.battleMapService.setSquareSelectable(!1),n.battleMapService.selectSquare(null),n.battleMapService.selectToken(null),Object(be.a)([n.tokenType$,n.tokenLabel$,n.battleMapService.selectedToken$]).pipe(Object(qe.a)(e)).subscribe((function(e){var t=Object(u.a)(e,3),a=t[0],r=t[1];t[2]&&a&&r&&n.battleMapService.removeSelectedToken()}))}},inactive:null},n.isSwitchTokenType$=n.mode$.pipe(Object(x.a)(Xe("switch-token-type"))),n.tokenTypeS$=new De.a(n.assetService.tokenTypes[0]),n.tokenType$=n.tokenTypeS$.asObservable(),n.tokenLabelS$=new De.a(n.assetService.tokenLabels[0]),n.tokenLabel$=n.tokenLabelS$.asObservable(),n.tokenSizeS$=new De.a(1),n.tokenSize$=n.tokenSizeS$.asObservable(),n}return Object(g.a)(t,e),Object(v.a)(t,[{key:"onActivate",value:function(e){var t=this;Ve.controlServices(this.mode$.pipe(Object(qe.a)(e)),this.modeCallbacks),e.subscribe({next:function(){t.mode$S.next("inactive")}}),this.mode$S.next("add-token")}},{key:"setTokenType",value:function(e){this.tokenTypeS$.next(e)}},{key:"setTokenLabel",value:function(e){this.tokenLabelS$.next(e)}},{key:"setTokenSize",value:function(e){this.tokenSizeS$.next(e)}},{key:"switchMode",value:function(e){this.mode$S.next(e)}},{key:"tokenType",get:function(){return this.tokenTypeS$.value}},{key:"tokenLabel",get:function(){return this.tokenLabelS$.value}},{key:"tokenSize",get:function(){return this.tokenSizeS$.value}}]),t}(_e),Ze=function(e){function t(e,a){var n;return Object(h.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this))).initalMode=e,n.modeS$=new De.a(n.initalMode),n.mode$=n.modeS$.asObservable(),Ve.controlServices(n.untilDisposed(n.mode$),a),n}return Object(g.a)(t,e),Object(v.a)(t,[{key:"switchMode",value:function(e){this.modeS$.next(e)}},{key:"mode",get:function(){return this.modeS$.value}}]),t}(Le),et=a(149),tt=a(152),at=a(150);function nt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function rt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nt(a,!0).forEach((function(t){Object(L.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nt(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ct=function(e){function t(e,a){var n;return Object(h.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this))).gridMapStorage=e,n.sessionStorage=a,n.onLoad={},n.toStore={},n.sessionS$=new De.a(null),n.session$=n.untilDisposed(n.sessionS$.asObservable()),n.gridMapS$=new De.a(null),n.gridMap$=n.untilDisposed(n.gridMapS$.asObservable()),n.session$.pipe(Object(tt.a)(1e4)).subscribe({next:function(){console.log("saving session",n.session),n.saveSession()}}),n}return Object(g.a)(t,e),Object(v.a)(t,[{key:"saveSession",value:function(){this.session&&this.sessionStorage.store(this.session)}},{key:"add",value:function(e,t){var a=new ze.a;return this.onLoad=rt({},this.onLoad,Object(L.a)({},e,a)),this.toStore=rt({},this.toStore,Object(L.a)({},e,t)),a.asObservable()}},{key:"loadAndStart",value:function(){var e=this;return this.sessionStorage.findCurrentSessionName().pipe(Object(N.a)((function(e){return e?Object(O.a)(e):Object(et.a)("No current session name found in local storage")})),Object(N.a)((function(t){return e.sessionStorage.findBy(t)})),Object(N.a)((function(e){return e?Object(O.a)(e):Object(et.a)("Failed Loading Session")})),Object(N.a)((function(t){return e.gridMapStorage.findBy(t.gridMapName).pipe(Object(x.a)((function(e){return[t,e]})))})),Object(N.a)((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return n?Object(O.a)([a,n]):Object(et.a)("Session with no gridMapName")})),Object(x.a)((function(t){var a=Object(u.a)(t,2),n=a[0],r=a[1];return Object.keys(e.onLoad).forEach((function(t){var a=n.content[t];if(a){var r=e.onLoad[t];r.next(a),r.complete()}})),Object.keys(e.toStore).forEach((function(t){var a=e.toStore[t];e.untilDisposed(a).subscribe((function(a){e.session&&e.sessionS$.next(e.session.with({date:(new Date).toLocaleString(),content:rt({},e.session.content,Object(L.a)({},t,a))}))}))})),e.sessionS$.next(n),e.gridMapS$.next(r),!0})),Object(at.a)((function(e){return console.log("Failed loading session: ".concat(e)),Object(O.a)(!1)})))}},{key:"session",get:function(){return this.sessionS$.value}}]),t}(Le),ot=function(e){var t=e.gridMap;return i.a.createElement("g",{transform:t.transformation.asTransformString()},i.a.createElement("image",{width:t.image.width,height:t.image.height,xlinkHref:t.image.url}))};function it(e,t){var a=Object(o.useState)(t),n=Object(u.a)(a,2),r=n[0],c=n[1];return Object(o.useEffect)((function(){var t;if(e&&(t="function"===typeof e?e():e)){var a=t.subscribe((function(e){c(e)}));return function(){return a.unsubscribe()}}}),[e]),r}var lt=function(e){var t=e.tokenClasses,a=e.tokenType,n=e.tokenSize,r=e.tokenLabel,c=e.square,o=e.onClick;return c=c||new xe(0,0),i.a.createElement("g",{onClick:o},i.a.createElement("circle",{className:"token ".concat(t?te(t):""),fill:a.color,stroke:a.border,r:n/2,cx:c.x+n/2,cy:c.y+n/2}),r&&i.a.createElement("text",{className:"token-text",x:c.x+n/2,y:c.y+.2+n/2},r))},st=function(e){var t=e.tokens,a=e.onClick,n=it(e.selectedToken$,null);return i.a.createElement("g",null,t.map((function(e){return i.a.createElement("g",{key:e.id},i.a.createElement(lt,{tokenType:e.tokenType,tokenLabel:e.label,tokenSize:e.size,square:e.square,onClick:function(){return a(e)}}))})),n&&i.a.createElement(lt,{tokenType:n.tokenType,tokenLabel:n.label,tokenSize:n.size,square:n.square,onClick:function(){return a(null)},tokenClasses:{"selected-token":!0}}))};function ut(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var mt,dt=function(e){var t=e.drawingService,a=Object(o.useState)(null),n=Object(u.a)(a,2),r=n[0],c=n[1],l=it(t.active$,!1),s=it(t.drawingMode$,"draw");return i.a.createElement(i.a.Fragment,null,"draw"===s&&l&&i.a.createElement("rect",{x:-500,y:-500,width:1e3,height:1e3,className:"drawing-capture-pane",onPointerDown:function(e){if(t.active){e.currentTarget.setPointerCapture(e.pointerId);var a=new ze.a;c(a),t.currentlyDrawing(a)}},onPointerUp:function(e){!function(e){r&&(r.complete(),c(null),e.currentTarget.releasePointerCapture(e.pointerId))}(e)},onPointerCancel:function(e){return console.log("canceled",function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ut(a,!0).forEach((function(t){Object(L.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ut(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))},onPointerMove:function(e){if(r){var t=F(e);r.next([t.x,t.y])}}}))},bt=function(e){var t=e.drawingService,a=e.name,n=it(t.pane$,null),r=it(t.drawingMode$,"draw");return n&&i.a.createElement(i.a.Fragment,null,i.a.createElement("g",{id:a,className:"drawing-pane ".concat(a," ").concat(r," ")},i.a.createElement("rect",{x:-500,y:-500,width:1e3,height:1e3,className:"drawing-pane-background ".concat(a)}),n.drawings.map((function(e){var a,n;return i.a.createElement("polyline",{key:e.id,className:te((a={drawing:!0,current:"current"===e.id},Object(L.a)(a,"drawing-".concat(e.color),!0),Object(L.a)(a,"drawing-".concat(e.width),!0),a)),points:e.svgPath,onClick:(n=e.id,function(){"erase"===t.drawingMode&&t.removeDrawing(n)})})}))))},ht=function(e){var t=e.battleMapService,a=Object(o.useState)(0),n=Object(u.a)(a,2),r=n[0],c=n[1],l=Object(o.useState)(null),s=Object(u.a)(l,2),m=s[0],d=s[1],b=Object(o.useState)(null),h=Object(u.a)(b,2),f=h[0],p=h[1],g=Object(o.useRef)(null),v=Object(o.useState)(!1),E=Object(u.a)(v,2),S=E[0],y=E[1],k=function(e){if(f){var a=F(e).x-f.x;c(a),t.switchScale(a)}},w=function(e){k(e)},O=function(e){var t=F(e),a=t.x,n=t.y;p({x:a-r,y:n}),e.currentTarget.setPointerCapture(e.pointerId)},j=function(e){k(e),p(null),e.currentTarget.releasePointerCapture(e.pointerId)},N=function(e){if(m&&S){var a=F(e,g.current),n=a.x-m.x,r=a.y-m.y;d(a),t.movePosition(n,r)}};return i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{ref:g,x:-500,y:-500,width:1e3,height:1e3,className:"zoom-pane",onClick:function(e){d(F(e))}}),m&&i.a.createElement("g",{className:"zoom-control",transform:"translate(".concat(m.x," ").concat(m.y,")")},U(50).map((function(e){return i.a.createElement("circle",{className:"zoom-control-bead",key:"".concat(Math.ceil(e-r-1)),cx:1+e+r%1,cy:0,r:.2,onPointerDownCapture:O,onPointerMoveCapture:w,onPointerUpCapture:j})})),i.a.createElement("circle",{className:"zoom-control-center",cx:0,cy:0,r:.5,onPointerDownCapture:function(e){e.currentTarget.setPointerCapture(e.pointerId),y(!0),N(e)},onPointerMoveCapture:function(e){N(e)},onPointerUpCapture:function(e){e.currentTarget.releasePointerCapture(e.pointerId),y(!1),N(e)}})))},ft=function(e){var t=e.children,a=e.width,n=e.height;return i.a.createElement(i.a.Fragment,null,U(a).map((function(e){return U(n).map((function(a){return t(e,a)}))})))},pt=function(e){var t=e.width,a=e.height;return i.a.createElement(ft,{width:t,height:a},(function(e,t){return i.a.createElement("rect",{key:"".concat(e,"/").concat(t),className:"background-grid",x:e,y:t,height:1,width:1})}))},gt=function(e){var t=e.onClick,a=e.width,n=e.height,r=e.highlightedSquares,c=e.onHover,o=r.reduce((function(e,t){return e[t.toCoordinateString()]=!0,e}),{});return i.a.createElement(ft,{width:a,height:n},(function(e,a){var n=new xe(e,a);return i.a.createElement("rect",{key:n.toCoordinateString(),className:te({"selection-grid":!0,highlighted:o[n.toCoordinateString()]}),x:e,y:a,height:1,width:1,onClick:function(){return t&&t(n)},onMouseOver:function(){return c(n)}})}))},vt=function(e){var t=e.battleMapService,a=e.backgroundDrawingService,n=e.notesDrawingService,r=e.modeService,c=it(t.viewBox$,new Me(0,0,0,0)),o=it(t.tokens$,[]),l=it(n.active$,!1),s=it(Object(be.a)([t.squareSelectable$,r.mode$.pipe(Object(x.a)(Xe("play","manage-token")))]).pipe(Object(x.a)((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return a&&n}))),!1),m=it(r.mode$.pipe(Object(x.a)(Xe("zoom"))),!1),d=it(t.gridMap$,null),b=it(t.scale$,t.scale),h=it(t.position$,t.position),f=it(t.highlightedSquares$,[]);return i.a.createElement(i.a.Fragment,null,d&&i.a.createElement("svg",{className:"h-100 w-100",viewBox:c.toViewBoxString()},i.a.createElement("g",{transform:"translate(".concat(h.x," ").concat(h.y,") scale(").concat(b,", ").concat(b,")")},i.a.createElement(ot,{gridMap:d}),i.a.createElement(pt,{width:d.getWidthInSquares(),height:d.getHeightInSquares()}),i.a.createElement(bt,{name:"background",drawingService:a}),s&&i.a.createElement(gt,{width:d.getWidthInSquares(),height:d.getHeightInSquares(),highlightedSquares:f,onClick:function(e){return t.selectSquare(e)},onHover:function(e){return t.hoverOverSquare(e)}}),i.a.createElement(st,{tokens:o,selectedToken$:t.selectedToken$,onClick:function(e){return t.selectToken(e)}}),l&&i.a.createElement(bt,{name:"notes",drawingService:n}),i.a.createElement(dt,{drawingService:n}),i.a.createElement(dt,{drawingService:a})),m&&i.a.createElement(ht,{battleMapService:t})))},Et=function(e){var t=e.classes,a=e.onClick,n=e.icon,r=e.text,c=e.iconSize,o=e.tooltip,l=e.iconHeight,s="";"string"===typeof t?s=t:"object"===typeof t&&(s=te(t));var u=c||16;return i.a.createElement("div",null,i.a.createElement("a",{href:"#",title:o,onClick:function(e){e.preventDefault(),a&&a()},className:"btn btn-sm mb-md-2 "+s},i.a.createElement("div",{className:"icon-button-content"},n&&i.a.createElement(G.G,{icon:n,width:u,height:l||u}),r&&i.a.createElement("span",null,r))))},St=(mt={},Object(L.a)(mt,Re.s,8),Object(L.a)(mt,Re.m,12),Object(L.a)(mt,Re.l,16),mt),yt=function(e){var t=e.drawingService,a=it(t.drawingColor$,t.drawingColor),n=it(t.drawingWidth$,t.drawingWidth),r=it(t.active$,!1),c=it(t.drawingMode$,"draw"),o=function(e,a){var n;return i.a.createElement(Et,{key:e,icon:a,onClick:function(){return t.switchDrawingMode(e)},classes:(n={},Object(L.a)(n,"btn-warning",c===e),Object(L.a)(n,"btn-outline-warning",c!==e),n)})};return i.a.createElement(i.a.Fragment,null,r&&i.a.createElement("div",{className:"mt-md-5"},o("draw",G.s),o("erase",G.D),i.a.createElement("div",{className:"mt-md-4"}),Object.values(Re).map((function(e){return function(e){var a;return i.a.createElement(Et,{key:e,icon:G.v,iconSize:St[e],onClick:function(){return t.switchDrawingWidth(e)},classes:(a={},Object(L.a)(a,"btn-secondary",n===e),Object(L.a)(a,"btn-outline-secondary",n!==e),Object(L.a)(a,"drawing-pane-button",!0),a)})}(e)})),i.a.createElement("div",{className:"mt-md-4"}),Object.values(Fe).map((function(e){return function(e){var n;return i.a.createElement(Et,{key:e,icon:G.r,onClick:function(){return t.switchDrawingColor(e)},classes:(n={},Object(L.a)(n,"drawing-button-".concat(e),a!==e),Object(L.a)(n,"drawing-button-".concat(e,"-selected"),a===e),n)})}(e)}))))},kt=Object.freeze({drawBackgroundButton:"Draw something that should be shown on the gridMap like spell effects, environment hazards etc.",drawNotesButton:"Open the notes pane where you can write some notes with a pen.",playButton:"Enter play mode, so you can move tokens.",addTokensButton:"Add a new token to the game board.",zoomButton:"Zoom in or out and change orientation of the map."}),wt=function(e){var t=e.modeService,a=it(t.mode$,"play"),n=function(e,n,r){return i.a.createElement(Et,{icon:e,onClick:function(){return t.switchMode(n)},classes:{"btn-outline-primary":n!==a,"btn-primary":n===a},tooltip:r})};return i.a.createElement("div",{className:""},n(G.k,"play",kt.playButton),n(G.q,"manage-token",kt.addTokensButton),n(G.p,"draw-notes",kt.drawNotesButton),n(G.i,"draw-background",kt.drawBackgroundButton),n(G.z,"zoom",kt.zoomButton))},Ot=function(e){var t=e.manageTokenService,a=it(t.active$,!1),n=it(t.tokenType$,null),r=it(t.tokenLabel$,null),c=it(t.mode$,"add-token"),o=function(e,a){return i.a.createElement(Et,{icon:e,onClick:function(){return t.switchMode(a)},classes:{"btn-warning":a===c,"btn-outline-warning":a!==c}})};return i.a.createElement(i.a.Fragment,null,a&&i.a.createElement("div",{className:"mt-md-5"},o(G.u,"add-token"),o(G.D,"remove-token"),i.a.createElement("div",null,i.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.switchMode("switch-token-type")},className:te({btn:!0,"btn-sm":!0,"btn-warning":"switch-token-type"===c,"btn-outline-warning":"switch-token-type"!==c})},n&&r&&i.a.createElement("svg",{viewBox:"-0.1 -0.1 1.15 1.15",width:16,height:16},i.a.createElement(lt,{tokenLabel:r,tokenType:n,tokenSize:1}))))))},jt=function(e){var t=e.modeService,a=e.notesDrawingService,n=e.backgroundDrawingService,r=e.manageTokenService;return i.a.createElement("div",{className:"navbar navbar-dark bg-dark control-pane"},i.a.createElement(wt,{modeService:t}),i.a.createElement(yt,{drawingService:a}),i.a.createElement(yt,{drawingService:n}),i.a.createElement(Ot,{manageTokenService:r}))},Nt=function(e){var t=e.items,a=e.columns,n=e.component;return i.a.createElement("div",{className:"row p-lg-5"},t.map((function(e,t){return i.a.createElement("div",{key:t,className:"col-md-".concat(12/a)},n(e))})))},xt=function(e){var t=e.tokenType,a=e.tokenLabel,n=e.tokenSize,r=e.onClick,c=e.selected,o=e.svgSize,l=e.maxTokenSize,s=new Me(-.25,-.25,l+.5,l+.5);return i.a.createElement("a",{className:te({btn:!0,"btn-outline-secondary":!c,"btn-secondary":c}),onClick:function(e){e.preventDefault(),r()}},i.a.createElement("svg",{viewBox:s.toViewBoxString(),width:o,height:o},i.a.createElement(pt,{width:l,height:l}),i.a.createElement(lt,{tokenLabel:a,tokenType:t,tokenSize:n})))},$t=a(47),Tt=a.n($t),Ct=function(e){var t=e.children,a=e.onOk,n=e.okEnabled,r=e.onCancel,c=e.buttonText,l=e.header,s=e.open,u=Object(o.useRef)(null);Object(o.useLayoutEffect)((function(){Tt()(u.current).modal("hide").on("hide.bs.modal",(function(){r&&r()}))}),[]),Object(o.useLayoutEffect)((function(){console.log("effect after open",s),Tt()(u.current).modal(s?"show":"hide")}),[s]);return i.a.createElement("div",{ref:u,className:"modal fade",id:"exampleModal",tabIndex:-1,role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},i.a.createElement("div",{className:"modal-dialog",role:"document"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title",id:"exampleModalLabel"},l),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("div",{className:"modal-body"},t),i.a.createElement("div",{className:"modal-footer"},a&&i.a.createElement("button",{onClick:function(){Tt()(u.current).modal("hide"),a&&a()},disabled:void 0!==n&&!n,type:"button",className:"btn btn-primary"},c)))))},Mt=function(e){var t=e.assetService,a=e.manageTokenService,n=it(a.isSwitchTokenType$,!1),r=it(a.tokenType$,a.tokenType),c=it(a.tokenLabel$,a.tokenLabel),o=it(a.tokenSize$,a.tokenSize);return i.a.createElement(Ct,{onCancel:function(){return a.switchMode("add-token")},buttonText:"place it",header:"Add Token",open:n},!!c&&!!r&&!!o&&i.a.createElement("div",null,i.a.createElement(Nt,{items:t.tokenTypes,columns:6,component:function(e){return i.a.createElement(xt,{tokenLabel:c,tokenType:e,tokenSize:1,onClick:function(){return a.setTokenType(e)},selected:e===r,svgSize:40,maxTokenSize:1})}}),i.a.createElement(Nt,{items:t.tokenLabels,columns:6,component:function(e){return i.a.createElement(xt,{tokenLabel:e,tokenType:r,tokenSize:1,onClick:function(){return a.setTokenLabel(e)},selected:c===e,svgSize:40,maxTokenSize:1})}}),i.a.createElement(Nt,{items:U(3),columns:3,component:function(e){var t=e+1;return i.a.createElement(xt,{tokenLabel:c,tokenType:r,tokenSize:t,onClick:function(){return a.setTokenSize(t)},selected:o===t,svgSize:90,maxTokenSize:3})}})))},Dt=function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"App h-100"},i.a.createElement(vt,e),i.a.createElement(jt,e)),i.a.createElement("div",{className:"App h-100"},i.a.createElement(Mt,e)))},Pt=function(e){return Object(m.a)(e),i.a.createElement(I,{heading:i.a.createElement("h1",null,"Welcome to Gridheim, Stranger!")},i.a.createElement("h3",null,"No Session found"),i.a.createElement("span",null,"It seems that you don't have a session (yet) or that the session is invalid :("),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("span",null,"Please go ",i.a.createElement(d.b,{to:Lt.sessions},"here")," to create a session so we can play :D"))},At=function(e){var t=e.storageProvider,a=Object(o.useState)(null),n=Object(u.a)(a,2),r=n[0],c=n[1],l=Object(o.useState)("LOADING"),s=Object(u.a)(l,2),m=s[0],d=s[1];return Object(o.useEffect)((function(){var e=new ct(new T(t),new le(t)),a=new Ge(e),n=new Ke(a),r=new We,o=new We,i=new He,l=new Qe(a,i),s=new Ze("play",{play:n,"draw-background":r,"draw-notes":o,"manage-token":l,zoom:null});return e.add("tokens",a.tokens$).subscribe((function(e){var t=e.flatMap((function(e){var t=i.tokenTypeForName(e.tokenType.name);return t?[new Ne(e.id,t,e.label,new xe(e.square.x,e.square.y),e.size)]:[]}));a.updateTokens((function(){return t}))})),e.add("background-pane",r.pane$.pipe(Object(x.a)((function(e){return e.withCurrentDrawingRemoved()})))).subscribe((function(e){r.setPane(Ce.fromJson(e))})),e.add("notes-pane",o.pane$.pipe(Object(x.a)((function(e){return e.withCurrentDrawingRemoved()})))).subscribe((function(e){o.setPane(Ce.fromJson(e))})),e.loadAndStart().toPromise().then((function(e){return d(e?"LOADED":"FAILED")})),c({battleMapService:a,playModeService:n,backgroundDrawingService:r,notesDrawingService:o,modeService:s,manageTokenService:l,assetService:i}),function(){console.log("disposing PlayApp"),e.saveSession(),a.dispose(),n.dispose(),r.dispose(),o.dispose(),s.dispose(),l.dispose(),i.dispose()}}),[]),i.a.createElement(i.a.Fragment,null,(!r||"LOADING"===m)&&i.a.createElement("div",{className:"App h-100"},i.a.createElement("span",null,"loading ...")),"FAILED"===m&&!!r&&i.a.createElement(Pt,null),"LOADED"===m&&!!r&&i.a.createElement(Dt,r))},It=a(96),zt=a(151),qt=function(){function e(){var t=this;Object(h.a)(this,e),this.db=new It.a("GridHeimBlobStorage"),this.blobs=(t.db.version(1).stores(Object(L.a)({},e.TABLE_NAME,"key,value")),t.db.table(e.TABLE_NAME))}return Object(v.a)(e,[{key:"get",value:function(e){return Object(zt.a)(this.blobs.get(e).then((function(e){return e?e.value:null})))}},{key:"listKeys",value:function(){return Object(zt.a)(this.blobs.toArray().then((function(e){return Object.freeze(e.map((function(e){return e.key})))})))}},{key:"set",value:function(e,t){return Object(zt.a)(this.blobs.put({key:e,value:t}).then((function(){})))}},{key:"remove",value:function(e){return Object(zt.a)(this.blobs.delete(e).then((function(){})))}}]),e}();qt.TABLE_NAME="blobs";var Lt={play:"/",sessions:"/sessions",manageGridMaps:"/manage-maps",manageTokenTypes:"/manage-token-types",about:"/about"};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(110),a(111);s.a.render(i.a.createElement((function(e){Object(m.a)(e);var t=Object(o.useState)((function(){return new qt})),a=Object(u.a)(t,1)[0];return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a,null,i.a.createElement("div",{className:"h-100"},i.a.createElement(oe,null),i.a.createElement(b.d,null,i.a.createElement(b.b,{path:Lt.play,exact:!0},i.a.createElement(je,null,i.a.createElement(At,{storageProvider:a}))),i.a.createElement(b.b,{path:Lt.sessions},i.a.createElement(je,null,i.a.createElement(pe,{storageProvider:a}))),i.a.createElement(b.b,{path:Lt.manageGridMaps},i.a.createElement(je,null,i.a.createElement(ee,{storageProvider:a}))),i.a.createElement(b.b,{path:Lt.manageTokenTypes},i.a.createElement(je,null,i.a.createElement(ge,null))),i.a.createElement(b.b,{path:Lt.about},i.a.createElement(ke,null))))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},98:function(e,t,a){e.exports=a(138)}},[[98,1,2]]]);
//# sourceMappingURL=main.e0edf475.chunk.js.map