(this.webpackJsonpgridheim=this.webpackJsonpgridheim||[]).push([[0],{107:function(e,t){},130:function(e,t,n){},138:function(e,t,n){"use strict";n.r(t);var a=n(93),r=n.n(a),c=n(0),o=n.n(c),i=n(94),l=n.n(i),s=(n(130),n(2)),u=n(9),m=n(21),d=n(24),h=function(e){var t=e.className,n=e.children;return o.a.createElement("div",{className:"list-group ".concat(t||"")},n)},b=function(e){var t=e.children,n=e.className,a=e.active,r=e.onClick;return o.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),r&&r()},className:"list-group-item list-group-item-action ".concat(n," ").concat(a?"active":"")},t)},f=function(e){var t=e.children;return o.a.createElement("div",{className:"media"},t)},p=function(e){var t=e.children;return o.a.createElement("div",{className:"media-body"},t)},g=function(e){var t=e.gridMaps,n=e.selected,a=e.onSelect;return o.a.createElement(h,null,Object.values(t).map((function(e){return o.a.createElement(b,{active:e===n,key:e.name,onClick:function(){return a(e)}},o.a.createElement(f,null,o.a.createElement(p,null,o.a.createElement("h4",null,e.name),o.a.createElement("dl",{className:"row"},o.a.createElement("dt",{className:"col-sm-3"},"Size in Squares"),o.a.createElement("dd",{className:"col-sm-9"},e.getWidthInSquares(),"x",e.getHeightInSquares()),o.a.createElement("dt",{className:"col-sm-3"},"Scale"),o.a.createElement("dd",{className:"col-sm-9"},e.transformation.scale),o.a.createElement("dt",{className:"col-sm-3"},"X Offset"),o.a.createElement("dd",{className:"col-sm-9"},e.transformation.dx),o.a.createElement("dt",{className:"col-sm-3"},"Y Offset"),o.a.createElement("dd",{className:"col-sm-9"},e.transformation.dy))),o.a.createElement("img",{className:"ml-3 img-thumbnail image-300",src:e.image.url})))})))},v=o.a.createContext((function(){})),E=function(e){var t=e.heading,n=e.children,a=Object(c.useRef)(null);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"container fixed-top text-center full-page-with-heading_heading-container bg-white"},t),o.a.createElement("div",{ref:a,className:"container h-100 scrollable-y full-page-with-heading_content-container"},o.a.createElement(v.Provider,{value:function(){a.current&&a.current.scrollTo(0,0)}},n)))},S=n(1),y=function(e){var t=e.children;return o.a.createElement("div",{className:"alert alert-primary"},t)},w=function(e){var t=e.icon,n=e.headline,a=e.children;return o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,o.a.createElement(S.F,{icon:t,size:40}),o.a.createElement("span",{className:"ml-4"},n)),a)},k=function(e){var t=e.icon,n=e.headline,a=e.children;return o.a.createElement(w,{icon:t,headline:n},o.a.createElement("div",{className:"ml-5 mt-3 mb-3 text-left"},o.a.Children.map(a,(function(e,t){return o.a.createElement(o.a.Fragment,null,0!==t&&o.a.createElement("span",{className:"ml-2"}),e)}))))},O=function(e){var t=e.gridMapStorage,n=Object(c.useState)(null),a=Object(s.a)(n,2),r=a[0],i=a[1],l=Object(c.useState)([]),u=Object(s.a)(l,2),m=u[0],d=u[1],h=Object(c.useCallback)((function(){t.findAll().subscribe({next:d})}),[t]);Object(c.useEffect)((function(){h()}),[h]);var b=o.a.createElement(k,{icon:S.i,headline:"Manage Maps"},r&&o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{type:"button",className:"btn btn-danger ml-2",onClick:function(){t.delete(r.name),i(null),h()}},o.a.createElement(S.F,{icon:S.C}),"Delete Selected Map")));return o.a.createElement(o.a.Fragment,null,o.a.createElement(E,{heading:b},o.a.createElement(y,null,o.a.createElement("strong",null,"Maps")," are stored images with a grid drawn over them.",o.a.createElement("br",null),"You create a map by selecting an image file on your computer and configure a grid for them. The images are stored locally in your browser local storage and are not sent to the internet."),o.a.createElement("div",null,o.a.createElement("div",{className:"col-md-12"},o.a.createElement(g,{gridMaps:m,selected:r,onSelect:i})))))},j="https://legal.comsysto.com/comsysto.github.io/de/impressum/",x="https://legal.comsysto.com/comsysto.github.io/en/datenschutz/",N=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"navbar navbar-dark bg-dark logo-menu"},o.a.createElement(m.b,{className:"btn mb-md-2 btn-outline-primary logo-button",to:cn.start},o.a.createElement("div",null,o.a.createElement("div",{className:"position-absolute"},o.a.createElement(S.F,{icon:S.l,width:30,height:50}))))),o.a.createElement("div",{className:"main-menu_legal-stuff"},o.a.createElement("small",null,o.a.createElement("a",{href:j,className:"ml-2 mr-2"},o.a.createElement(S.F,{icon:S.o})," Impressum")),o.a.createElement("small",null,o.a.createElement("a",{href:x},o.a.createElement(S.F,{icon:S.n})," Data Protection"))))},T=function(e){var t=e.sessions,n=e.gridMapsForName,a=e.children;return o.a.createElement(h,null,t.map((function(e){var t=n[e.gridMapName];return o.a.createElement(b,{key:e.name},o.a.createElement(f,null,o.a.createElement(p,null,o.a.createElement("h4",null,e.name),o.a.createElement("dl",{className:"row"},t&&o.a.createElement(o.a.Fragment,null,o.a.createElement("dt",{className:"col-sm-3"},"Map"),o.a.createElement("dd",{className:"col-sm-9"},t.name," (",t.getWidthInSquares(),"x",t.getHeightInSquares(),")")),o.a.createElement("dt",{className:"col-sm-3"},"Date"),o.a.createElement("dd",{className:"col-sm-9"},e.date)),!t&&o.a.createElement("span",{className:"badge badge-pill badge-danger"},"Invalid: Background is missing"),o.a.createElement("div",null,a&&a(e))),t&&o.a.createElement("img",{src:t.image.url,className:"img-thumbnail image-200"})))})))},M=n(140);function $(e,t){return e.reduce((function(e,n){return e[t(n)]=n,e}),{})}var C,P=function(){return Object(c.useContext)(d.e)},D=function(){for(var e=P(),t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.map((function(t){return function(){e.history.push(t)}}))},F=function(e){var t=e.gridMapStorage,n=e.sessionStorage,a=Object(c.useState)([]),r=Object(s.a)(a,2),i=r[0],l=r[1],u=Object(c.useState)({}),m=Object(s.a)(u,2),d=m[0],h=m[1],b=Object(c.useCallback)((function(){Object(M.a)([n.findAll(),t.findAll(),n.findCurrentSessionName()]).subscribe({next:function(e){var t=Object(s.a)(e,3),n=t[0],a=t[1];t[2];l(n),h($(a,(function(e){return e.name})))}})}),[n,t]);Object(c.useEffect)((function(){b()}),[b]);var f=D(cn.play),p=Object(s.a)(f,1)[0],g=o.a.createElement(w,{icon:S.y,headline:"Sessions"});return o.a.createElement(E,{heading:g},o.a.createElement(y,null,o.a.createElement("strong",null,"Sessions")," are the place where all token positions on the map and all drawings are stored.",o.a.createElement("br",null),"You can switch between sessions on this screen so you can come back to a game later ..."),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(T,{sessions:i,gridMapsForName:d},(function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{type:"button",className:"btn btn-primary mr-2",onClick:function(){n.storeCurrentSessionName(e.name),p()}},o.a.createElement(S.F,{icon:S.v}),"Start Session"),o.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:function(){n.delete(e.name),b()}},o.a.createElement(S.F,{icon:S.C}),"Delete Session"))})))))},A=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,"Manage Token Types"))},z=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,o.a.createElement("strong",null,"Gridheim")," is a digital grid map. Grid maps are used for pen&pencil roll playing games (like D&D, pathfinder, etc.) to show the position of characters and monsters on a map of the environment."),o.a.createElement("h5",{className:"mt-5"},o.a.createElement(S.F,{icon:S.q,size:25}),o.a.createElement("span",{className:"ml-3"},"The goals of ",o.a.createElement("strong",null,"Gridheim")," are ..."," ")),o.a.createElement("ul",null,o.a.createElement("li",null,"A good user experience"),o.a.createElement("li",null,"Cross platform and cross device compatibility"),o.a.createElement("li",null,"Pen support"),o.a.createElement("li",null,"Offline support via service worker"),o.a.createElement("li",null,"Data privacy - All data is only stored locally in your browser")))},I=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement(f,null,o.a.createElement(p,null,o.a.createElement("h5",{className:"mt-5"},o.a.createElement(S.F,{icon:S.j,size:25}),o.a.createElement("span",{className:"ml-3"},"Hello my name is ",o.a.createElement("strong",null,"Otto")," ...")),o.a.createElement("p",null,"... and I'm a Software Engineer at",o.a.createElement("a",{href:"https://comsystoreply.de/"}," Comsysto Reply "),"nice to meet you!",o.a.createElement("br",null),o.a.createElement("small",null,o.a.createElement("a",{href:"https://comsystoreply.de/karriere"},"(PS: we're hiring)"))),o.a.createElement("p",null,"Let me explain to you why I created yet another map tool :D ...",o.a.createElement("br",null),"It all begun when I searched for a way to visualise battles in my D&D campaign.",o.a.createElement("br",null),"The first approach was to use a physical map, which was nearly impossible for the huge maps that are often used in campaign books. The printout would be more than 2 meters in length.",o.a.createElement("br",null),"The next thing we tried was to use a tablet with a pen. This works quite smoothly because it has a similar usability than the pencil drawn maps of my youth, but it was quite challenging to move the tokens around. Every token has to be erased and drawn again in a other location. So we tried finding a dedicated software that would run on tablets, sadly we don't found one that has worked with the pen which was a blast to use :D ..."),o.a.createElement("p",null,"In the mean time I was building some dashboard prototypes at work that uses SVG graphics together with React which has quite similar characteristics ...",o.a.createElement("br",null),"... so I decided to give it a try, how hard can it be XD")),o.a.createElement("img",{className:"img-thumbnail mr-3",src:"https://www.gravatar.com/avatar/6f1aded52d041be71a1f5168c6b7e7dd?s=250"})))},q=Object.freeze({playPage:{controlBar:{drawBackgroundButton:"Draw something that should be shown on the gridMap like spell effects, environment hazards etc.",drawNotesButton:"Open the notes pane where you can write some notes with a pen.",playButton:"Enter play mode, so you can move tokens.",addTokensButton:"Add a new token to the game board.",zoomButton:"Zoom in or out and change orientation of the map."}},newSessionPage:{headline:"Start New Session",explanation:o.a.createElement(o.a.Fragment,null,o.a.createElement("strong",null,"Sessions")," are the place where all token positions on the map and all drawings are stored.",o.a.createElement("br",null),"You can switch between sessions on this screen so you can come back to a game later ...")},aboutPage:{headline:"Let me tell you tale about Gridheim, Friend ...",startLink:"Enough talk just start ..."},startPage:{headline:"Welcome to Gridheim, Friend!",about:{description:"TBD",button:"About"},openSource:{description:"TBD",button:"Open Source"},newGridMap:{description:"TBD",button:"Add Map"},newSession:{description:"TBD",button:"Start New Session"},play:{description:"TBD",button:"Start Session"},showGridMaps:{description:"TBD",button:"Show Maps"},showSessions:{description:"TBD",button:"Show Sessions"}}}),L=function(e){return Object(u.a)(e),o.a.createElement(E,{heading:o.a.createElement(w,{icon:S.m,headline:q.aboutPage.headline},o.a.createElement(m.b,{to:cn.start},o.a.createElement(S.F,{icon:S.v})," ",q.aboutPage.startLink))},o.a.createElement(z,null),o.a.createElement(I,null))},R=n(3),B=n(4),_=function(){function e(t,n){Object(R.a)(this,e),this.name=t,this.defaultValue=n}return Object(B.a)(e,[{key:"get",value:function(){var e=this.key;switch(localStorage.getItem(e)){case"true":return!0;case"false":return!1;default:return this.defaultValue}}},{key:"set",value:function(e){localStorage.setItem(this.key,"".concat(e))}},{key:"key",get:function(){return"toggle-".concat(this.name)}}]),e}(),G=Object.freeze({redirectToAbout:new _("redirect-to-about",!0)}),K=function(e){var t=e.children,n=G.redirectToAbout.get();return n&&G.redirectToAbout.set(!1),o.a.createElement(o.a.Fragment,null,n&&o.a.createElement(d.a,{to:cn.about}),!n&&t)},U=n(57);function Y(){return function(e){e[U.b]=!0}}var W,H=Y()(C=function e(t,n,a,r){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.size;Object(R.a)(this,e),this.id=t,this.tokenType=n,this.label=a,this.square=r,this.size=c})||C,X=Y()(W=function(){function e(t,n){Object(R.a)(this,e),this.x=t,this.y=n}return Object(B.a)(e,[{key:"toCoordinateString",value:function(){return"".concat(this.x,"/").concat(this.y)}}]),e}())||W,J=n(28),V=function(){function e(t,n,a,r){Object(R.a)(this,e),this.id=t,this.path=n,this.color=a,this.width=r,this.current=this.id===e.CURRENT_ID}return Object(B.a)(e,null,[{key:"current",value:function(t,n){return new e(e.CURRENT_ID,[],t,n)}}]),Object(B.a)(e,[{key:"withPointAdded",value:function(t,n){return new e(this.id,[].concat(Object(J.a)(this.path),[[t,n]]),this.color,this.width)}},{key:"withId",value:function(t){return new e(t,this.path,this.color,this.width)}},{key:"svgPath",get:function(){return this.path.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" ")}}]),e}();V.CURRENT_ID="current";var Q,Z=function(){function e(t){Object(R.a)(this,e),this.drawings=t}return Object(B.a)(e,null,[{key:"fromJson",value:function(t){return new e(t.drawings.map((function(e){return new V(e.id,e.path,e.color,e.width)})))}}]),Object(B.a)(e,[{key:"withDrawingAdded",value:function(t){return new e([].concat(Object(J.a)(this.drawings),[t]))}},{key:"withCurrentDrawingRemoved",value:function(){return this.withDrawingRemoved(V.CURRENT_ID)}},{key:"withDrawingRemoved",value:function(t){return new e(this.drawings.filter((function(e){return e.id!==t})))}}]),e}(),ee=n(58),te=n(11),ne=n(10),ae=n(12),re=Y()(Q=function(){function e(t,n,a,r){Object(R.a)(this,e),this.x=t,this.y=n,this.width=a,this.height=r}return Object(B.a)(e,[{key:"toViewBoxString",value:function(){return"".concat(this.x," ").concat(this.y," ").concat(this.width," ").concat(this.height)}}]),e}())||Q,ce=n(142);function oe(){var e=(new Date).getTime();return"undefined"!==typeof performance&&"function"===typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}var ie=n(143),le=n(154),se=n(98),ue=n(141),me=function(){function e(){Object(R.a)(this,e),this.disposeS$=new se.a,this.dispose$=this.disposeS$.asObservable()}return Object(B.a)(e,[{key:"dispose",value:function(){this.disposeS$.next(),this.disposeS$.complete()}},{key:"untilDisposed",value:function(e){return e.pipe(Object(ue.a)(this.dispose$))}}]),e}(),de=function(e){return Object(J.a)(Array(e).keys())},he=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(te.a)(this,Object(ne.a)(t).call(this))).sessionStorageService=e,n.tokensS$=new ce.a([]),n.tokens$=n.tokensS$.asObservable(),n.gridMap$=n.sessionStorageService.gridMap$,n.selectedTokenS$=new ce.a(null),n.selectedToken$=n.selectedTokenS$.asObservable(),n.selectedSquareS$=new ce.a(null),n.selectedSquare$=n.selectedSquareS$.asObservable(),n.squareSelectableS$=new ce.a(!1),n.squareSelectable$=n.squareSelectableS$.asObservable(),n.tokenSelectableS$=new ce.a(!1),n.tokenSelectable$=n.tokenSelectableS$.asObservable(),n.tokenSizeS$=new ce.a(1),n.tokenSize$=n.tokenSizeS$.asObservable(),n.hoveringSquareS$=new ce.a(null),n.hoveringSquare$=n.hoveringSquareS$.asObservable(),n.highlightedSquares$=Object(M.a)([n.squareSelectable$,n.tokenSize$,n.selectedToken$,n.hoveringSquare$]).pipe(Object(ee.a)((function(e){var n=Object(s.a)(e,4),a=n[0],r=n[1],c=n[2],o=n[3];if(!o||!a)return t.EMPTY_READONLY_ARRAY;var i=c?c.size:r,l=de(i).map((function(e){return de(i).map((function(t){return new X(o.x+e,o.y+t)}))}));return Object.freeze(l.flat())})),Object(ie.a)(50)),n.viewBox$=n.gridMap$.pipe(Object(ee.a)((function(e){return e?new re(0,0,e.getWidthInSquares(),e.getHeightInSquares()):new re(0,0,0,0)}))),n.scaleS$=new ce.a(1),n.scale$=n.scaleS$.asObservable().pipe(Object(le.a)(200)),n.positionS$=new ce.a({x:0,y:0}),n.position$=n.positionS$.asObservable().pipe(Object(le.a)(200)),n}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"selectToken",value:function(e){this.tokenSelectable&&this.selectedTokenS$.next(e)}},{key:"selectSquare",value:function(e){this.selectedSquareS$.next(e)}},{key:"updateTokens",value:function(e){var t=Object(U.a)(this.tokensS$.value,e);this.tokensS$.next(t);var n=this.selectedTokenS$.value;if(n){var a=this.tokensS$.value.find((function(e){return n.id===e.id}));this.selectedTokenS$.next(a||null)}}},{key:"addToken",value:function(e,t,n,a){this.updateTokens((function(r){r.push(new H(oe(),e,t,a,n))}));var r=this.tokensS$.value;this.selectToken(r[r.length-1])}},{key:"setSquareSelectable",value:function(e){this.squareSelectableS$.next(e)}},{key:"setTokenSelectable",value:function(e){this.tokenSelectableS$.next(e)}},{key:"switchScale",value:function(e){this.scaleS$.next(1+.1*e)}},{key:"movePosition",value:function(e,t){var n=this.position,a=n.x,r=n.y;this.positionS$.next({x:a+e,y:r+t})}},{key:"removeSelectedToken",value:function(){if(null!==this.selectedToken){var e=this.selectedToken.id;this.updateTokens((function(t){return t.filter((function(t){return t.id!==e}))}))}}},{key:"hoverOverSquare",value:function(e){this.hoveringSquareS$.next(e)}},{key:"setTokenSize",value:function(e){this.tokenSizeS$.next(e)}},{key:"selectedToken",get:function(){return this.selectedTokenS$.value}},{key:"squareSelectable",get:function(){return this.squareSelectableS$.value}},{key:"tokenSelectable",get:function(){return this.tokenSelectableS$.value}},{key:"scale",get:function(){return this.scaleS$.value}},{key:"position",get:function(){return this.positionS$.value}},{key:"tokenSize",get:function(){return this.tokenSizeS$.value}}]),t}(me);he.EMPTY_READONLY_ARRAY=Object.freeze([]);var be,fe,pe=n(144),ge=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(te.a)(this,(e=Object(ne.a)(t)).call.apply(e,[this].concat(r)))).activeS$=new ce.a(!1),n.active$=n.activeS$.asObservable(),n}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"activate",value:function(e){var t=this;this.onActivate(e),e.subscribe({next:function(){return t.activeS$.next(!1)}}),this.activeS$.next(!0)}},{key:"active",get:function(){return this.activeS$.value}}]),t}(me),ve=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(te.a)(this,Object(ne.a)(t).call(this))).battleMapService=e,n}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"onActivate",value:function(e){var t=this;this.battleMapService.setTokenSelectable(!0),this.battleMapService.setSquareSelectable(!0),this.battleMapService.selectSquare(null),this.battleMapService.selectToken(null),Object(M.a)([this.battleMapService.selectedToken$,this.battleMapService.selectedSquare$]).pipe(Object(ue.a)(e),Object(pe.a)((function(e,t){return e===t}),(function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return"".concat(n,"/").concat(a)}))).subscribe((function(e){var n=Object(s.a)(e,2),a=n[0],r=n[1];a&&!r&&t.battleMapService.setSquareSelectable(!0),a||r||t.battleMapService.setSquareSelectable(!1),a&&r&&(t.battleMapService.selectSquare(null),t.battleMapService.updateTokens((function(e){e.filter((function(e){return e.id===a.id})).forEach((function(e){return e.square=r}))})))}))}}]),t}(ge);!function(e){e.red="red",e.yellow="yellow",e.blue="blue",e.green="green",e.purple="purple",e.orange="orange"}(be||(be={})),function(e){e.s="s",e.m="m",e.l="l"}(fe||(fe={}));var Ee,Se=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(te.a)(this,(e=Object(ne.a)(t)).call.apply(e,[this].concat(r)))).paneS$=new ce.a(new Z([])),n.pane$=n.paneS$.asObservable(),n.drawingColorS$=new ce.a(be.red),n.drawingColor$=n.drawingColorS$.asObservable(),n.drawingWidthS$=new ce.a(fe.m),n.drawingWidth$=n.drawingWidthS$.asObservable(),n.drawingModeS$=new ce.a("draw"),n.drawingMode$=n.drawingModeS$.asObservable(),n}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"currentlyDrawing",value:function(e){var t=this;if(this.active){var n=this.paneS$.value,a=V.current(this.drawingColor,this.drawingWidth);e.subscribe({next:function(e){var r;a=(r=a).withPointAdded.apply(r,Object(J.a)(e));var c=n.withDrawingAdded(a);t.paneS$.next(c)},error:function(){t.paneS$.next(n)},complete:function(){t.paneS$.next(n.withDrawingAdded(a.withId(oe())))}})}}},{key:"removeDrawing",value:function(e){var t=this.paneS$.value;this.paneS$.next(t.withDrawingRemoved(e))}},{key:"switchDrawingColor",value:function(e){this.drawingColorS$.next(e)}},{key:"switchDrawingWidth",value:function(e){this.drawingWidthS$.next(e)}},{key:"switchDrawingMode",value:function(e){this.drawingModeS$.next(e)}},{key:"setPane",value:function(e){this.paneS$.next(e)}},{key:"onActivate",value:function(){}},{key:"drawingColor",get:function(){return this.drawingColorS$.value}},{key:"drawingMode",get:function(){return this.drawingModeS$.value}},{key:"drawingWidth",get:function(){return this.drawingWidthS$.value}}]),t}(ge),ye=Y()(Ee=function e(t,n,a,r){Object(R.a)(this,e),this.size=t,this.color=n,this.border=a,this.name=r})||Ee,we=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(te.a)(this,(e=Object(ne.a)(t)).call.apply(e,[this].concat(r)))).defaultStrokeColor="#555555",n.tokenTypes=[new ye(1,"#ff28fb","#ffaaf3","Mora"),new ye(1,"#ff8902","#ffd069","Elsa"),new ye(1,"#78cc85",n.defaultStrokeColor,"LightGreen"),new ye(1,"#077919",n.defaultStrokeColor,"Green"),new ye(1,"#98c6ff",n.defaultStrokeColor,"LightBlue"),new ye(1,"#0282ff",n.defaultStrokeColor,"Blue"),new ye(1,"#9f6a00",n.defaultStrokeColor,"LightBrown"),new ye(1,"#513200",n.defaultStrokeColor,"Brown"),new ye(1,"#ff5354",n.defaultStrokeColor,"LightRed"),new ye(1,"#c70200",n.defaultStrokeColor,"Red"),new ye(1,"#ffff8e",n.defaultStrokeColor,"LightYellow"),new ye(1,"#ffef00",n.defaultStrokeColor,"Yellow"),new ye(1,"#d67eff",n.defaultStrokeColor,"LightPurple"),new ye(1,"#9f00d3",n.defaultStrokeColor,"Purple"),new ye(1,"#f4e4ee",n.defaultStrokeColor,"LightGrey"),new ye(1,"#645e5d",n.defaultStrokeColor,"DarkGrey")],n.tokenLabels=[" ","1","2","3","4","5","6","7","8","9","Boss","L1","L2","L3","M1","M2","M3","P1","P2","P3"],n}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"tokenTypeForName",value:function(e){return this.tokenTypes.find((function(t){return t.name===e}))||null}}]),t}(me),ke=n(145);function Oe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.some((function(t){return t===e}))}}var je=function(){function e(){Object(R.a)(this,e)}return Object(B.a)(e,null,[{key:"controlServices",value:function(e,t){var n=null,a=function(){n&&(n.next(),n.complete(),n=null)};e.subscribe({next:function(e){if(a(),e){var r=t[e];r&&(n=new se.a,r.activate(n))}},complete:function(){console.log("mode based complete"),a()},error:function(){a()}})}}]),e}(),xe=function(e){function t(e,n){var a;return Object(R.a)(this,t),(a=Object(te.a)(this,Object(ne.a)(t).call(this))).battleMapService=e,a.assetService=n,a.mode$S=new ce.a("add-token"),a.mode$=a.mode$S.asObservable().pipe(Object(ke.a)((function(e){return console.log("manageTokenMode",e)}))),a.modeCallbacks={"switch-token-type":{activate:function(){a.battleMapService.setTokenSelectable(!1),a.battleMapService.setSquareSelectable(!1),a.battleMapService.selectSquare(null),a.battleMapService.selectToken(null)}},"add-token":{activate:function(e){a.battleMapService.setTokenSelectable(!1),a.battleMapService.setSquareSelectable(!0),a.battleMapService.selectSquare(null),a.battleMapService.selectToken(null),a.battleMapService.setTokenSize(a.tokenSizeS$.value),Object(M.a)([a.tokenType$,a.tokenLabel$,a.tokenSize$,a.battleMapService.selectedSquare$]).pipe(Object(ue.a)(e)).subscribe((function(e){var t=Object(s.a)(e,4),n=t[0],r=t[1],c=t[2],o=t[3];o&&n&&r&&c&&(a.battleMapService.selectSquare(null),a.battleMapService.addToken(n,r,c,o))})),e.subscribe({next:function(){a.battleMapService.setTokenSize(1)}})}},"remove-token":{activate:function(e){a.battleMapService.setTokenSelectable(!0),a.battleMapService.setSquareSelectable(!1),a.battleMapService.selectSquare(null),a.battleMapService.selectToken(null),Object(M.a)([a.tokenType$,a.tokenLabel$,a.battleMapService.selectedToken$]).pipe(Object(ue.a)(e)).subscribe((function(e){var t=Object(s.a)(e,3),n=t[0],r=t[1];t[2]&&n&&r&&a.battleMapService.removeSelectedToken()}))}},inactive:null},a.isSwitchTokenType$=a.mode$.pipe(Object(ee.a)(Oe("switch-token-type"))),a.tokenTypeS$=new ce.a(a.assetService.tokenTypes[0]),a.tokenType$=a.tokenTypeS$.asObservable(),a.tokenLabelS$=new ce.a(a.assetService.tokenLabels[0]),a.tokenLabel$=a.tokenLabelS$.asObservable(),a.tokenSizeS$=new ce.a(1),a.tokenSize$=a.tokenSizeS$.asObservable(),a}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"onActivate",value:function(e){var t=this;je.controlServices(this.mode$.pipe(Object(ue.a)(e)),this.modeCallbacks),e.subscribe({next:function(){t.mode$S.next("inactive")}}),this.mode$S.next("add-token")}},{key:"setTokenType",value:function(e){this.tokenTypeS$.next(e)}},{key:"setTokenLabel",value:function(e){this.tokenLabelS$.next(e)}},{key:"setTokenSize",value:function(e){this.tokenSizeS$.next(e)}},{key:"switchMode",value:function(e){this.mode$S.next(e)}},{key:"tokenType",get:function(){return this.tokenTypeS$.value}},{key:"tokenLabel",get:function(){return this.tokenLabelS$.value}},{key:"tokenSize",get:function(){return this.tokenSizeS$.value}}]),t}(ge),Ne=function(e){function t(e,n){var a;return Object(R.a)(this,t),(a=Object(te.a)(this,Object(ne.a)(t).call(this))).initalMode=e,a.modeS$=new ce.a(a.initalMode),a.mode$=a.modeS$.asObservable(),je.controlServices(a.untilDisposed(a.mode$),n),a}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"switchMode",value:function(e){this.modeS$.next(e)}},{key:"mode",get:function(){return this.modeS$.value}}]),t}(me),Te=n(7),Me=n(147),$e=n(148),Ce=n(152),Pe=n(146),De=n(149);function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(n,!0).forEach((function(t){Object(Te.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ze=function(e){function t(e,n){var a;return Object(R.a)(this,t),(a=Object(te.a)(this,Object(ne.a)(t).call(this))).gridMapStorage=e,a.sessionStorage=n,a.onLoad={},a.toStore={},a.sessionS$=new ce.a(null),a.session$=a.untilDisposed(a.sessionS$.asObservable()),a.gridMapS$=new ce.a(null),a.gridMap$=a.untilDisposed(a.gridMapS$.asObservable()),a.session$.pipe(Object(Ce.a)(1e4)).subscribe({next:function(){console.log("saving session",a.session),a.saveSession()}}),a}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"saveSession",value:function(){this.session&&this.sessionStorage.store(this.session)}},{key:"add",value:function(e,t){var n=new se.a;return this.onLoad=Ae({},this.onLoad,Object(Te.a)({},e,n)),this.toStore=Ae({},this.toStore,Object(Te.a)({},e,t)),n.asObservable()}},{key:"loadAndStart",value:function(){var e=this;return this.sessionStorage.findCurrentSessionName().pipe(Object(Pe.a)((function(e){return e?Object(Me.a)(e):Object($e.a)("No current session name found in local storage")})),Object(Pe.a)((function(t){return e.sessionStorage.findBy(t)})),Object(Pe.a)((function(e){return e?Object(Me.a)(e):Object($e.a)("Failed Loading Session")})),Object(Pe.a)((function(t){return e.gridMapStorage.findBy(t.gridMapName).pipe(Object(ee.a)((function(e){return[t,e]})))})),Object(Pe.a)((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return a?Object(Me.a)([n,a]):Object($e.a)("Session with no gridMapName")})),Object(ee.a)((function(t){var n=Object(s.a)(t,2),a=n[0],r=n[1];return Object.keys(e.onLoad).forEach((function(t){var n=a.content[t];if(n){var r=e.onLoad[t];r.next(n),r.complete()}})),Object.keys(e.toStore).forEach((function(t){var n=e.toStore[t];e.untilDisposed(n).subscribe((function(n){e.session&&e.sessionS$.next(e.session.with({date:(new Date).toLocaleString(),content:Ae({},e.session.content,Object(Te.a)({},t,n))}))}))})),e.sessionS$.next(a),e.gridMapS$.next(r),!0})),Object(De.a)((function(e){return console.log("Failed loading session: ".concat(e)),Object(Me.a)(!1)})))}},{key:"session",get:function(){return this.sessionS$.value}}]),t}(me),Ie=function(e){var t=e.gridMap;return o.a.createElement("g",{transform:t.transformation.asTransformString()},o.a.createElement("image",{width:t.image.width,height:t.image.height,xlinkHref:t.image.url}))};function qe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[e],a=Object(c.useState)(t),r=Object(s.a)(a,2),o=r[0],i=r[1];return Object(c.useEffect)((function(){var t;if(e&&(t="function"===typeof e?e():e)){var n=t.subscribe((function(e){i(e)}));return function(){return n.unsubscribe()}}}),n),o}var Le=function(e){return Object.keys(e).filter((function(t){return e[t]})).join(" ")},Re=function(e){var t=e.tokenClasses,n=e.tokenType,a=e.tokenSize,r=e.tokenLabel,c=e.square,i=e.onClick;return c=c||new X(0,0),o.a.createElement("g",{onClick:i},o.a.createElement("circle",{className:"token ".concat(t?Le(t):""),fill:n.color,stroke:n.border,r:a/2,cx:c.x+a/2,cy:c.y+a/2}),r&&o.a.createElement("text",{className:"token-text",x:c.x+a/2,y:c.y+.2+a/2},r))},Be=function(e){var t=e.tokens,n=e.onClick,a=qe(e.selectedToken$,null);return o.a.createElement("g",null,t.map((function(e){return o.a.createElement("g",{key:e.id},o.a.createElement(Re,{tokenType:e.tokenType,tokenLabel:e.label,tokenSize:e.size,square:e.square,onClick:function(){return n(e)}}))})),a&&o.a.createElement(Re,{tokenType:a.tokenType,tokenLabel:a.label,tokenSize:a.size,square:a.square,onClick:function(){return n(null)},tokenClasses:{"selected-token":!0}}))};function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.currentTarget,n=t.ownerSVGElement.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n.matrixTransform(t.getScreenCTM().inverse())}function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ke,Ue=function(e){var t=e.drawingService,n=Object(c.useState)(null),a=Object(s.a)(n,2),r=a[0],i=a[1],l=qe(t.active$,!1),u=qe(t.drawingMode$,"draw");return o.a.createElement(o.a.Fragment,null,"draw"===u&&l&&o.a.createElement("rect",{x:-500,y:-500,width:1e3,height:1e3,className:"drawing-capture-pane",onPointerDown:function(e){if(t.active){e.currentTarget.setPointerCapture(e.pointerId);var n=new se.a;i(n),t.currentlyDrawing(n)}},onPointerUp:function(e){!function(e){r&&(r.complete(),i(null),e.currentTarget.releasePointerCapture(e.pointerId))}(e)},onPointerCancel:function(e){return console.log("canceled",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(n,!0).forEach((function(t){Object(Te.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))},onPointerMove:function(e){if(r){var t=_e(e);r.next([t.x,t.y])}}}))},Ye=function(e){var t=e.drawingService,n=e.name,a=qe(t.pane$,null),r=qe(t.drawingMode$,"draw");return a&&o.a.createElement(o.a.Fragment,null,o.a.createElement("g",{id:n,className:"drawing-pane ".concat(n," ").concat(r," ")},o.a.createElement("rect",{x:-500,y:-500,width:1e3,height:1e3,className:"drawing-pane-background ".concat(n)}),a.drawings.map((function(e){var n,a;return o.a.createElement("polyline",{key:e.id,className:Le((n={drawing:!0,current:"current"===e.id},Object(Te.a)(n,"drawing-".concat(e.color),!0),Object(Te.a)(n,"drawing-".concat(e.width),!0),n)),points:e.svgPath,onClick:(a=e.id,function(){"erase"===t.drawingMode&&t.removeDrawing(a)})})}))))},We=function(e){var t=e.battleMapService,n=Object(c.useState)(0),a=Object(s.a)(n,2),r=a[0],i=a[1],l=Object(c.useState)(null),u=Object(s.a)(l,2),m=u[0],d=u[1],h=Object(c.useState)(null),b=Object(s.a)(h,2),f=b[0],p=b[1],g=Object(c.useRef)(null),v=Object(c.useState)(!1),E=Object(s.a)(v,2),S=E[0],y=E[1],w=function(e){if(f){var n=_e(e).x-f.x;i(n),t.switchScale(n)}},k=function(e){w(e)},O=function(e){var t=_e(e),n=t.x,a=t.y;p({x:n-r,y:a}),e.currentTarget.setPointerCapture(e.pointerId)},j=function(e){w(e),p(null),e.currentTarget.releasePointerCapture(e.pointerId)},x=function(e){if(m&&S){var n=_e(e,g.current),a=n.x-m.x,r=n.y-m.y;d(n),t.movePosition(a,r)}};return o.a.createElement(o.a.Fragment,null,o.a.createElement("rect",{ref:g,x:-500,y:-500,width:1e3,height:1e3,className:"zoom-pane",onClick:function(e){d(_e(e))}}),m&&o.a.createElement("g",{className:"zoom-control",transform:"translate(".concat(m.x," ").concat(m.y,")")},de(50).map((function(e){return o.a.createElement("circle",{className:"zoom-control-bead",key:"".concat(Math.ceil(e-r-1)),cx:1+e+r%1,cy:0,r:.2,onPointerDownCapture:O,onPointerMoveCapture:k,onPointerUpCapture:j})})),o.a.createElement("circle",{className:"zoom-control-center",cx:0,cy:0,r:.5,onPointerDownCapture:function(e){e.currentTarget.setPointerCapture(e.pointerId),y(!0),x(e)},onPointerMoveCapture:function(e){x(e)},onPointerUpCapture:function(e){e.currentTarget.releasePointerCapture(e.pointerId),y(!1),x(e)}})))},He=function(e){var t=e.children,n=e.width,a=e.height;return o.a.createElement(o.a.Fragment,null,de(n).map((function(e){return de(a).map((function(n){return t(e,n)}))})))},Xe=function(e){var t=e.width,n=e.height;return o.a.createElement(He,{width:t,height:n},(function(e,t){return o.a.createElement("rect",{key:"".concat(e,"/").concat(t),className:"background-grid",x:e,y:t,height:1,width:1})}))},Je=function(e){var t=e.onClick,n=e.width,a=e.height,r=e.highlightedSquares,c=e.onHover,i=r.reduce((function(e,t){return e[t.toCoordinateString()]=!0,e}),{});return o.a.createElement(He,{width:n,height:a},(function(e,n){var a=new X(e,n);return o.a.createElement("rect",{key:a.toCoordinateString(),className:Le({"selection-grid":!0,highlighted:i[a.toCoordinateString()]}),x:e,y:n,height:1,width:1,onClick:function(){return t&&t(a)},onMouseOver:function(){return c(a)}})}))},Ve=function(e){var t=e.battleMapService,n=e.backgroundDrawingService,a=e.notesDrawingService,r=e.modeService,c=qe(t.viewBox$,new re(0,0,0,0)),i=qe(t.tokens$,[]),l=qe(a.active$,!1),u=qe(Object(M.a)([t.squareSelectable$,r.mode$.pipe(Object(ee.a)(Oe("play","manage-token")))]).pipe(Object(ee.a)((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return n&&a}))),!1),m=qe(r.mode$.pipe(Object(ee.a)(Oe("zoom"))),!1),d=qe(t.gridMap$,null),h=qe(t.scale$,t.scale),b=qe(t.position$,t.position),f=qe(t.highlightedSquares$,[]);return o.a.createElement(o.a.Fragment,null,d&&o.a.createElement("svg",{className:"h-100 w-100",viewBox:c.toViewBoxString()},o.a.createElement("g",{transform:"translate(".concat(b.x," ").concat(b.y,") scale(").concat(h,", ").concat(h,")")},o.a.createElement(Ie,{gridMap:d}),o.a.createElement(Xe,{width:d.getWidthInSquares(),height:d.getHeightInSquares()}),o.a.createElement(Ye,{name:"background",drawingService:n}),u&&o.a.createElement(Je,{width:d.getWidthInSquares(),height:d.getHeightInSquares(),highlightedSquares:f,onClick:function(e){return t.selectSquare(e)},onHover:function(e){return t.hoverOverSquare(e)}}),o.a.createElement(Be,{tokens:i,selectedToken$:t.selectedToken$,onClick:function(e){return t.selectToken(e)}}),l&&o.a.createElement(Ye,{name:"notes",drawingService:a}),o.a.createElement(Ue,{drawingService:a}),o.a.createElement(Ue,{drawingService:n})),m&&o.a.createElement(We,{battleMapService:t})))},Qe=function(e){var t=e.classes,n=e.onClick,a=e.icon,r=e.text,c=e.iconSize,i=e.tooltip,l=e.iconHeight,s="";"string"===typeof t?s=t:"object"===typeof t&&(s=Le(t));var u=c||16;return o.a.createElement("div",null,o.a.createElement("a",{href:"#",title:i,onClick:function(e){e.preventDefault(),n&&n()},className:"btn btn-sm mb-md-2 "+s},o.a.createElement("div",{className:"icon-button-content"},a&&o.a.createElement(S.F,{icon:a,width:u,height:l||u}),r&&o.a.createElement("span",null,r))))},Ze=(Ke={},Object(Te.a)(Ke,fe.s,8),Object(Te.a)(Ke,fe.m,12),Object(Te.a)(Ke,fe.l,16),Ke),et=function(e){var t=e.drawingService,n=qe(t.drawingColor$,t.drawingColor),a=qe(t.drawingWidth$,t.drawingWidth),r=qe(t.active$,!1),c=qe(t.drawingMode$,"draw"),i=function(e,n){var a;return o.a.createElement(Qe,{key:e,icon:n,onClick:function(){return t.switchDrawingMode(e)},classes:(a={},Object(Te.a)(a,"btn-warning",c===e),Object(Te.a)(a,"btn-outline-warning",c!==e),a)})};return o.a.createElement(o.a.Fragment,null,r&&o.a.createElement("div",{className:"mt-md-5"},i("draw",S.u),i("erase",S.C),o.a.createElement("div",{className:"mt-md-4"}),Object.values(fe).map((function(e){return function(e){var n;return o.a.createElement(Qe,{key:e,icon:S.x,iconSize:Ze[e],onClick:function(){return t.switchDrawingWidth(e)},classes:(n={},Object(Te.a)(n,"btn-secondary",a===e),Object(Te.a)(n,"btn-outline-secondary",a!==e),Object(Te.a)(n,"drawing-pane-button",!0),n)})}(e)})),o.a.createElement("div",{className:"mt-md-4"}),Object.values(be).map((function(e){return function(e){var a;return o.a.createElement(Qe,{key:e,icon:S.t,onClick:function(){return t.switchDrawingColor(e)},classes:(a={},Object(Te.a)(a,"drawing-button-".concat(e),n!==e),Object(Te.a)(a,"drawing-button-".concat(e,"-selected"),n===e),a)})}(e)}))))},tt=function(e){var t=e.modeService,n=qe(t.mode$,"play"),a=function(e,a,r){return o.a.createElement(Qe,{icon:e,onClick:function(){return t.switchMode(a)},classes:{"btn-outline-primary":a!==n,"btn-primary":a===n},tooltip:r})};return o.a.createElement("div",{className:""},a(S.k,"play",q.playPage.controlBar.playButton),a(S.s,"manage-token",q.playPage.controlBar.addTokensButton),a(S.r,"draw-notes",q.playPage.controlBar.drawNotesButton),a(S.i,"draw-background",q.playPage.controlBar.drawBackgroundButton),a(S.z,"zoom",q.playPage.controlBar.zoomButton))},nt=function(e){var t=e.manageTokenService,n=qe(t.active$,!1),a=qe(t.tokenType$,null),r=qe(t.tokenLabel$,null),c=qe(t.mode$,"add-token"),i=function(e,n){return o.a.createElement(Qe,{icon:e,onClick:function(){return t.switchMode(n)},classes:{"btn-warning":n===c,"btn-outline-warning":n!==c}})};return o.a.createElement(o.a.Fragment,null,n&&o.a.createElement("div",{className:"mt-md-5"},i(S.w,"add-token"),i(S.C,"remove-token"),o.a.createElement("div",null,o.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.switchMode("switch-token-type")},className:Le({btn:!0,"btn-sm":!0,"btn-warning":"switch-token-type"===c,"btn-outline-warning":"switch-token-type"!==c})},a&&r&&o.a.createElement("svg",{viewBox:"-0.1 -0.1 1.15 1.15",width:16,height:16},o.a.createElement(Re,{tokenLabel:r,tokenType:a,tokenSize:1}))))))},at=function(e){var t=e.modeService,n=e.notesDrawingService,a=e.backgroundDrawingService,r=e.manageTokenService;return o.a.createElement("div",{className:"navbar navbar-dark bg-dark control-pane"},o.a.createElement(tt,{modeService:t}),o.a.createElement(et,{drawingService:n}),o.a.createElement(et,{drawingService:a}),o.a.createElement(nt,{manageTokenService:r}))},rt=function(e){var t=e.items,n=e.columns,a=e.component;return o.a.createElement("div",{className:"row p-2"},t.map((function(e,t){return o.a.createElement("div",{key:t,className:"col-".concat(12/n)},a(e))})))},ct=function(e){var t=e.tokenType,n=e.tokenLabel,a=e.tokenSize,r=e.onClick,c=e.selected,i=e.svgSize,l=e.maxTokenSize,s=new re(-.25,-.25,l+.5,l+.5);return o.a.createElement("a",{className:Le({btn:!0,"btn-outline-secondary":!c,"btn-secondary":c}),onClick:function(e){e.preventDefault(),r()}},o.a.createElement("svg",{viewBox:s.toViewBoxString(),width:i,height:i},o.a.createElement(Xe,{width:l,height:l}),o.a.createElement(Re,{tokenLabel:n,tokenType:t,tokenSize:a})))},ot=n(47),it=n.n(ot),lt=function(e){var t=e.children,n=e.onOk,a=e.okEnabled,r=e.onCancel,i=e.buttonText,l=e.header,s=e.open,u=Object(c.useRef)(null);Object(c.useLayoutEffect)((function(){it()(u.current).modal("hide").on("hide.bs.modal",(function(){r&&r()}))}),[r]),Object(c.useLayoutEffect)((function(){console.log("effect after open",s),it()(u.current).modal(s?"show":"hide")}),[s]);return o.a.createElement("div",{ref:u,className:"modal fade",id:"exampleModal",tabIndex:-1},o.a.createElement("div",{className:"modal-dialog modal-lg modal-dialog-centered"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},l),o.a.createElement("button",{type:"button",className:"close",onClick:r},o.a.createElement("span",null,"\xd7"))),o.a.createElement("div",{className:"modal-body"},t),o.a.createElement("div",{className:"modal-footer"},n&&o.a.createElement("button",{onClick:function(){it()(u.current).modal("hide"),n&&n()},disabled:void 0!==a&&!a,type:"button",className:"btn btn-primary"},i)))))},st=function(e){var t=e.assetService,n=e.manageTokenService,a=qe(n.isSwitchTokenType$,!1),r=qe(n.tokenType$,n.tokenType),i=qe(n.tokenLabel$,n.tokenLabel),l=qe(n.tokenSize$,n.tokenSize),s=Object(c.useCallback)((function(){return n.switchMode("add-token")}),[n]);return o.a.createElement(lt,{onCancel:s,buttonText:"place it",header:"Add Token",open:a},!!i&&!!r&&!!l&&o.a.createElement("div",null,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-4"},o.a.createElement(rt,{items:t.tokenTypes,columns:4,component:function(e){return o.a.createElement(ct,{tokenLabel:i,tokenType:e,tokenSize:1,onClick:function(){return n.setTokenType(e)},selected:e===r,svgSize:35,maxTokenSize:1})}})),o.a.createElement("div",{className:"col-4"},o.a.createElement(rt,{items:t.tokenLabels,columns:4,component:function(e){return o.a.createElement(ct,{tokenLabel:e,tokenType:r,tokenSize:1,onClick:function(){return n.setTokenLabel(e)},selected:i===e,svgSize:35,maxTokenSize:1})}})),o.a.createElement("div",{className:"col-4"},o.a.createElement(rt,{items:de(3),columns:1,component:function(e){var t=e+1;return o.a.createElement(ct,{tokenLabel:i,tokenType:r,tokenSize:t,onClick:function(){return n.setTokenSize(t)},selected:l===t,svgSize:90,maxTokenSize:3})}})))))},ut=function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"App h-100"},o.a.createElement(Ve,e),o.a.createElement(at,e)),o.a.createElement("div",{className:"App h-100"},o.a.createElement(st,e)))},mt=function(e){return Object(u.a)(e),o.a.createElement(E,{heading:o.a.createElement("h1",null,"Welcome to Gridheim, Stranger!")},o.a.createElement("h3",null,"No Session found"),o.a.createElement("span",null,"It seems that you don't have a session (yet) or that the session is invalid :("),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("span",null,"Please go ",o.a.createElement(m.b,{to:cn.sessions},"here")," to create a session so we can play :D"))},dt=function(e){var t=e.gridMapStorage,n=e.sessionStorage,a=Object(c.useState)(null),r=Object(s.a)(a,2),i=r[0],l=r[1],u=Object(c.useState)("LOADING"),m=Object(s.a)(u,2),d=m[0],h=m[1];return Object(c.useEffect)((function(){var e=new ze(t,n),a=new he(e),r=new ve(a),c=new Se,o=new Se,i=new we,s=new xe(a,i),u=new Ne("play",{play:r,"draw-background":c,"draw-notes":o,"manage-token":s,zoom:null});return e.add("tokens",a.tokens$).subscribe((function(e){var t=e.flatMap((function(e){var t=i.tokenTypeForName(e.tokenType.name);return t?[new H(e.id,t,e.label,new X(e.square.x,e.square.y),e.size)]:[]}));a.updateTokens((function(){return t}))})),e.add("background-pane",c.pane$.pipe(Object(ee.a)((function(e){return e.withCurrentDrawingRemoved()})))).subscribe((function(e){c.setPane(Z.fromJson(e))})),e.add("notes-pane",o.pane$.pipe(Object(ee.a)((function(e){return e.withCurrentDrawingRemoved()})))).subscribe((function(e){o.setPane(Z.fromJson(e))})),e.loadAndStart().toPromise().then((function(e){return h(e?"LOADED":"FAILED")})),l({battleMapService:a,playModeService:r,backgroundDrawingService:c,notesDrawingService:o,modeService:u,manageTokenService:s,assetService:i}),function(){console.log("disposing PlayApp"),e.saveSession(),a.dispose(),r.dispose(),c.dispose(),o.dispose(),u.dispose(),s.dispose(),i.dispose()}}),[n,t]),o.a.createElement(o.a.Fragment,null,(!i||"LOADING"===d)&&o.a.createElement("div",{className:"App h-100"},o.a.createElement("span",null,"loading ...")),"FAILED"===d&&!!i&&o.a.createElement(mt,null),"LOADED"===d&&!!i&&o.a.createElement(ut,i))},ht=n(97),bt=n(150),ft=function(){function e(){var t=this;Object(R.a)(this,e),this.db=new ht.a("GridHeimBlobStorage"),this.blobs=(t.db.version(1).stores(Object(Te.a)({},e.TABLE_NAME,"key,value")),t.db.table(e.TABLE_NAME))}return Object(B.a)(e,[{key:"get",value:function(e){return Object(bt.a)(this.blobs.get(e).then((function(e){return e?e.value:null})))}},{key:"listKeys",value:function(){return Object(bt.a)(this.blobs.toArray().then((function(e){return Object.freeze(e.map((function(e){return e.key})))})))}},{key:"set",value:function(e,t){return Object(bt.a)(this.blobs.put({key:e,value:t}).then((function(){})))}},{key:"remove",value:function(e){return Object(bt.a)(this.blobs.delete(e).then((function(){})))}}]),e}();ft.TABLE_NAME="blobs";var pt=n(153),gt=function(e){return e.findCurrentSession().pipe(Object(ee.a)((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return n&&a?{to:cn.play,descriptionText:q.startPage.play.description,actionText:"".concat(q.startPage.play.button," '").concat(n,"'"),section:"play"}:null})))},vt=function(e){return e.count().pipe(Object(ee.a)((function(e){return 0===e?null:{to:cn.newSessions,descriptionText:q.startPage.newSession.description,actionText:q.startPage.newSession.button,section:"play"}})))},Et=function(e){return e.count().pipe(Object(ee.a)((function(e){return 0===e?null:{to:cn.sessions,descriptionText:q.startPage.showSessions.description,actionText:q.startPage.showSessions.button,section:"play"}})))},St=function(e){return e.count().pipe(Object(ee.a)((function(e){return 0===e?null:{to:cn.gridMaps,descriptionText:q.startPage.showGridMaps.description,actionText:q.startPage.showGridMaps.button,section:"gridMaps"}})))},yt=function(e){var t=e.headline,n=e.icon,a=e.children,r=e.hero;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"row mb-5"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("div",{className:"card"},o.a.createElement("div",{className:"card-header".concat(r?" bg-dark text-white":"")},o.a.createElement("h4",null,o.a.createElement(S.F,{icon:n,size:30})," ",t)),o.a.createElement("div",{className:"card-body"},o.a.Children.map(a,(function(e,t){return o.a.createElement(o.a.Fragment,null,0!==t&&o.a.createElement("hr",null),e)})))))))},wt=function(e){var t=e.description,n=e.hero,a=e.actionText,r=e.to;return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",{className:"card-text"},t),o.a.createElement(m.b,{className:Le({btn:!0,"btn-secondary":!n,"btn-primary":!!n,"btn-lg":!!n}),to:r},a))};function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ot,jt,xt,Nt={play:{icon:S.v,headline:"Play"},gridMaps:{icon:S.i,headline:"Maps"}},Tt=function(e){var t=e.gridMapStorage,n=e.sessionStorage,a=qe(Object(M.a)([gt(n),vt(t),Et(n),Object(Me.a)({to:cn.newGridMap,descriptionText:q.startPage.newGridMap.description,actionText:q.startPage.newGridMap.button,section:"gridMaps"}),St(t)]).pipe(Object(ee.a)((function(e){return e.reduce((function(e,t){if(!t)return e;var n=t.section;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(n,!0).forEach((function(t){Object(Te.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,Object(Te.a)({},n,[].concat(Object(J.a)(e[n]||[]),[t])))}),{})})),Object(pt.a)(1)),{},[n,t]);return o.a.createElement(E,{heading:o.a.createElement(w,{icon:S.q,headline:q.startPage.headline},o.a.createElement("small",null,o.a.createElement("a",{href:j,className:"ml-2 mr-2"},o.a.createElement(S.F,{icon:S.o})," Impressum"),o.a.createElement("a",{href:x},o.a.createElement(S.F,{icon:S.n})," Data Protection")))},Object.entries(a).map((function(e,t){var n=Object(s.a)(e,2),a=n[0],r=n[1];return o.a.createElement(yt,{key:a,headline:Nt[a].headline,icon:Nt[a].icon,hero:!0},r.map((function(e,n){return o.a.createElement(wt,{key:n,description:e.descriptionText,hero:0===n&&0===t,actionText:e.actionText,to:e.to})})))})),o.a.createElement(yt,{headline:"Infos",icon:S.m},o.a.createElement(wt,{description:q.startPage.about.description,actionText:q.startPage.about.button,to:cn.about}),o.a.createElement(wt,{description:q.startPage.openSource.description,actionText:q.startPage.openSource.button,to:cn.openSource})))},Mt=Y()((xt=jt=function(){function e(t,n,a){Object(R.a)(this,e),this.name=t,this.image=n,this.transformation=a}return Object(B.a)(e,null,[{key:"storageKey",value:function(e){return"".concat(this.STORAGE_KEY_PREFIX).concat(e)}},{key:"isStorageKey",value:function(e){return e.startsWith(this.STORAGE_KEY_PREFIX)}},{key:"of",value:function(t){return Object.freeze(new e(t.name,t.image,t.transformation))}}]),Object(B.a)(e,[{key:"with",value:function(t){var n=new e(this.name,this.image,this.transformation);return Object.freeze(Object.assign(n,t))}},{key:"getWidthInSquares",value:function(){return Math.ceil(this.image.width*this.transformation.scale)}},{key:"getHeightInSquares",value:function(){return Math.ceil(this.image.height*this.transformation.scale)}}]),e}(),jt.STORAGE_KEY_PREFIX="map-",Ot=xt))||Ot,$t=function(){function e(t,n,a){Object(R.a)(this,e),this.dx=t,this.dy=n,this.scale=a}return Object(B.a)(e,null,[{key:"default",value:function(){return Object.freeze(new e(0,0,1))}},{key:"of",value:function(t){return Object.freeze(new e(t.dx,t.dy,t.scale))}}]),Object(B.a)(e,[{key:"with",value:function(t){var n=new e(this.dx,this.dy,this.scale);return Object.freeze(Object.assign(n,t))}},{key:"asTransformString",value:function(){return"scale(".concat(this.scale," ").concat(this.scale,") translate(").concat(this.dx," ").concat(this.dy,")")}}]),e}(),Ct=function(){function e(t,n,a){Object(R.a)(this,e),this.url=t,this.width=n,this.height=a}return Object(B.a)(e,null,[{key:"of",value:function(t){return Object.freeze(new e(t.url,t.width,t.height))}}]),Object(B.a)(e,[{key:"with",value:function(t){var n=new e(this.url,this.width,this.height);return Object.freeze(Object.assign(n,t))}}]),e}(),Pt=n(151),Dt=function(){function e(t){Object(R.a)(this,e),this.storageProvider=t,this.isStorageKey=void 0,this.toStorageKey=void 0,this.parseJson=void 0,this.keyToStorageKey=void 0}return Object(B.a)(e,[{key:"findAll",value:function(){var e=this;return this.storageProvider.listKeys().pipe(Object(Pe.a)((function(t){var n=t.flatMap((function(t){return t&&e.isStorageKey(t)?[e.loadObject(t)]:[]}));return 0===n.length?Object(Me.a)([]):Object(Pt.a)(n).pipe(Object(ee.a)((function(e){return e.flatMap((function(e){return e?[e]:[]}))})),Object(ee.a)((function(e){return Object.freeze(e)})))})))}},{key:"count",value:function(){return this.storageProvider.listKeys().pipe(Object(ee.a)((function(e){return e.length})))}},{key:"findBy",value:function(e){return this.loadObject(this.keyToStorageKey(e))}},{key:"store",value:function(e){var t=JSON.stringify(e);return this.storageProvider.set(this.toStorageKey(e),t)}},{key:"loadObject",value:function(e){var t=this;return this.storageProvider.get(e).pipe(Object(ee.a)((function(n){if(null===n)return null;var a=JSON.parse(n);try{return t.parseJson(a)}catch(r){return console.log("Failed loading ".concat(e," from local storage"),{name:e,e:r}),null}})))}},{key:"delete",value:function(e){return e?this.storageProvider.remove(this.keyToStorageKey(e)):Object(Me.a)(void 0)}}]),e}(),Ft=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(te.a)(this,(e=Object(ne.a)(t)).call.apply(e,[this].concat(r)))).isStorageKey=function(e){return Mt.isStorageKey(e)},n.parseJson=function(e){return Mt.of({name:e.name,image:Ct.of(e.image),transformation:$t.of(e.transformation)})},n.toStorageKey=function(e){return Mt.storageKey(e.name)},n.keyToStorageKey=function(e){return Mt.storageKey(e)},n}return Object(ae.a)(t,e),t}(Dt),At=function(){function e(t,n,a,r){Object(R.a)(this,e),this.name=t,this.date=n,this.gridMapName=a,this.content=r}return Object(B.a)(e,null,[{key:"storageKey",value:function(e){return"".concat(this.STORAGE_KEY_PREFIX).concat(e)}},{key:"isStorageKey",value:function(e){return e.startsWith(this.STORAGE_KEY_PREFIX)}},{key:"of",value:function(t){return Object.freeze(new e(t.name,t.date,t.gridMapName,t.content))}}]),Object(B.a)(e,[{key:"with",value:function(t){var n=new e(this.name,this.date,this.gridMapName,this.content);return Object.freeze(Object.assign(n,t))}}]),e}();At.STORAGE_KEY_PREFIX="session-",At.CURRENT_SESSION_STORAGE_KEY="current-session";var zt=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(te.a)(this,(e=Object(ne.a)(t)).call.apply(e,[this].concat(r)))).isStorageKey=function(e){return At.isStorageKey(e)},n.parseJson=function(e){return At.of({name:e.name,date:e.date,gridMapName:e.gridMapName,content:e.content})},n.toStorageKey=function(e){return At.storageKey(e.name)},n.keyToStorageKey=function(e){return At.storageKey(e)},n}return Object(ae.a)(t,e),Object(B.a)(t,[{key:"storeCurrentSessionName",value:function(e){return this.storageProvider.set(At.CURRENT_SESSION_STORAGE_KEY,e)}},{key:"findCurrentSessionName",value:function(){return this.storageProvider.get(At.CURRENT_SESSION_STORAGE_KEY)}},{key:"findCurrentSession",value:function(){var e=this;return this.findCurrentSessionName().pipe(Object(Pe.a)((function(t){return t?e.findBy(t).pipe(Object(ee.a)((function(e){return[t,e]}))):Object(Me.a)([null,null])})))}}]),t}(Dt),It=function(e){var t=e.initialUrl,n=e.onApply,a=Object(c.useState)(null),r=Object(s.a)(a,2),i=r[0],l=r[1];Object(c.useEffect)((function(){l(t)}),[t]);return o.a.createElement(o.a.Fragment,null,!!i||o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(y,null,"Select a image from your computer, that should be used as map.",o.a.createElement("br",null),"This file is ",o.a.createElement("em",null,"not")," uploaded in the internet but stored in your browser ..."),o.a.createElement("div",{className:"custom-file"},o.a.createElement("input",{type:"file",className:"custom-file-input",id:"customFile",onChange:function(e){var t=e.target.files;if(t&&t.length>0){var n=t[0],a=new FileReader;a.onloadend=function(){var e=a.result;l(e)},a.readAsDataURL(n)}}}),o.a.createElement("label",{className:"custom-file-label",htmlFor:"customFile"},"Choose file")))),!!i&&o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("div",null,o.a.createElement("button",{className:"btn btn-secondary btn-sm",type:"button",onClick:function(){l(null)}},"Change")),o.a.createElement("img",{className:"img-thumbnail gridMap-form_image-preview",src:i}))),o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("button",{className:"btn btn-sm btn-success mt-2",disabled:!i,onClick:function(){n(i)},type:"button"},o.a.createElement(S.F,{icon:S.e}),"Next"))))},qt=function(e){var t=Object(c.useRef)(!1),n=Object(c.useState)(!1),a=Object(s.a)(n,2),r=a[0],o=a[1],i=Object(c.useRef)(null),l=Object(c.useRef)(e);l.current=e;var u=function(e){t.current=e,o(e)};return{dragging:r,eventHandler:{onPointerDown:function(e){var n=e.currentTarget,a=_e(e);if(!t.current){u(!0),i.current=a,l.current.onStart(a);var r=function(e){var t=_e({clientX:e.clientX,clientY:e.clientY,currentTarget:n});l.current.onMove(t)};document.addEventListener("pointermove",r),document.addEventListener("pointerup",(function e(t){var a,c,o=_e({clientX:t.clientX,clientY:t.clientY,currentTarget:n});(i.current?(a=i.current,c=o,Math.sqrt(Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2))):-1)>.5&&(l.current.onFinished(o),u(!1),document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",e))}))}}}}};function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(n,!0).forEach((function(t){Object(Te.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bt=function(e){var t=e.width,n=e.height,a=e.onChange,r=Object(c.useState)(null),i=Object(s.a)(r,2),l=i[0],u=i[1],m=function(e){u(e),a(e?{x:e.x+e.a/3,y:e.y+e.a/3,a:e.a/3}:null)},d=t/600,h=qt({onStart:function(e){var t=e.x,n=e.y;u({x:t,y:n,a:0})},onMove:function(e){var t=e.x,n=e.y;if(l){var a=t-l.x,r=n-l.y,c=Math.max(0,Math.max(a,r));m(Rt({},l,{a:c}))}},onFinished:function(e){this.onMove(e)},onCancel:function(){m(null)}}),b=function(e){return qt({onStart:function(e){e.x,e.y},onMove:function(t){l&&m(e(t,l))},onFinished:function(e){this.onMove(e)},onCancel:function(){u(null)}})},f=[[b((function(e,t){var n=e.x,a=e.y,r=Math.max(t.x-n,t.y-a);return{x:t.x-r,y:t.y-r,a:t.a+r}})),b((function(e,t){var n=e.x,a=e.y,r=Math.max(t.x-n,a-t.y-t.a);return Rt({},t,{x:t.x-r,a:t.a+r})}))],[b((function(e,t){var n=e.x,a=e.y,r=Math.max(n-t.x-t.a,t.y-a);return Rt({},t,{y:t.y-r,a:t.a+r})})),b((function(e,t){var n=e.x,a=e.y;return Rt({},t,{a:Math.max(n-t.x,a-t.y)})}))]];return o.a.createElement("g",null,o.a.createElement("rect",Object.assign({fillOpacity:.01,x:0,y:0,width:t,height:n},h.eventHandler)),l&&o.a.createElement("g",null,de(3).flatMap((function(e){return de(3).map((function(t){return o.a.createElement("rect",{key:"".concat(e,"/").concat(t),x:l.x+e*l.a/3,y:l.y+t*l.a/3,width:l.a/3,height:l.a/3,stroke:h.dragging?"#0f86ff":"red",fillOpacity:0,strokeDasharray:"".concat(d," ").concat(d),strokeWidth:d})}))})),!h.dragging&&de(2).flatMap((function(e){return de(2).map((function(t){var n=f[e][t];return o.a.createElement("rect",Object.assign({key:"".concat(e,"/").concat(t),x:l.x+e*l.a-2*d,y:l.y+t*l.a-2*d,width:4*d,height:4*d,strokeOpacity:0,fill:n.dragging?"#0f86ff":"red"},n.eventHandler))}))}))))},_t=function(e){var t=e.transformation,n=e.onTransformationChange,a=Object(c.useState)(t),r=Object(s.a)(a,2),i=r[0],l=r[1];Object(c.useEffect)((function(){l(t)}),[t]);var u=function(e){l(e),n(e)},m=function(e,t){return o.a.createElement("button",{className:"btn btn-sm btn-secondary ml-2",onClick:t,type:"button"},o.a.createElement(S.F,{icon:e}))};return o.a.createElement(o.a.Fragment,null,m(S.g,(function(){u(i.with({scale:i.scale+.1}))})),m(S.h,(function(){u(i.with({scale:i.scale-.1}))})),m(S.d,(function(){u(i.with({dy:i.dy+100*i.scale}))})),m(S.a,(function(){u(i.with({dy:i.dy-100*i.scale}))})),m(S.b,(function(){u(i.with({dx:i.dx+100*i.scale}))})),m(S.c,(function(){u(i.with({dx:i.dx-100*i.scale}))})))},Gt={center:"center","left-top":"top left corner","right-bottom":"bottom right corner"},Kt=function(e){var t=e.image,n=e.onApply,a=e.viewPosition,r=Object(c.useState)($t.default()),i=Object(s.a)(r,2),l=i[0],u=i[1],m=Object(c.useState)(null),d=Object(s.a)(m,2),h=d[0],b=d[1];Object(c.useEffect)((function(){var e=600/t.width*2,n=$t.default().with({scale:e,dx:"left-top"===a?0:-(t.width-600/e),dy:"left-top"===a?0:-(t.height-600/e)});u(n)}),[t,a]);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(y,null,"For calculating the grid position, draw a rect over the image where 9 squares of the battle grid should be displayed later. Try to select an area in the",o.a.createElement("em",null,Gt[a])," of the map.",o.a.createElement("br",null)),o.a.createElement("div",{className:"mb-2"},o.a.createElement(_t,{transformation:l,onTransformationChange:u})),o.a.createElement("svg",{style:{width:600,height:600},className:"img-thumbnail"},o.a.createElement("g",{transform:l.asTransformString()},o.a.createElement("image",{width:t.width,height:t.height,xlinkHref:t.url}),o.a.createElement(Bt,{width:t.width,height:t.width,onChange:b}))),o.a.createElement("div",null,o.a.createElement("button",{className:"btn btn-sm btn-success mt-2",onClick:function(){h&&n(h)},type:"button",disabled:!h},o.a.createElement(S.F,{icon:S.e}),"Next")))))},Ut=function(e){var t=e.image,n=e.onApply,a=e.imageTransformation,r=Object(c.useState)($t.default()),i=Object(s.a)(r,2),l=i[0],u=i[1],m=Math.ceil(t.width*a.scale+1),d=Math.ceil(t.height*a.scale+1);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(y,null,"As I promised! Here you can make last adjustments to the grid ..."),o.a.createElement("div",{className:"mb-2"},o.a.createElement(_t,{transformation:l,onTransformationChange:u})),o.a.createElement("svg",{style:{width:600,height:600},viewBox:"0 0 ".concat(m," ").concat(d),className:"img-thumbnail"},o.a.createElement("g",{transform:l.asTransformString()},o.a.createElement("g",{transform:a.asTransformString()},o.a.createElement("image",{width:t.width,height:t.height,xlinkHref:t.url})),de(m).map((function(e){return de(d).map((function(t){return o.a.createElement("rect",{key:"".concat(e,"/").concat(t),x:e,y:t,width:"1",height:"1",stroke:"red",strokeWidth:.03,fillOpacity:0})}))})))),o.a.createElement("div",null,o.a.createElement("button",{className:"btn btn-sm btn-success mt-2",onClick:function(){n(a)},type:"button"},o.a.createElement(S.F,{icon:S.e}),"Next")))))},Yt=function(e){var t=e.image,n=e.onApply,a=e.onStep,r=Object(c.useState)(null),i=Object(s.a)(r,2),l=i[0],u=i[1],m=Object(c.useState)(null),d=Object(s.a)(m,2),h=d[0],b=d[1];return l||a("exampleRect1"),o.a.createElement(o.a.Fragment,null,t&&!l&&o.a.createElement(Kt,{viewPosition:"left-top",image:t,onApply:function(e){u(e),a("exampleRect2")}}),t&&l&&!h&&o.a.createElement(Kt,{viewPosition:"center",image:t,onApply:function(e){a("preview"),b(function(e,t){var n=(e.a+t.a)/2,a=Math.abs(t.x-e.x),r=a/Math.round(a/n),c=Math.abs(t.y-e.y),o=(r+c/Math.round(c/n))/2,i=(-e.x%o+-t.x%o)/2,l=(-e.y%o+-t.y%o)/2;return $t.of({scale:1/o,dx:i,dy:l})}(l,e))}}),t&&l&&h&&o.a.createElement(Ut,{image:t,imageTransformation:h,onApply:function(e){n(h)}}))},Wt=function(e){var t=e.onSave,n=Object(c.useState)(""),a=Object(s.a)(n,2),r=a[0],i=a[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("div",{className:"alert alert-primary"},"Last step provide a good name for the map ... and your done :D"),o.a.createElement("div",{className:"input-group mb-2"},o.a.createElement("div",{className:"input-group-prepend"},o.a.createElement("div",{className:"input-group-text"},o.a.createElement(S.F,{icon:S.B}))),o.a.createElement("input",{type:"text",className:"form-control",placeholder:"Background Name",onChange:function(e){i(e.target.value)},value:r})))),o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){r&&t(r)}},"Save"))))},Ht=function(e){var t=e.steps,n=e.active,a=t.indexOf(n);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,t.map((function(e,t){var n=t===a,r=t>a;return o.a.createElement("span",{key:e},o.a.createElement("span",{className:"badge badge-".concat(n?"primary":r?"secondary":"success"," ml-2 mr-2")},n&&o.a.createElement(S.F,{icon:S.A}),e),o.a.createElement(S.F,{icon:S.f}))})),o.a.createElement("span",{className:"badge badge-dark  ml-2 mr-2"},o.a.createElement(S.F,{icon:S.D})," Finished")))},Xt={upload:"Upload Image",selectSquare1:"Select Example Square 1",selectSquare2:"Select Example Square 2",previewGrid:"Preview Grid",metadata:"Add Metadata"},Jt=function(e){var t=e.onSave,n=e.onCancel,a=Object(c.useState)(null),r=Object(s.a)(a,2),i=r[0],l=r[1],u=Object(c.useState)(Xt.upload),m=Object(s.a)(u,2),d=m[0],h=m[1],b=Object(c.useState)(null),f=Object(s.a)(b,2),p=f[0],g=f[1],E=function(e){e&&i&&p&&t(Mt.of({name:e,image:i,transformation:p}))},y=Object(c.useContext)(v);return o.a.createElement("div",{className:"card"},o.a.createElement("div",{className:"card-header"},o.a.createElement("a",{href:"#",className:"btn btn-secondary float-right",onClick:function(e){e.preventDefault(),n()}},o.a.createElement(S.F,{icon:S.E})),o.a.createElement("h5",null,"Add Map")),o.a.createElement("div",{className:"card-body"},o.a.createElement(Ht,{steps:Object.values(Xt),active:d}),!i&&o.a.createElement(It,{initialUrl:null,onApply:function(e){!function(e){if(e){var t=new Image;t.onload=function(){l(new Ct(e,t.width,t.height))},t.src=e}else l(null)}(e),h(Xt.selectSquare1),y()}}),i&&!p&&o.a.createElement(Yt,{image:i,onApply:function(e){g(e),h(Xt.metadata),y()},onStep:function(e){h("exampleRect1"===e?Xt.selectSquare1:"exampleRect2"===e?Xt.selectSquare2:Xt.previewGrid),y()}}),i&&p&&o.a.createElement(Wt,{onSave:function(e){E(e)}})))},Vt=function(e){var t=e.gridMapStorage,n=o.a.createElement(w,{icon:S.i,headline:"Add Map"}),a=P(),r=function(){a.history.push(cn.start)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(E,{heading:n},o.a.createElement(y,null,o.a.createElement("strong",null,"Maps")," are stored images with a grid drawn over them.",o.a.createElement("br",null),"You create a map by selecting an image file on your computer and configure a grid for them. The images are stored locally in your browser local storage and are not sent to the internet."),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(Jt,{onSave:function(e){t.store(e),r()},onCancel:function(){return r()}})))))},Qt={selectBackground:"Select Background",metadata:"Add Metadata"},Zt=function(e){var t=e.onSave,n=e.onCancel,a=e.gridMaps,r=Object(c.useState)(Qt.selectBackground),i=Object(s.a)(r,2),l=i[0],u=i[1],m=Object(c.useState)(),d=Object(s.a)(m,2),h=d[0],b=d[1],f=Object(c.useState)(),p=Object(s.a)(f,2),v=p[0],E=p[1];return o.a.createElement("div",{className:"card"},o.a.createElement("div",{className:"card-header"},o.a.createElement("a",{href:"#",className:"btn btn-secondary float-right",onClick:function(e){e.preventDefault(),n()}},o.a.createElement(S.F,{icon:S.E})),o.a.createElement("h5",null,"Start Session")),o.a.createElement("div",{className:"card-body"},o.a.createElement(Ht,{steps:Object.values(Qt),active:l}),!h&&o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(y,null,"Select a map where you want to play from the list below ..."),o.a.createElement(g,{gridMaps:a,selected:null,onSelect:function(e){b(e.name),u(Qt.metadata)}}))),h&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(y,null,"Provide a memorable name and some other useful information ... and your done :D"),o.a.createElement("div",{className:"input-group mb-2"},o.a.createElement("div",{className:"input-group-prepend"},o.a.createElement("div",{className:"input-group-text"},o.a.createElement(S.F,{icon:S.B}))),o.a.createElement("input",{type:"text",className:"form-control",placeholder:"Session Name",onChange:function(e){return E(e.target.value)},value:v})))),o.a.createElement("div",{className:"row mt-3"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return v&&void(v&&h&&t(At.of({name:v,date:(new Date).toLocaleString(),gridMapName:h,content:{}})))}},"Save and Start Session"))))))},en=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement("h3",null,"No Maps found"),o.a.createElement("span",null,"Oh no! It seems that you want create a sessions but we can't find any map :("),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("span",null,"Please go ",o.a.createElement(m.b,{to:cn.gridMaps},"here")," to create a map.",o.a.createElement("br",null),"Afterwards come back via the menu in the top left corner (Sessions) to start a session."))},tn=function(e){var t=e.sessionStorage,n=e.gridMapStorage,a=Object(c.useState)({}),r=Object(s.a)(a,2),i=r[0],l=r[1];Object(c.useEffect)((function(){n.findAll().subscribe({next:function(e){l($(e,(function(e){return e.name})))}})}),[n,t]);var u=D(cn.start,cn.play),m=Object(s.a)(u,2),d=m[0],h=m[1],b=0===Object.keys(i).length;return o.a.createElement(E,{heading:o.a.createElement(w,{icon:S.y,headline:q.newSessionPage.headline})},o.a.createElement(y,null,q.newSessionPage.explanation),b&&o.a.createElement(en,null),!b&&o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement(Zt,{onSave:function(e){t.store(e),t.storeCurrentSessionName(e.name),h()},onCancel:function(){d()},gridMaps:Object.values(i)}))))},nn=Object.freeze({React:{page:"https://reactjs.org",licence:"MIT",licenceUrl:"https://github.com/facebook/react/blob/master/LICENSE"},Bootstrap:{page:"https://getbootstrap.com",licence:"MIT",licenceUrl:"https://github.com/twbs/bootstrap/blob/master/LICENSEs"},"React Router":{page:"https://reacttraining.com/react-router/",licence:"MIT",licenceUrl:"https://github.com/ReactTraining/react-router/blob/master/LICENSE"},RxJS:{page:"https://rxjs-dev.firebaseapp.com/",licence:"Apache 2.0",licenceUrl:"https://github.com/ReactiveX/rxjs/blob/master/LICENSE.txt"},Typescript:{page:"https://www.typescriptlang.org/",licence:"Apache 2.0",licenceUrl:"https://github.com/microsoft/TypeScript/blob/master/LICENSE.txt"},Octicons:{page:"https://octicons.github.com/",licence:"MIT",licenceUrl:"https://github.com/primer/octicons/blob/master/LICENSE"},Formik:{page:"https://jaredpalmer.com/formik/docs/overview",licence:"MIT",licenceUrl:"https://github.com/jaredpalmer/formik/blob/master/LICENSE"},Immer:{page:"https://immerjs.github.io/immer/docs/introduction",licence:"MIT",licenceUrl:"https://github.com/immerjs/immer/blob/master/LICENSE"},"Dexie.js":{page:"https://dexie.org/",licence:"Apache 2.0",licenceUrl:"https://github.com/dfahlander/Dexie.js/blob/master/LICENSE"},JQuery:{page:"https://jquery.com/",licence:"MIT",licenceUrl:"https://github.com/jquery/jquery/blob/master/LICENSE.txt"},"Popper.js":{page:"https://popper.js.org/",licence:"MIT",licenceUrl:"https://github.com/FezVrasta/popper.js/blob/master/LICENSE.md"},"Create React App":{page:"https://create-react-app.dev/",licence:"MIT",licenceUrl:"https://github.com/facebook/create-react-app/blob/master/LICENSE"},"es-shims/Array.prototype.flatMap":{page:"https://github.com/es-shims/Array.prototype.flatMap",licence:"MIT",licenceUrl:"https://github.com/es-shims/Array.prototype.flatMap/blob/master/LICENSE"}}),an=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement("h5",{className:"mt-5"},o.a.createElement(S.F,{icon:S.p,size:25}),o.a.createElement("span",{className:"ml-3"},"Open Source Software is used here ...")),o.a.createElement("blockquote",{className:"blockquote"},o.a.createElement("p",{className:"mb-0"},o.a.createElement("em",null,'"If I have seen further it is by standing on the shoulders of giants."')),o.a.createElement("footer",{className:"blockquote-footer"},o.a.createElement("cite",{title:"Source Title"},o.a.createElement("a",{href:"https://en.wikipedia.org/wiki/Bernard_of_Chartres"},"Bernard of Chartres")))),o.a.createElement("table",{className:"table"},o.a.createElement("thead",null,o.a.createElement("th",null,"Project"),o.a.createElement("th",null,"Website"),o.a.createElement("th",null,"Licence")),o.a.createElement("tbody",null,Object.entries(nn).map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return o.a.createElement("tr",{key:n},o.a.createElement("td",null,n),o.a.createElement("td",null,o.a.createElement("a",{href:a.page},a.page)),o.a.createElement("td",null,o.a.createElement("a",{href:a.licenceUrl},a.licence)))})))))},rn=function(e){return Object(u.a)(e),o.a.createElement(E,{heading:o.a.createElement(w,{icon:S.s,headline:"Open Source"})},o.a.createElement(an,null))},cn={start:"/",play:"/play",sessions:"/sessions",newSessions:"/sessions/new",gridMaps:"/manage-maps",newGridMap:"/manage-maps/new",about:"/about",tokenTypes:"/token-types",openSource:"/open-source"};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(137);r.a.shim(),l.a.render(o.a.createElement((function(e){Object(u.a)(e);var t=Object(c.useState)((function(){var e=new ft;return{storageProvider:e,gridMapStorage:new Ft(e),sessionStorage:new zt(e)}})),n=Object(s.a)(t,1)[0];return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,null,o.a.createElement("div",{className:"h-100"},o.a.createElement(d.d,null,o.a.createElement(d.b,{path:cn.start,exact:!0},o.a.createElement(K,null,o.a.createElement(Tt,n))),o.a.createElement(d.b,{path:cn.play},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(dt,n))),o.a.createElement(d.b,{path:cn.newSessions},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(tn,n))),o.a.createElement(d.b,{path:cn.sessions},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(F,n))),o.a.createElement(d.b,{path:cn.newGridMap},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(Vt,n))),o.a.createElement(d.b,{path:cn.gridMaps},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(O,n))),o.a.createElement(d.b,{path:cn.tokenTypes},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(A,null))),o.a.createElement(d.b,{path:cn.openSource},o.a.createElement(K,null,o.a.createElement(N,null),o.a.createElement(rn,null))),o.a.createElement(d.b,{path:cn.about},o.a.createElement(N,null),o.a.createElement(L,null))))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},99:function(e,t,n){e.exports=n(138)}},[[99,1,2]]]);
//# sourceMappingURL=main.bc3e35be.chunk.js.map